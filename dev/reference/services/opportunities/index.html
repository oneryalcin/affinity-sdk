
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Strongly-typed Python SDK for the Affinity CRM API">
      
      
      
      
        <link rel="prev" href="../lists/">
      
      
        <link rel="next" href="../tasks/">
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Opportunities - Affinity Python SDK</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#opportunities" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Affinity Python SDK" class="md-header__button md-logo" aria-label="Affinity Python SDK" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Affinity Python SDK
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Opportunities
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/yaniv-golan/affinity-sdk" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Affinity Python SDK" class="md-nav__button md-logo" aria-label="Affinity Python SDK" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Affinity Python SDK
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/yaniv-golan/affinity-sdk" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting-started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Getting started
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Examples
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../glossary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Glossary
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Changelog
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    CLI
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    CLI
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cli/commands/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Commands
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cli/scripting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Scripting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cli-reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    JSON Output Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    AI Integrations
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    AI Integrations
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai-integrations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../mcp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MCP Server
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/claude-code-plugins/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Claude Code Plugins & Skills
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Guides
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Guides
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/authentication/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Authentication
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/performance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Performance tuning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/api-versions-and-routing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API versions & routing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/pagination/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Pagination
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/errors-and-retries/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Errors & retries
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/rate-limits/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Rate limits
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/filtering/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Filtering
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/query-command/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Query command
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/datetime-handling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Datetime handling
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/csv-export/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CSV Export (CLI)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/field-types-and-values/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Field types & values
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/field-values/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Field values
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Models
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/ids-and-types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IDs & types
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/sync-vs-async/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sync vs async
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/debugging-hooks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Debugging hooks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/webhooks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Webhooks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/opportunity-associations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Opportunity associations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../troubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Troubleshooting
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" checked>
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../client/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Client
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../exceptions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Exceptions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Types
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../filters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Filters
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../query-language/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Query Language
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Models
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_7" checked>
        
          
          <label class="md-nav__link" for="__nav_10_7" id="__nav_10_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Services
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_10_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Services
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../companies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Companies
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../persons/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Persons
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lists/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lists
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Opportunities
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Opportunities
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.OpportunityService" class="md-nav__link">
    <span class="md-ellipsis">
      
        OpportunityService
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.OpportunityService.all" class="md-nav__link">
    <span class="md-ellipsis">
      
        all
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.OpportunityService.create" class="md-nav__link">
    <span class="md-ellipsis">
      
        create
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.OpportunityService.delete" class="md-nav__link">
    <span class="md-ellipsis">
      
        delete
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.OpportunityService.get" class="md-nav__link">
    <span class="md-ellipsis">
      
        get
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.OpportunityService.get_associated_companies" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_associated_companies
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.OpportunityService.get_associated_company_ids" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_associated_company_ids
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.OpportunityService.get_associated_company_ids_batch" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_associated_company_ids_batch
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_associated_company_ids_batch">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#affinity.services.opportunities.OpportunityService.get_associated_company_ids_batch--get-all-companies-from-an-opportunity-list" class="md-nav__link">
    <span class="md-ellipsis">
      
        Get all companies from an opportunity list
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.OpportunityService.get_associated_people" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_associated_people
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.OpportunityService.get_associated_person_ids" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_associated_person_ids
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.OpportunityService.get_associated_person_ids_batch" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_associated_person_ids_batch
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_associated_person_ids_batch">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#affinity.services.opportunities.OpportunityService.get_associated_person_ids_batch--get-all-persons-from-an-opportunity-list" class="md-nav__link">
    <span class="md-ellipsis">
      
        Get all persons from an opportunity list
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.OpportunityService.get_associations" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_associations
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.OpportunityService.get_details" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_details
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.OpportunityService.iter" class="md-nav__link">
    <span class="md-ellipsis">
      
        iter
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.OpportunityService.list" class="md-nav__link">
    <span class="md-ellipsis">
      
        list
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.OpportunityService.pages" class="md-nav__link">
    <span class="md-ellipsis">
      
        pages
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.OpportunityService.resolve" class="md-nav__link">
    <span class="md-ellipsis">
      
        resolve
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.OpportunityService.resolve_all" class="md-nav__link">
    <span class="md-ellipsis">
      
        resolve_all
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.OpportunityService.search" class="md-nav__link">
    <span class="md-ellipsis">
      
        search
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.OpportunityService.search_all" class="md-nav__link">
    <span class="md-ellipsis">
      
        search_all
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.OpportunityService.search_pages" class="md-nav__link">
    <span class="md-ellipsis">
      
        search_pages
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.OpportunityService.update" class="md-nav__link">
    <span class="md-ellipsis">
      
        update
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.AsyncOpportunityService" class="md-nav__link">
    <span class="md-ellipsis">
      
        AsyncOpportunityService
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.AsyncOpportunityService.all" class="md-nav__link">
    <span class="md-ellipsis">
      
        all
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.AsyncOpportunityService.create" class="md-nav__link">
    <span class="md-ellipsis">
      
        create
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.AsyncOpportunityService.delete" class="md-nav__link">
    <span class="md-ellipsis">
      
        delete
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.AsyncOpportunityService.get" class="md-nav__link">
    <span class="md-ellipsis">
      
        get
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.AsyncOpportunityService.get_associated_companies" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_associated_companies
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.AsyncOpportunityService.get_associated_company_ids" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_associated_company_ids
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.AsyncOpportunityService.get_associated_company_ids_batch" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_associated_company_ids_batch
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_associated_company_ids_batch">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#affinity.services.opportunities.AsyncOpportunityService.get_associated_company_ids_batch--get-all-companies-from-an-opportunity-list" class="md-nav__link">
    <span class="md-ellipsis">
      
        Get all companies from an opportunity list
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.AsyncOpportunityService.get_associated_people" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_associated_people
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.AsyncOpportunityService.get_associated_person_ids" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_associated_person_ids
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.AsyncOpportunityService.get_associated_person_ids_batch" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_associated_person_ids_batch
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_associated_person_ids_batch">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#affinity.services.opportunities.AsyncOpportunityService.get_associated_person_ids_batch--get-all-persons-from-an-opportunity-list" class="md-nav__link">
    <span class="md-ellipsis">
      
        Get all persons from an opportunity list
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.AsyncOpportunityService.get_associations" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_associations
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.AsyncOpportunityService.get_details" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_details
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.AsyncOpportunityService.iter" class="md-nav__link">
    <span class="md-ellipsis">
      
        iter
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.AsyncOpportunityService.list" class="md-nav__link">
    <span class="md-ellipsis">
      
        list
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.AsyncOpportunityService.pages" class="md-nav__link">
    <span class="md-ellipsis">
      
        pages
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.AsyncOpportunityService.resolve" class="md-nav__link">
    <span class="md-ellipsis">
      
        resolve
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.AsyncOpportunityService.resolve_all" class="md-nav__link">
    <span class="md-ellipsis">
      
        resolve_all
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.AsyncOpportunityService.search" class="md-nav__link">
    <span class="md-ellipsis">
      
        search
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.AsyncOpportunityService.search_all" class="md-nav__link">
    <span class="md-ellipsis">
      
        search_all
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.AsyncOpportunityService.search_pages" class="md-nav__link">
    <span class="md-ellipsis">
      
        search_pages
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.AsyncOpportunityService.update" class="md-nav__link">
    <span class="md-ellipsis">
      
        update
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tasks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tasks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_7_6" >
        
          
          <label class="md-nav__link" for="__nav_10_7_6" id="__nav_10_7_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    V1 endpoints
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_10_7_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_7_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    V1 endpoints
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../v1/notes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Notes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../v1/reminders/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Reminders
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../v1/webhooks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Webhooks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../v1/interactions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Interactions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../v1/fields/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Fields
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../v1/field-values/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Field values
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../v1/files/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Files
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../v1/relationships/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Relationships
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../v1/auth/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Auth
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.OpportunityService" class="md-nav__link">
    <span class="md-ellipsis">
      
        OpportunityService
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.OpportunityService.all" class="md-nav__link">
    <span class="md-ellipsis">
      
        all
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.OpportunityService.create" class="md-nav__link">
    <span class="md-ellipsis">
      
        create
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.OpportunityService.delete" class="md-nav__link">
    <span class="md-ellipsis">
      
        delete
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.OpportunityService.get" class="md-nav__link">
    <span class="md-ellipsis">
      
        get
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.OpportunityService.get_associated_companies" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_associated_companies
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.OpportunityService.get_associated_company_ids" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_associated_company_ids
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.OpportunityService.get_associated_company_ids_batch" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_associated_company_ids_batch
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_associated_company_ids_batch">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#affinity.services.opportunities.OpportunityService.get_associated_company_ids_batch--get-all-companies-from-an-opportunity-list" class="md-nav__link">
    <span class="md-ellipsis">
      
        Get all companies from an opportunity list
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.OpportunityService.get_associated_people" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_associated_people
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.OpportunityService.get_associated_person_ids" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_associated_person_ids
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.OpportunityService.get_associated_person_ids_batch" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_associated_person_ids_batch
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_associated_person_ids_batch">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#affinity.services.opportunities.OpportunityService.get_associated_person_ids_batch--get-all-persons-from-an-opportunity-list" class="md-nav__link">
    <span class="md-ellipsis">
      
        Get all persons from an opportunity list
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.OpportunityService.get_associations" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_associations
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.OpportunityService.get_details" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_details
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.OpportunityService.iter" class="md-nav__link">
    <span class="md-ellipsis">
      
        iter
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.OpportunityService.list" class="md-nav__link">
    <span class="md-ellipsis">
      
        list
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.OpportunityService.pages" class="md-nav__link">
    <span class="md-ellipsis">
      
        pages
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.OpportunityService.resolve" class="md-nav__link">
    <span class="md-ellipsis">
      
        resolve
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.OpportunityService.resolve_all" class="md-nav__link">
    <span class="md-ellipsis">
      
        resolve_all
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.OpportunityService.search" class="md-nav__link">
    <span class="md-ellipsis">
      
        search
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.OpportunityService.search_all" class="md-nav__link">
    <span class="md-ellipsis">
      
        search_all
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.OpportunityService.search_pages" class="md-nav__link">
    <span class="md-ellipsis">
      
        search_pages
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.OpportunityService.update" class="md-nav__link">
    <span class="md-ellipsis">
      
        update
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.AsyncOpportunityService" class="md-nav__link">
    <span class="md-ellipsis">
      
        AsyncOpportunityService
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.AsyncOpportunityService.all" class="md-nav__link">
    <span class="md-ellipsis">
      
        all
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.AsyncOpportunityService.create" class="md-nav__link">
    <span class="md-ellipsis">
      
        create
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.AsyncOpportunityService.delete" class="md-nav__link">
    <span class="md-ellipsis">
      
        delete
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.AsyncOpportunityService.get" class="md-nav__link">
    <span class="md-ellipsis">
      
        get
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.AsyncOpportunityService.get_associated_companies" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_associated_companies
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.AsyncOpportunityService.get_associated_company_ids" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_associated_company_ids
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.AsyncOpportunityService.get_associated_company_ids_batch" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_associated_company_ids_batch
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_associated_company_ids_batch">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#affinity.services.opportunities.AsyncOpportunityService.get_associated_company_ids_batch--get-all-companies-from-an-opportunity-list" class="md-nav__link">
    <span class="md-ellipsis">
      
        Get all companies from an opportunity list
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.AsyncOpportunityService.get_associated_people" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_associated_people
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.AsyncOpportunityService.get_associated_person_ids" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_associated_person_ids
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.AsyncOpportunityService.get_associated_person_ids_batch" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_associated_person_ids_batch
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_associated_person_ids_batch">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#affinity.services.opportunities.AsyncOpportunityService.get_associated_person_ids_batch--get-all-persons-from-an-opportunity-list" class="md-nav__link">
    <span class="md-ellipsis">
      
        Get all persons from an opportunity list
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.AsyncOpportunityService.get_associations" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_associations
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.AsyncOpportunityService.get_details" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_details
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.AsyncOpportunityService.iter" class="md-nav__link">
    <span class="md-ellipsis">
      
        iter
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.AsyncOpportunityService.list" class="md-nav__link">
    <span class="md-ellipsis">
      
        list
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.AsyncOpportunityService.pages" class="md-nav__link">
    <span class="md-ellipsis">
      
        pages
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.AsyncOpportunityService.resolve" class="md-nav__link">
    <span class="md-ellipsis">
      
        resolve
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.AsyncOpportunityService.resolve_all" class="md-nav__link">
    <span class="md-ellipsis">
      
        resolve_all
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.AsyncOpportunityService.search" class="md-nav__link">
    <span class="md-ellipsis">
      
        search
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.AsyncOpportunityService.search_all" class="md-nav__link">
    <span class="md-ellipsis">
      
        search_all
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.AsyncOpportunityService.search_pages" class="md-nav__link">
    <span class="md-ellipsis">
      
        search_pages
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.opportunities.AsyncOpportunityService.update" class="md-nav__link">
    <span class="md-ellipsis">
      
        update
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="opportunities">Opportunities<a class="headerlink" href="#opportunities" title="Permanent link">&para;</a></h1>


<div class="doc doc-object doc-class">



<a id="affinity.services.opportunities.OpportunityService"></a>
    <div class="doc doc-contents first">



        <p>Service for managing opportunities.</p>
<p>Notes:
- V2 opportunity endpoints may return partial representations (e.g. name and
  listId only). The SDK does not perform hidden follow-up calls to "complete"
  an opportunity.
- For full opportunity row data (including list fields), use list entries
  explicitly via <code>client.lists.entries(list_id)</code>.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>affinity/services/opportunities.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">OpportunityService</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Service for managing opportunities.</span>

<span class="sd">    Notes:</span>
<span class="sd">    - V2 opportunity endpoints may return partial representations (e.g. name and</span>
<span class="sd">      listId only). The SDK does not perform hidden follow-up calls to &quot;complete&quot;</span>
<span class="sd">      an opportunity.</span>
<span class="sd">    - For full opportunity row data (including list fields), use list entries</span>
<span class="sd">      explicitly via `client.lists.entries(list_id)`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">:</span> <span class="n">HTTPClient</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_client</span> <span class="o">=</span> <span class="n">client</span>

    <span class="c1"># =========================================================================</span>
    <span class="c1"># Read Operations (V2 API by default)</span>
    <span class="c1"># =========================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Opportunity</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a single opportunity by ID.</span>

<span class="sd">        Args:</span>
<span class="sd">            opportunity_id: The opportunity ID</span>
<span class="sd">            retries: Number of retries on 404 NotFoundError. Default is 0 (fail fast).</span>
<span class="sd">                Set to 2-3 if calling immediately after create() to handle V1V2</span>
<span class="sd">                eventual consistency lag.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The opportunity representation returned by v2 (may be partial).</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotFoundError: If opportunity does not exist after all retries.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">last_error</span><span class="p">:</span> <span class="n">NotFoundError</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">attempts</span> <span class="o">=</span> <span class="n">retries</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># retries=0 means 1 attempt</span>

        <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">attempts</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/opportunities/</span><span class="si">{</span><span class="n">opportunity_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">Opportunity</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">NotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">last_error</span> <span class="o">=</span> <span class="n">e</span>
                <span class="k">if</span> <span class="n">attempt</span> <span class="o">&lt;</span> <span class="n">attempts</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Don&#39;t sleep after last attempt</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">attempt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>  <span class="c1"># 0.5s, 1s, 1.5s backoff</span>

        <span class="k">raise</span> <span class="n">last_error</span>  <span class="c1"># type: ignore[misc]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_details</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Opportunity</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a single opportunity by ID with a more complete representation.</span>

<span class="sd">        Includes association IDs and (when present) list entries, which are not</span>
<span class="sd">        always included in the default `get()` response.</span>

<span class="sd">        See Also:</span>
<span class="sd">            - :meth:`get_associated_person_ids`: Get just person IDs (single API call)</span>
<span class="sd">            - :meth:`get_associated_people`: Get full Person objects</span>
<span class="sd">            - :meth:`get_associated_company_ids`: Get just company IDs (single API call)</span>
<span class="sd">            - :meth:`get_associated_companies`: Get full Company objects</span>
<span class="sd">            - :meth:`get_associations`: Get both person and company IDs in one call</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Uses the v1 endpoint because it returns a fuller payload (including</span>
        <span class="c1"># association IDs and, when present, list entries).</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/opportunities/</span><span class="si">{</span><span class="n">opportunity_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Opportunity</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cursor</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List all opportunities.</span>

<span class="sd">        Args:</span>
<span class="sd">            ids: Specific opportunity IDs to fetch (batch lookup)</span>
<span class="sd">            limit: Maximum number of results per page</span>
<span class="sd">            cursor: Cursor to resume pagination (opaque; obtained from prior responses)</span>

<span class="sd">        Returns the v2 opportunity representation (which may be partial).</span>
<span class="sd">        For full opportunity row data, use list entries explicitly.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">cursor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">limit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Cannot combine &#39;cursor&#39; with other parameters; cursor encodes all query &quot;</span>
                    <span class="s2">&quot;context. Start a new pagination sequence without a cursor to change &quot;</span>
                    <span class="s2">&quot;parameters.&quot;</span>
                <span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get_url</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="n">ids</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s2">&quot;ids&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span> <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">limit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s2">&quot;limit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">limit</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/opportunities&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">](</span>
            <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">Opportunity</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">[])],</span>
            <span class="n">pagination</span><span class="o">=</span><span class="n">PaginationInfo</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pagination&quot;</span><span class="p">,</span> <span class="p">{})),</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">pages</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cursor</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterate opportunity pages (not items), yielding `PaginatedResponse[Opportunity]`.</span>

<span class="sd">        This is useful for ETL scripts that want checkpoint/resume via `page.next_cursor`.</span>

<span class="sd">        Args:</span>
<span class="sd">            ids: Specific opportunity IDs to fetch (batch lookup)</span>
<span class="sd">            limit: Maximum results per page</span>
<span class="sd">            cursor: Cursor to resume pagination</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">other_params</span> <span class="o">=</span> <span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cursor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="n">p</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">other_params</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot combine &#39;cursor&#39; with other parameters; cursor encodes all query context. &quot;</span>
                <span class="s2">&quot;Start a new pagination sequence without a cursor to change parameters.&quot;</span>
            <span class="p">)</span>
        <span class="n">requested_cursor</span> <span class="o">=</span> <span class="n">cursor</span>
        <span class="n">page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">cursor</span><span class="o">=</span><span class="n">cursor</span><span class="p">)</span> <span class="k">if</span> <span class="n">cursor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">ids</span><span class="o">=</span><span class="n">ids</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">page</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">page</span><span class="o">.</span><span class="n">has_next</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">next_cursor</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">next_cursor</span>
            <span class="k">if</span> <span class="n">next_cursor</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">next_cursor</span> <span class="o">==</span> <span class="n">requested_cursor</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">requested_cursor</span> <span class="o">=</span> <span class="n">next_cursor</span>
            <span class="n">page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">cursor</span><span class="o">=</span><span class="n">next_cursor</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">all</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterate through all opportunities with automatic pagination.</span>

<span class="sd">        Args:</span>
<span class="sd">            ids: Specific opportunity IDs to fetch (batch lookup)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">fetch_page</span><span class="p">(</span><span class="n">next_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">next_url</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get_url</span><span class="p">(</span><span class="n">next_url</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">](</span>
                    <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">Opportunity</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">[])],</span>
                    <span class="n">pagination</span><span class="o">=</span><span class="n">PaginationInfo</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pagination&quot;</span><span class="p">,</span> <span class="p">{})),</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">ids</span><span class="o">=</span><span class="n">ids</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">PageIterator</span><span class="p">(</span><span class="n">fetch_page</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">iter</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Auto-paginate all opportunities.</span>

<span class="sd">        Alias for `all()` (FR-006 public contract).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">ids</span><span class="o">=</span><span class="n">ids</span><span class="p">)</span>

    <span class="c1"># =========================================================================</span>
    <span class="c1"># Search (V1 API)</span>
    <span class="c1"># =========================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">search</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">term</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">page_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">page_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Search for opportunities by name.</span>

<span class="sd">        Uses V1 API for search functionality.</span>

<span class="sd">        Args:</span>
<span class="sd">            term: Search term (matches opportunity name). If None, returns all.</span>
<span class="sd">            page_size: Results per page (max 500)</span>
<span class="sd">            page_token: Pagination token</span>

<span class="sd">        Returns:</span>
<span class="sd">            PaginatedResponse with opportunities and next_page_token</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">term</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;term&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">term</span>
        <span class="k">if</span> <span class="n">page_size</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;page_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">page_size</span>
        <span class="k">if</span> <span class="n">page_token</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;page_token&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">page_token</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/opportunities&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">Opportunity</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;opportunities&quot;</span><span class="p">,</span> <span class="p">[])]</span>
        <span class="k">return</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">](</span>
            <span class="n">data</span><span class="o">=</span><span class="n">items</span><span class="p">,</span>
            <span class="n">next_page_token</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;next_page_token&quot;</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">search_pages</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">term</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">page_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">page_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterate V1 opportunity-search result pages.</span>

<span class="sd">        Useful for scripts that need checkpoint/resume via `next_page_token`.</span>

<span class="sd">        Args:</span>
<span class="sd">            term: Search term (matches opportunity name). If None, returns all.</span>
<span class="sd">            page_size: Results per page (max 500)</span>
<span class="sd">            page_token: Resume from this pagination token</span>

<span class="sd">        Yields:</span>
<span class="sd">            PaginatedResponse[Opportunity] for each page</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">requested_token</span> <span class="o">=</span> <span class="n">page_token</span>
        <span class="n">page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">page_size</span><span class="o">=</span><span class="n">page_size</span><span class="p">,</span> <span class="n">page_token</span><span class="o">=</span><span class="n">page_token</span><span class="p">)</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">page</span>
            <span class="n">next_token</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">next_page_token</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">next_token</span> <span class="ow">or</span> <span class="n">next_token</span> <span class="o">==</span> <span class="n">requested_token</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">requested_token</span> <span class="o">=</span> <span class="n">next_token</span>
            <span class="n">page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">page_size</span><span class="o">=</span><span class="n">page_size</span><span class="p">,</span> <span class="n">page_token</span><span class="o">=</span><span class="n">next_token</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">search_all</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">term</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">page_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">page_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterate all V1 opportunity-search results with automatic pagination.</span>

<span class="sd">        Args:</span>
<span class="sd">            term: Search term (matches opportunity name). If None, returns all.</span>
<span class="sd">            page_size: Results per page (max 500)</span>
<span class="sd">            page_token: Resume from this pagination token</span>

<span class="sd">        Yields:</span>
<span class="sd">            Each Opportunity individually</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_pages</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">page_size</span><span class="o">=</span><span class="n">page_size</span><span class="p">,</span> <span class="n">page_token</span><span class="o">=</span><span class="n">page_token</span><span class="p">):</span>
            <span class="k">yield from</span> <span class="n">page</span><span class="o">.</span><span class="n">data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">resolve</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">list_id</span><span class="p">:</span> <span class="n">ListId</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Opportunity</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find a single opportunity by exact name within a specific list.</span>

<span class="sd">        Notes:</span>
<span class="sd">        - Opportunities are list-scoped; a list id is required.</span>
<span class="sd">        - This iterates list-entry pages client-side (no dedicated search endpoint).</span>
<span class="sd">        - If multiple matches exist, returns the first match in server-provided order.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Name cannot be empty&quot;</span><span class="p">)</span>
        <span class="n">name_lower</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="n">entries</span> <span class="o">=</span> <span class="n">ListEntryService</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="p">,</span> <span class="n">list_id</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">entries</span><span class="o">.</span><span class="n">pages</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">page</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
                <span class="n">entity</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">entity</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">Opportunity</span><span class="p">)</span> <span class="ow">and</span> <span class="n">entity</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">name_lower</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">entity</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">resolve_all</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">list_id</span><span class="p">:</span> <span class="n">ListId</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find all opportunities matching a name within a specific list.</span>

<span class="sd">        Notes:</span>
<span class="sd">        - Opportunities are list-scoped; a list id is required.</span>
<span class="sd">        - This iterates list-entry pages client-side (no dedicated search endpoint).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Name cannot be empty&quot;</span><span class="p">)</span>
        <span class="n">name_lower</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">matches</span><span class="p">:</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">entries</span> <span class="o">=</span> <span class="n">ListEntryService</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="p">,</span> <span class="n">list_id</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">entries</span><span class="o">.</span><span class="n">pages</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">page</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
                <span class="n">entity</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">entity</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">Opportunity</span><span class="p">)</span> <span class="ow">and</span> <span class="n">entity</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">name_lower</span><span class="p">:</span>
                    <span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">matches</span>

    <span class="c1"># =========================================================================</span>
    <span class="c1"># Write Operations (V1 API)</span>
    <span class="c1"># =========================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">OpportunityCreate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Opportunity</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new opportunity.</span>

<span class="sd">        The opportunity will be added to the specified list.</span>

<span class="sd">        Args:</span>
<span class="sd">            data: Opportunity creation data including list_id and name</span>

<span class="sd">        Returns:</span>
<span class="sd">            The created opportunity</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">by_alias</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="n">exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="o">.</span><span class="n">person_ids</span><span class="p">:</span>
            <span class="n">payload</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;person_ids&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="o">.</span><span class="n">company_ids</span><span class="p">:</span>
            <span class="n">payload</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;organization_ids&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/opportunities&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Opportunity</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">OpportunityUpdate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Opportunity</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update an existing opportunity.</span>

<span class="sd">        Note: When provided, `person_ids` and `company_ids` replace the existing</span>
<span class="sd">        values. To add or remove associations safely, pass the full desired arrays.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span>
            <span class="n">by_alias</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">,</span>
            <span class="n">exclude_unset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Uses the v1 endpoint; its PUT semantics replace association arrays.</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/opportunities/</span><span class="si">{</span><span class="n">opportunity_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Opportunity</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete an opportunity.</span>

<span class="sd">        This removes the opportunity and all associated list entries.</span>

<span class="sd">        Args:</span>
<span class="sd">            opportunity_id: The opportunity to delete</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if successful</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/opportunities/</span><span class="si">{</span><span class="n">opportunity_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;success&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>

    <span class="c1"># =========================================================================</span>
    <span class="c1"># Association Methods (V1 API)</span>
    <span class="c1"># =========================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_associated_person_ids</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">PersonId</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get associated person IDs for an opportunity.</span>

<span class="sd">        V1-only: V2 does not expose opportunity -&gt; person associations.</span>
<span class="sd">        Uses GET `/opportunities/{id}` (V1) and returns `person_ids`.</span>

<span class="sd">        Args:</span>
<span class="sd">            opportunity_id: The opportunity ID</span>
<span class="sd">            max_results: Maximum number of person IDs to return</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of PersonId values associated with this opportunity</span>

<span class="sd">        See Also:</span>
<span class="sd">            - :meth:`get_associated_people`: Returns full Person objects</span>
<span class="sd">            - :meth:`get_associations`: Get both person and company IDs in one call</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/opportunities/</span><span class="si">{</span><span class="n">opportunity_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Defensive: V1 returns directly (not wrapped), but handle potential wrapper</span>
        <span class="c1"># for consistency with CompanyService pattern that handles &quot;organization&quot; wrapper</span>
        <span class="n">opportunity</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;opportunity&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">opportunity</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">opportunity</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">data</span>
        <span class="n">person_ids</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">person_ids</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;person_ids&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;personIds&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">person_ids</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">PersonId</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">pid</span><span class="p">))</span> <span class="k">for</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">person_ids</span> <span class="k">if</span> <span class="n">pid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">max_results</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_results</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ids</span><span class="p">[:</span><span class="n">max_results</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">ids</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_associated_people</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">Person</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get Person objects associated with an opportunity.</span>

<span class="sd">        Uses V2 batch lookup for efficiency (1 API call per 100 persons</span>
<span class="sd">        instead of 1 per person).</span>

<span class="sd">        Args:</span>
<span class="sd">            opportunity_id: The opportunity ID</span>
<span class="sd">            max_results: Maximum number of people to return</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of Person objects associated with this opportunity</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">person_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_associated_person_ids</span><span class="p">(</span><span class="n">opportunity_id</span><span class="p">,</span> <span class="n">max_results</span><span class="o">=</span><span class="n">max_results</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">person_ids</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="c1"># Use V2 batch lookup: GET /persons?ids=1&amp;ids=2&amp;ids=3</span>
        <span class="c1"># Note: person_ids is already truncated by get_associated_person_ids if max_results set</span>
        <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ids&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span> <span class="k">for</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">person_ids</span><span class="p">]}</span>

        <span class="n">people</span><span class="p">:</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">Person</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/persons&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>  <span class="c1"># V2 batch</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="n">people</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>

        <span class="c1"># Handle pagination if needed (&gt;100 persons)</span>
        <span class="c1"># Note: max_results check is defensive - person_ids was already truncated above</span>
        <span class="n">pagination</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pagination&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">next_url</span> <span class="o">=</span> <span class="n">pagination</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nextUrl&quot;</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">next_url</span> <span class="ow">and</span> <span class="p">(</span><span class="n">max_results</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">people</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">max_results</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get_url</span><span class="p">(</span><span class="n">next_url</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="n">people</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
            <span class="n">next_url</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pagination&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nextUrl&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">max_results</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">people</span><span class="p">[:</span><span class="n">max_results</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">people</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_associated_company_ids</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">CompanyId</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get associated company IDs for an opportunity.</span>

<span class="sd">        V1-only: V2 does not expose opportunity -&gt; company associations.</span>
<span class="sd">        Uses GET `/opportunities/{id}` (V1) and returns `organization_ids`.</span>

<span class="sd">        Args:</span>
<span class="sd">            opportunity_id: The opportunity ID</span>
<span class="sd">            max_results: Maximum number of company IDs to return</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of CompanyId values associated with this opportunity</span>

<span class="sd">        See Also:</span>
<span class="sd">            - :meth:`get_associated_companies`: Returns full Company objects</span>
<span class="sd">            - :meth:`get_associations`: Get both person and company IDs in one call</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/opportunities/</span><span class="si">{</span><span class="n">opportunity_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Defensive: V1 returns directly (not wrapped), but handle potential wrapper</span>
        <span class="c1"># for consistency with CompanyService pattern that handles &quot;organization&quot; wrapper</span>
        <span class="n">opportunity</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;opportunity&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">opportunity</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">opportunity</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">data</span>
        <span class="n">company_ids</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">company_ids</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organization_ids&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organizationIds&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">company_ids</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">CompanyId</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">cid</span><span class="p">))</span> <span class="k">for</span> <span class="n">cid</span> <span class="ow">in</span> <span class="n">company_ids</span> <span class="k">if</span> <span class="n">cid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">max_results</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_results</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ids</span><span class="p">[:</span><span class="n">max_results</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">ids</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_associated_companies</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">Company</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get Company objects associated with an opportunity.</span>

<span class="sd">        Uses V2 batch lookup for efficiency (1 API call per 100 companies</span>
<span class="sd">        instead of 1 per company).</span>

<span class="sd">        Args:</span>
<span class="sd">            opportunity_id: The opportunity ID</span>
<span class="sd">            max_results: Maximum number of companies to return</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of Company objects associated with this opportunity</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">company_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_associated_company_ids</span><span class="p">(</span><span class="n">opportunity_id</span><span class="p">,</span> <span class="n">max_results</span><span class="o">=</span><span class="n">max_results</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">company_ids</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="c1"># Use V2 batch lookup: GET /companies?ids=1&amp;ids=2&amp;ids=3</span>
        <span class="c1"># Note: company_ids is already truncated by get_associated_company_ids if max_results set</span>
        <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ids&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">cid</span><span class="p">)</span> <span class="k">for</span> <span class="n">cid</span> <span class="ow">in</span> <span class="n">company_ids</span><span class="p">]}</span>

        <span class="n">companies</span><span class="p">:</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">Company</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/companies&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>  <span class="c1"># V2 batch</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="n">companies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Company</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>

        <span class="c1"># Handle pagination if needed (&gt;100 companies)</span>
        <span class="c1"># Note: max_results check is defensive - company_ids was already truncated above</span>
        <span class="n">pagination</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pagination&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">next_url</span> <span class="o">=</span> <span class="n">pagination</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nextUrl&quot;</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">next_url</span> <span class="ow">and</span> <span class="p">(</span><span class="n">max_results</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">companies</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">max_results</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get_url</span><span class="p">(</span><span class="n">next_url</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="n">companies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Company</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
            <span class="n">next_url</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pagination&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nextUrl&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">max_results</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">companies</span><span class="p">[:</span><span class="n">max_results</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">companies</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_associations</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OpportunityAssociations</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get both person and company associations in a single V1 call.</span>

<span class="sd">        Use this when you need both types of associations to avoid</span>
<span class="sd">        duplicate API calls from separate get_associated_*_ids() calls.</span>

<span class="sd">        Args:</span>
<span class="sd">            opportunity_id: The opportunity ID</span>

<span class="sd">        Returns:</span>
<span class="sd">            OpportunityAssociations named tuple with person_ids and company_ids</span>

<span class="sd">        Example:</span>
<span class="sd">            assoc = client.opportunities.get_associations(opp_id)</span>
<span class="sd">            print(assoc.person_ids)   # IDE autocomplete works</span>
<span class="sd">            print(assoc.company_ids)  # IDE autocomplete works</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/opportunities/</span><span class="si">{</span><span class="n">opportunity_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Defensive: V1 returns directly (not wrapped), but handle potential wrapper</span>
        <span class="n">opportunity</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;opportunity&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">opportunity</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">opportunity</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">data</span>

        <span class="n">person_ids</span><span class="p">:</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">PersonId</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">company_ids</span><span class="p">:</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">CompanyId</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">raw_person_ids</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;person_ids&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;personIds&quot;</span><span class="p">)</span>
            <span class="n">raw_company_ids</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organization_ids&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organizationIds&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">raw_person_ids</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">person_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">PersonId</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">pid</span><span class="p">))</span> <span class="k">for</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">raw_person_ids</span> <span class="k">if</span> <span class="n">pid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">raw_company_ids</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">company_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">CompanyId</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">cid</span><span class="p">))</span> <span class="k">for</span> <span class="n">cid</span> <span class="ow">in</span> <span class="n">raw_company_ids</span> <span class="k">if</span> <span class="n">cid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">OpportunityAssociations</span><span class="p">(</span><span class="n">person_ids</span><span class="o">=</span><span class="n">person_ids</span><span class="p">,</span> <span class="n">company_ids</span><span class="o">=</span><span class="n">company_ids</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_associated_person_ids_batch</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">opportunity_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">],</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">on_error</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;raise&quot;</span><span class="p">,</span> <span class="s2">&quot;skip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;raise&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">PersonId</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get person associations for multiple opportunities.</span>

<span class="sd">        Makes one V1 API call per opportunity. Useful for iterating list entries</span>
<span class="sd">        where V2 returns empty person_ids.</span>

<span class="sd">        Args:</span>
<span class="sd">            opportunity_ids: Sequence of opportunity IDs to fetch</span>
<span class="sd">            on_error: How to handle errors - &quot;raise&quot; (default) or &quot;skip&quot; failed IDs</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict mapping opportunity_id -&gt; list of person_ids</span>

<span class="sd">        Raises:</span>
<span class="sd">            AffinityError: If on_error=&quot;raise&quot; and any fetch fails. The exception</span>
<span class="sd">                includes the failing opportunity_id in its context.</span>

<span class="sd">        Example:</span>
<span class="sd">            # Get all persons from an opportunity list</span>
<span class="sd">            opp_ids = [entry.entity.id for entry in client.lists.entries(list_id).all()]</span>
<span class="sd">            associations = client.opportunities.get_associated_person_ids_batch(opp_ids)</span>
<span class="sd">            all_person_ids = set()</span>
<span class="sd">            for person_ids in associations.values():</span>
<span class="sd">                all_person_ids.update(person_ids)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">PersonId</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">opp_id</span> <span class="ow">in</span> <span class="n">opportunity_ids</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="n">opp_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_associated_person_ids</span><span class="p">(</span><span class="n">opp_id</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">AffinityError</span><span class="p">:</span>
                <span class="c1"># Re-raise SDK errors directly - they already have good context</span>
                <span class="k">if</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s2">&quot;raise&quot;</span><span class="p">:</span>
                    <span class="k">raise</span>
                <span class="c1"># skip: continue without this opportunity</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s2">&quot;raise&quot;</span><span class="p">:</span>
                    <span class="c1"># Wrap non-SDK errors with context, preserving chain</span>
                    <span class="k">raise</span> <span class="n">AffinityError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Failed to get associations for opportunity </span><span class="si">{</span><span class="n">opp_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
                <span class="c1"># skip: continue without this opportunity</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_associated_company_ids_batch</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">opportunity_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">],</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">on_error</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;raise&quot;</span><span class="p">,</span> <span class="s2">&quot;skip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;raise&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">CompanyId</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get company associations for multiple opportunities.</span>

<span class="sd">        Makes one V1 API call per opportunity. Useful for iterating list entries</span>
<span class="sd">        where V2 returns empty company_ids.</span>

<span class="sd">        Args:</span>
<span class="sd">            opportunity_ids: Sequence of opportunity IDs to fetch</span>
<span class="sd">            on_error: How to handle errors - &quot;raise&quot; (default) or &quot;skip&quot; failed IDs</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict mapping opportunity_id -&gt; list of company_ids</span>

<span class="sd">        Raises:</span>
<span class="sd">            AffinityError: If on_error=&quot;raise&quot; and any fetch fails. The exception</span>
<span class="sd">                includes the failing opportunity_id in its context.</span>

<span class="sd">        Example:</span>
<span class="sd">            # Get all companies from an opportunity list</span>
<span class="sd">            opp_ids = [entry.entity.id for entry in client.lists.entries(list_id).all()]</span>
<span class="sd">            associations = client.opportunities.get_associated_company_ids_batch(opp_ids)</span>
<span class="sd">            all_company_ids = set()</span>
<span class="sd">            for company_ids in associations.values():</span>
<span class="sd">                all_company_ids.update(company_ids)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">CompanyId</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">opp_id</span> <span class="ow">in</span> <span class="n">opportunity_ids</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="n">opp_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_associated_company_ids</span><span class="p">(</span><span class="n">opp_id</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">AffinityError</span><span class="p">:</span>
                <span class="c1"># Re-raise SDK errors directly - they already have good context</span>
                <span class="k">if</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s2">&quot;raise&quot;</span><span class="p">:</span>
                    <span class="k">raise</span>
                <span class="c1"># skip: continue without this opportunity</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s2">&quot;raise&quot;</span><span class="p">:</span>
                    <span class="c1"># Wrap non-SDK errors with context, preserving chain</span>
                    <span class="k">raise</span> <span class="n">AffinityError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Failed to get company associations for opportunity </span><span class="si">{</span><span class="n">opp_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
                <span class="c1"># skip: continue without this opportunity</span>
        <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="affinity.services.opportunities.OpportunityService.all" class="doc doc-heading">
            <code class="highlight language-python"><span class="nb">all</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]</span></code>

<a href="#affinity.services.opportunities.OpportunityService.all" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Iterate through all opportunities with automatic pagination.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ids</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="affinity.models.types.OpportunityId">OpportunityId</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Specific opportunity IDs to fetch (batch lookup)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/opportunities.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">all</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Iterate through all opportunities with automatic pagination.</span>

<span class="sd">    Args:</span>
<span class="sd">        ids: Specific opportunity IDs to fetch (batch lookup)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fetch_page</span><span class="p">(</span><span class="n">next_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">next_url</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get_url</span><span class="p">(</span><span class="n">next_url</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">](</span>
                <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">Opportunity</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">[])],</span>
                <span class="n">pagination</span><span class="o">=</span><span class="n">PaginationInfo</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pagination&quot;</span><span class="p">,</span> <span class="p">{})),</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">ids</span><span class="o">=</span><span class="n">ids</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">PageIterator</span><span class="p">(</span><span class="n">fetch_page</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.opportunities.OpportunityService.create" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">OpportunityCreate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Opportunity</span></code>

<a href="#affinity.services.opportunities.OpportunityService.create" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Create a new opportunity.</p>
<p>The opportunity will be added to the specified list.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="OpportunityCreate (affinity.models.entities.OpportunityCreate)" href="../../models/#affinity.models.OpportunityCreate">OpportunityCreate</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Opportunity creation data including list_id and name</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="Opportunity (affinity.models.entities.Opportunity)" href="../../models/#affinity.models.Opportunity">Opportunity</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The created opportunity</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/opportunities.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">OpportunityCreate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Opportunity</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a new opportunity.</span>

<span class="sd">    The opportunity will be added to the specified list.</span>

<span class="sd">    Args:</span>
<span class="sd">        data: Opportunity creation data including list_id and name</span>

<span class="sd">    Returns:</span>
<span class="sd">        The created opportunity</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">by_alias</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="n">exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="o">.</span><span class="n">person_ids</span><span class="p">:</span>
        <span class="n">payload</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;person_ids&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="o">.</span><span class="n">company_ids</span><span class="p">:</span>
        <span class="n">payload</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;organization_ids&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/opportunities&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Opportunity</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.opportunities.OpportunityService.delete" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete</span><span class="p">(</span><span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span></code>

<a href="#affinity.services.opportunities.OpportunityService.delete" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Delete an opportunity.</p>
<p>This removes the opportunity and all associated list entries.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>opportunity_id</code>
            </td>
            <td>
                  <code><span title="affinity.models.types.OpportunityId">OpportunityId</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The opportunity to delete</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if successful</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/opportunities.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delete an opportunity.</span>

<span class="sd">    This removes the opportunity and all associated list entries.</span>

<span class="sd">    Args:</span>
<span class="sd">        opportunity_id: The opportunity to delete</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if successful</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/opportunities/</span><span class="si">{</span><span class="n">opportunity_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;success&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.opportunities.OpportunityService.get" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get</span><span class="p">(</span><span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Opportunity</span></code>

<a href="#affinity.services.opportunities.OpportunityService.get" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Get a single opportunity by ID.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>opportunity_id</code>
            </td>
            <td>
                  <code><span title="affinity.models.types.OpportunityId">OpportunityId</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The opportunity ID</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>retries</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of retries on 404 NotFoundError. Default is 0 (fail fast).
Set to 2-3 if calling immediately after create() to handle V1V2
eventual consistency lag.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="Opportunity (affinity.models.entities.Opportunity)" href="../../models/#affinity.models.Opportunity">Opportunity</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The opportunity representation returned by v2 (may be partial).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="NotFoundError (affinity.exceptions.NotFoundError)" href="../../exceptions/#affinity.exceptions.NotFoundError">NotFoundError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If opportunity does not exist after all retries.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/opportunities.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Opportunity</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a single opportunity by ID.</span>

<span class="sd">    Args:</span>
<span class="sd">        opportunity_id: The opportunity ID</span>
<span class="sd">        retries: Number of retries on 404 NotFoundError. Default is 0 (fail fast).</span>
<span class="sd">            Set to 2-3 if calling immediately after create() to handle V1V2</span>
<span class="sd">            eventual consistency lag.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The opportunity representation returned by v2 (may be partial).</span>

<span class="sd">    Raises:</span>
<span class="sd">        NotFoundError: If opportunity does not exist after all retries.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">last_error</span><span class="p">:</span> <span class="n">NotFoundError</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">attempts</span> <span class="o">=</span> <span class="n">retries</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># retries=0 means 1 attempt</span>

    <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">attempts</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/opportunities/</span><span class="si">{</span><span class="n">opportunity_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Opportunity</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">NotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">last_error</span> <span class="o">=</span> <span class="n">e</span>
            <span class="k">if</span> <span class="n">attempt</span> <span class="o">&lt;</span> <span class="n">attempts</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Don&#39;t sleep after last attempt</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">attempt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>  <span class="c1"># 0.5s, 1s, 1.5s backoff</span>

    <span class="k">raise</span> <span class="n">last_error</span>  <span class="c1"># type: ignore[misc]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.opportunities.OpportunityService.get_associated_companies" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_associated_companies</span><span class="p">(</span><span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">Company</span><span class="p">]</span></code>

<a href="#affinity.services.opportunities.OpportunityService.get_associated_companies" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Get Company objects associated with an opportunity.</p>
<p>Uses V2 batch lookup for efficiency (1 API call per 100 companies
instead of 1 per company).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>opportunity_id</code>
            </td>
            <td>
                  <code><span title="affinity.models.types.OpportunityId">OpportunityId</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The opportunity ID</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_results</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of companies to return</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="builtins.list">list</span>[<a class="autorefs autorefs-internal" title="Company (affinity.models.entities.Company)" href="../../models/#affinity.models.Company">Company</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of Company objects associated with this opportunity</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/opportunities.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_associated_companies</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">Company</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get Company objects associated with an opportunity.</span>

<span class="sd">    Uses V2 batch lookup for efficiency (1 API call per 100 companies</span>
<span class="sd">    instead of 1 per company).</span>

<span class="sd">    Args:</span>
<span class="sd">        opportunity_id: The opportunity ID</span>
<span class="sd">        max_results: Maximum number of companies to return</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of Company objects associated with this opportunity</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">company_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_associated_company_ids</span><span class="p">(</span><span class="n">opportunity_id</span><span class="p">,</span> <span class="n">max_results</span><span class="o">=</span><span class="n">max_results</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">company_ids</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="c1"># Use V2 batch lookup: GET /companies?ids=1&amp;ids=2&amp;ids=3</span>
    <span class="c1"># Note: company_ids is already truncated by get_associated_company_ids if max_results set</span>
    <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ids&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">cid</span><span class="p">)</span> <span class="k">for</span> <span class="n">cid</span> <span class="ow">in</span> <span class="n">company_ids</span><span class="p">]}</span>

    <span class="n">companies</span><span class="p">:</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">Company</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/companies&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>  <span class="c1"># V2 batch</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">[]):</span>
        <span class="n">companies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Company</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>

    <span class="c1"># Handle pagination if needed (&gt;100 companies)</span>
    <span class="c1"># Note: max_results check is defensive - company_ids was already truncated above</span>
    <span class="n">pagination</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pagination&quot;</span><span class="p">,</span> <span class="p">{})</span>
    <span class="n">next_url</span> <span class="o">=</span> <span class="n">pagination</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nextUrl&quot;</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">next_url</span> <span class="ow">and</span> <span class="p">(</span><span class="n">max_results</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">companies</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">max_results</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get_url</span><span class="p">(</span><span class="n">next_url</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="n">companies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Company</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
        <span class="n">next_url</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pagination&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nextUrl&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">max_results</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">companies</span><span class="p">[:</span><span class="n">max_results</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">companies</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.opportunities.OpportunityService.get_associated_company_ids" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_associated_company_ids</span><span class="p">(</span><span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">CompanyId</span><span class="p">]</span></code>

<a href="#affinity.services.opportunities.OpportunityService.get_associated_company_ids" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Get associated company IDs for an opportunity.</p>
<p>V1-only: V2 does not expose opportunity -&gt; company associations.
Uses GET <code>/opportunities/{id}</code> (V1) and returns <code>organization_ids</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>opportunity_id</code>
            </td>
            <td>
                  <code><span title="affinity.models.types.OpportunityId">OpportunityId</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The opportunity ID</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_results</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of company IDs to return</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="builtins.list">list</span>[<a class="autorefs autorefs-internal" title="CompanyId (affinity.models.types.CompanyId)" href="../../types/#affinity.types.CompanyId">CompanyId</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of CompanyId values associated with this opportunity</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="see-also" open>
  <summary>See Also</summary>
  <ul>
<li>:meth:<code>get_associated_companies</code>: Returns full Company objects</li>
<li>:meth:<code>get_associations</code>: Get both person and company IDs in one call</li>
</ul>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/opportunities.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_associated_company_ids</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">CompanyId</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get associated company IDs for an opportunity.</span>

<span class="sd">    V1-only: V2 does not expose opportunity -&gt; company associations.</span>
<span class="sd">    Uses GET `/opportunities/{id}` (V1) and returns `organization_ids`.</span>

<span class="sd">    Args:</span>
<span class="sd">        opportunity_id: The opportunity ID</span>
<span class="sd">        max_results: Maximum number of company IDs to return</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of CompanyId values associated with this opportunity</span>

<span class="sd">    See Also:</span>
<span class="sd">        - :meth:`get_associated_companies`: Returns full Company objects</span>
<span class="sd">        - :meth:`get_associations`: Get both person and company IDs in one call</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/opportunities/</span><span class="si">{</span><span class="n">opportunity_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Defensive: V1 returns directly (not wrapped), but handle potential wrapper</span>
    <span class="c1"># for consistency with CompanyService pattern that handles &quot;organization&quot; wrapper</span>
    <span class="n">opportunity</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;opportunity&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">opportunity</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">opportunity</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">data</span>
    <span class="n">company_ids</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">company_ids</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organization_ids&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organizationIds&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">company_ids</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">CompanyId</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">cid</span><span class="p">))</span> <span class="k">for</span> <span class="n">cid</span> <span class="ow">in</span> <span class="n">company_ids</span> <span class="k">if</span> <span class="n">cid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">max_results</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_results</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ids</span><span class="p">[:</span><span class="n">max_results</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ids</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.opportunities.OpportunityService.get_associated_company_ids_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_associated_company_ids_batch</span><span class="p">(</span><span class="n">opportunity_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">],</span> <span class="o">*</span><span class="p">,</span> <span class="n">on_error</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;raise&#39;</span><span class="p">,</span> <span class="s1">&#39;skip&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;raise&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">CompanyId</span><span class="p">]]</span></code>

<a href="#affinity.services.opportunities.OpportunityService.get_associated_company_ids_batch" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Get company associations for multiple opportunities.</p>
<p>Makes one V1 API call per opportunity. Useful for iterating list entries
where V2 returns empty company_ids.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>opportunity_ids</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="affinity.models.types.OpportunityId">OpportunityId</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sequence of opportunity IDs to fetch</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>on_error</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;raise&#39;, &#39;skip&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How to handle errors - "raise" (default) or "skip" failed IDs</p>
              </div>
            </td>
            <td>
                  <code>&#39;raise&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="affinity.models.types.OpportunityId">OpportunityId</span>, <span title="builtins.list">list</span>[<a class="autorefs autorefs-internal" title="CompanyId (affinity.models.types.CompanyId)" href="../../types/#affinity.types.CompanyId">CompanyId</a>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict mapping opportunity_id -&gt; list of company_ids</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="AffinityError (affinity.exceptions.AffinityError)" href="../../exceptions/#affinity.exceptions.AffinityError">AffinityError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If on_error="raise" and any fetch fails. The exception
includes the failing opportunity_id in its context.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <h3 id="affinity.services.opportunities.OpportunityService.get_associated_company_ids_batch--get-all-companies-from-an-opportunity-list">Get all companies from an opportunity list<a class="headerlink" href="#affinity.services.opportunities.OpportunityService.get_associated_company_ids_batch--get-all-companies-from-an-opportunity-list" title="Permanent link">&para;</a></h3>
<p>opp_ids = [entry.entity.id for entry in client.lists.entries(list_id).all()]
associations = client.opportunities.get_associated_company_ids_batch(opp_ids)
all_company_ids = set()
for company_ids in associations.values():
    all_company_ids.update(company_ids)</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/opportunities.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_associated_company_ids_batch</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">opportunity_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">on_error</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;raise&quot;</span><span class="p">,</span> <span class="s2">&quot;skip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;raise&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">CompanyId</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get company associations for multiple opportunities.</span>

<span class="sd">    Makes one V1 API call per opportunity. Useful for iterating list entries</span>
<span class="sd">    where V2 returns empty company_ids.</span>

<span class="sd">    Args:</span>
<span class="sd">        opportunity_ids: Sequence of opportunity IDs to fetch</span>
<span class="sd">        on_error: How to handle errors - &quot;raise&quot; (default) or &quot;skip&quot; failed IDs</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dict mapping opportunity_id -&gt; list of company_ids</span>

<span class="sd">    Raises:</span>
<span class="sd">        AffinityError: If on_error=&quot;raise&quot; and any fetch fails. The exception</span>
<span class="sd">            includes the failing opportunity_id in its context.</span>

<span class="sd">    Example:</span>
<span class="sd">        # Get all companies from an opportunity list</span>
<span class="sd">        opp_ids = [entry.entity.id for entry in client.lists.entries(list_id).all()]</span>
<span class="sd">        associations = client.opportunities.get_associated_company_ids_batch(opp_ids)</span>
<span class="sd">        all_company_ids = set()</span>
<span class="sd">        for company_ids in associations.values():</span>
<span class="sd">            all_company_ids.update(company_ids)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">CompanyId</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">opp_id</span> <span class="ow">in</span> <span class="n">opportunity_ids</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="n">opp_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_associated_company_ids</span><span class="p">(</span><span class="n">opp_id</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">AffinityError</span><span class="p">:</span>
            <span class="c1"># Re-raise SDK errors directly - they already have good context</span>
            <span class="k">if</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s2">&quot;raise&quot;</span><span class="p">:</span>
                <span class="k">raise</span>
            <span class="c1"># skip: continue without this opportunity</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s2">&quot;raise&quot;</span><span class="p">:</span>
                <span class="c1"># Wrap non-SDK errors with context, preserving chain</span>
                <span class="k">raise</span> <span class="n">AffinityError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Failed to get company associations for opportunity </span><span class="si">{</span><span class="n">opp_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
            <span class="c1"># skip: continue without this opportunity</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.opportunities.OpportunityService.get_associated_people" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_associated_people</span><span class="p">(</span><span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">Person</span><span class="p">]</span></code>

<a href="#affinity.services.opportunities.OpportunityService.get_associated_people" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Get Person objects associated with an opportunity.</p>
<p>Uses V2 batch lookup for efficiency (1 API call per 100 persons
instead of 1 per person).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>opportunity_id</code>
            </td>
            <td>
                  <code><span title="affinity.models.types.OpportunityId">OpportunityId</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The opportunity ID</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_results</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of people to return</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="builtins.list">list</span>[<a class="autorefs autorefs-internal" title="Person (affinity.models.entities.Person)" href="../../models/#affinity.models.Person">Person</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of Person objects associated with this opportunity</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/opportunities.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_associated_people</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">Person</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get Person objects associated with an opportunity.</span>

<span class="sd">    Uses V2 batch lookup for efficiency (1 API call per 100 persons</span>
<span class="sd">    instead of 1 per person).</span>

<span class="sd">    Args:</span>
<span class="sd">        opportunity_id: The opportunity ID</span>
<span class="sd">        max_results: Maximum number of people to return</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of Person objects associated with this opportunity</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">person_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_associated_person_ids</span><span class="p">(</span><span class="n">opportunity_id</span><span class="p">,</span> <span class="n">max_results</span><span class="o">=</span><span class="n">max_results</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">person_ids</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="c1"># Use V2 batch lookup: GET /persons?ids=1&amp;ids=2&amp;ids=3</span>
    <span class="c1"># Note: person_ids is already truncated by get_associated_person_ids if max_results set</span>
    <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ids&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span> <span class="k">for</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">person_ids</span><span class="p">]}</span>

    <span class="n">people</span><span class="p">:</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">Person</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/persons&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>  <span class="c1"># V2 batch</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">[]):</span>
        <span class="n">people</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>

    <span class="c1"># Handle pagination if needed (&gt;100 persons)</span>
    <span class="c1"># Note: max_results check is defensive - person_ids was already truncated above</span>
    <span class="n">pagination</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pagination&quot;</span><span class="p">,</span> <span class="p">{})</span>
    <span class="n">next_url</span> <span class="o">=</span> <span class="n">pagination</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nextUrl&quot;</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">next_url</span> <span class="ow">and</span> <span class="p">(</span><span class="n">max_results</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">people</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">max_results</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get_url</span><span class="p">(</span><span class="n">next_url</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="n">people</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
        <span class="n">next_url</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pagination&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nextUrl&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">max_results</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">people</span><span class="p">[:</span><span class="n">max_results</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">people</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.opportunities.OpportunityService.get_associated_person_ids" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_associated_person_ids</span><span class="p">(</span><span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">PersonId</span><span class="p">]</span></code>

<a href="#affinity.services.opportunities.OpportunityService.get_associated_person_ids" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Get associated person IDs for an opportunity.</p>
<p>V1-only: V2 does not expose opportunity -&gt; person associations.
Uses GET <code>/opportunities/{id}</code> (V1) and returns <code>person_ids</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>opportunity_id</code>
            </td>
            <td>
                  <code><span title="affinity.models.types.OpportunityId">OpportunityId</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The opportunity ID</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_results</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of person IDs to return</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="builtins.list">list</span>[<span title="affinity.models.types.PersonId">PersonId</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of PersonId values associated with this opportunity</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="see-also" open>
  <summary>See Also</summary>
  <ul>
<li>:meth:<code>get_associated_people</code>: Returns full Person objects</li>
<li>:meth:<code>get_associations</code>: Get both person and company IDs in one call</li>
</ul>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/opportunities.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_associated_person_ids</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">PersonId</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get associated person IDs for an opportunity.</span>

<span class="sd">    V1-only: V2 does not expose opportunity -&gt; person associations.</span>
<span class="sd">    Uses GET `/opportunities/{id}` (V1) and returns `person_ids`.</span>

<span class="sd">    Args:</span>
<span class="sd">        opportunity_id: The opportunity ID</span>
<span class="sd">        max_results: Maximum number of person IDs to return</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of PersonId values associated with this opportunity</span>

<span class="sd">    See Also:</span>
<span class="sd">        - :meth:`get_associated_people`: Returns full Person objects</span>
<span class="sd">        - :meth:`get_associations`: Get both person and company IDs in one call</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/opportunities/</span><span class="si">{</span><span class="n">opportunity_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Defensive: V1 returns directly (not wrapped), but handle potential wrapper</span>
    <span class="c1"># for consistency with CompanyService pattern that handles &quot;organization&quot; wrapper</span>
    <span class="n">opportunity</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;opportunity&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">opportunity</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">opportunity</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">data</span>
    <span class="n">person_ids</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">person_ids</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;person_ids&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;personIds&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">person_ids</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">PersonId</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">pid</span><span class="p">))</span> <span class="k">for</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">person_ids</span> <span class="k">if</span> <span class="n">pid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">max_results</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_results</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ids</span><span class="p">[:</span><span class="n">max_results</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ids</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.opportunities.OpportunityService.get_associated_person_ids_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_associated_person_ids_batch</span><span class="p">(</span><span class="n">opportunity_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">],</span> <span class="o">*</span><span class="p">,</span> <span class="n">on_error</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;raise&#39;</span><span class="p">,</span> <span class="s1">&#39;skip&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;raise&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">PersonId</span><span class="p">]]</span></code>

<a href="#affinity.services.opportunities.OpportunityService.get_associated_person_ids_batch" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Get person associations for multiple opportunities.</p>
<p>Makes one V1 API call per opportunity. Useful for iterating list entries
where V2 returns empty person_ids.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>opportunity_ids</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="affinity.models.types.OpportunityId">OpportunityId</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sequence of opportunity IDs to fetch</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>on_error</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;raise&#39;, &#39;skip&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How to handle errors - "raise" (default) or "skip" failed IDs</p>
              </div>
            </td>
            <td>
                  <code>&#39;raise&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="affinity.models.types.OpportunityId">OpportunityId</span>, <span title="builtins.list">list</span>[<span title="affinity.models.types.PersonId">PersonId</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict mapping opportunity_id -&gt; list of person_ids</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="AffinityError (affinity.exceptions.AffinityError)" href="../../exceptions/#affinity.exceptions.AffinityError">AffinityError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If on_error="raise" and any fetch fails. The exception
includes the failing opportunity_id in its context.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <h3 id="affinity.services.opportunities.OpportunityService.get_associated_person_ids_batch--get-all-persons-from-an-opportunity-list">Get all persons from an opportunity list<a class="headerlink" href="#affinity.services.opportunities.OpportunityService.get_associated_person_ids_batch--get-all-persons-from-an-opportunity-list" title="Permanent link">&para;</a></h3>
<p>opp_ids = [entry.entity.id for entry in client.lists.entries(list_id).all()]
associations = client.opportunities.get_associated_person_ids_batch(opp_ids)
all_person_ids = set()
for person_ids in associations.values():
    all_person_ids.update(person_ids)</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/opportunities.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_associated_person_ids_batch</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">opportunity_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">on_error</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;raise&quot;</span><span class="p">,</span> <span class="s2">&quot;skip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;raise&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">PersonId</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get person associations for multiple opportunities.</span>

<span class="sd">    Makes one V1 API call per opportunity. Useful for iterating list entries</span>
<span class="sd">    where V2 returns empty person_ids.</span>

<span class="sd">    Args:</span>
<span class="sd">        opportunity_ids: Sequence of opportunity IDs to fetch</span>
<span class="sd">        on_error: How to handle errors - &quot;raise&quot; (default) or &quot;skip&quot; failed IDs</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dict mapping opportunity_id -&gt; list of person_ids</span>

<span class="sd">    Raises:</span>
<span class="sd">        AffinityError: If on_error=&quot;raise&quot; and any fetch fails. The exception</span>
<span class="sd">            includes the failing opportunity_id in its context.</span>

<span class="sd">    Example:</span>
<span class="sd">        # Get all persons from an opportunity list</span>
<span class="sd">        opp_ids = [entry.entity.id for entry in client.lists.entries(list_id).all()]</span>
<span class="sd">        associations = client.opportunities.get_associated_person_ids_batch(opp_ids)</span>
<span class="sd">        all_person_ids = set()</span>
<span class="sd">        for person_ids in associations.values():</span>
<span class="sd">            all_person_ids.update(person_ids)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">PersonId</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">opp_id</span> <span class="ow">in</span> <span class="n">opportunity_ids</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="n">opp_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_associated_person_ids</span><span class="p">(</span><span class="n">opp_id</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">AffinityError</span><span class="p">:</span>
            <span class="c1"># Re-raise SDK errors directly - they already have good context</span>
            <span class="k">if</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s2">&quot;raise&quot;</span><span class="p">:</span>
                <span class="k">raise</span>
            <span class="c1"># skip: continue without this opportunity</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s2">&quot;raise&quot;</span><span class="p">:</span>
                <span class="c1"># Wrap non-SDK errors with context, preserving chain</span>
                <span class="k">raise</span> <span class="n">AffinityError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Failed to get associations for opportunity </span><span class="si">{</span><span class="n">opp_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
            <span class="c1"># skip: continue without this opportunity</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.opportunities.OpportunityService.get_associations" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_associations</span><span class="p">(</span><span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OpportunityAssociations</span></code>

<a href="#affinity.services.opportunities.OpportunityService.get_associations" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Get both person and company associations in a single V1 call.</p>
<p>Use this when you need both types of associations to avoid
duplicate API calls from separate get_associated_*_ids() calls.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>opportunity_id</code>
            </td>
            <td>
                  <code><span title="affinity.models.types.OpportunityId">OpportunityId</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The opportunity ID</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="affinity.services.opportunities.OpportunityAssociations">OpportunityAssociations</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>OpportunityAssociations named tuple with person_ids and company_ids</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <p>assoc = client.opportunities.get_associations(opp_id)
print(assoc.person_ids)   # IDE autocomplete works
print(assoc.company_ids)  # IDE autocomplete works</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/opportunities.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_associations</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OpportunityAssociations</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get both person and company associations in a single V1 call.</span>

<span class="sd">    Use this when you need both types of associations to avoid</span>
<span class="sd">    duplicate API calls from separate get_associated_*_ids() calls.</span>

<span class="sd">    Args:</span>
<span class="sd">        opportunity_id: The opportunity ID</span>

<span class="sd">    Returns:</span>
<span class="sd">        OpportunityAssociations named tuple with person_ids and company_ids</span>

<span class="sd">    Example:</span>
<span class="sd">        assoc = client.opportunities.get_associations(opp_id)</span>
<span class="sd">        print(assoc.person_ids)   # IDE autocomplete works</span>
<span class="sd">        print(assoc.company_ids)  # IDE autocomplete works</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/opportunities/</span><span class="si">{</span><span class="n">opportunity_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Defensive: V1 returns directly (not wrapped), but handle potential wrapper</span>
    <span class="n">opportunity</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;opportunity&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">opportunity</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">opportunity</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">data</span>

    <span class="n">person_ids</span><span class="p">:</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">PersonId</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">company_ids</span><span class="p">:</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">CompanyId</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">raw_person_ids</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;person_ids&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;personIds&quot;</span><span class="p">)</span>
        <span class="n">raw_company_ids</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organization_ids&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organizationIds&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">raw_person_ids</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">person_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">PersonId</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">pid</span><span class="p">))</span> <span class="k">for</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">raw_person_ids</span> <span class="k">if</span> <span class="n">pid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">raw_company_ids</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">company_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">CompanyId</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">cid</span><span class="p">))</span> <span class="k">for</span> <span class="n">cid</span> <span class="ow">in</span> <span class="n">raw_company_ids</span> <span class="k">if</span> <span class="n">cid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">OpportunityAssociations</span><span class="p">(</span><span class="n">person_ids</span><span class="o">=</span><span class="n">person_ids</span><span class="p">,</span> <span class="n">company_ids</span><span class="o">=</span><span class="n">company_ids</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.opportunities.OpportunityService.get_details" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_details</span><span class="p">(</span><span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Opportunity</span></code>

<a href="#affinity.services.opportunities.OpportunityService.get_details" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Get a single opportunity by ID with a more complete representation.</p>
<p>Includes association IDs and (when present) list entries, which are not
always included in the default <code>get()</code> response.</p>


<details class="see-also" open>
  <summary>See Also</summary>
  <ul>
<li>:meth:<code>get_associated_person_ids</code>: Get just person IDs (single API call)</li>
<li>:meth:<code>get_associated_people</code>: Get full Person objects</li>
<li>:meth:<code>get_associated_company_ids</code>: Get just company IDs (single API call)</li>
<li>:meth:<code>get_associated_companies</code>: Get full Company objects</li>
<li>:meth:<code>get_associations</code>: Get both person and company IDs in one call</li>
</ul>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/opportunities.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_details</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Opportunity</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a single opportunity by ID with a more complete representation.</span>

<span class="sd">    Includes association IDs and (when present) list entries, which are not</span>
<span class="sd">    always included in the default `get()` response.</span>

<span class="sd">    See Also:</span>
<span class="sd">        - :meth:`get_associated_person_ids`: Get just person IDs (single API call)</span>
<span class="sd">        - :meth:`get_associated_people`: Get full Person objects</span>
<span class="sd">        - :meth:`get_associated_company_ids`: Get just company IDs (single API call)</span>
<span class="sd">        - :meth:`get_associated_companies`: Get full Company objects</span>
<span class="sd">        - :meth:`get_associations`: Get both person and company IDs in one call</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Uses the v1 endpoint because it returns a fuller payload (including</span>
    <span class="c1"># association IDs and, when present, list entries).</span>
    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/opportunities/</span><span class="si">{</span><span class="n">opportunity_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Opportunity</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.opportunities.OpportunityService.iter" class="doc doc-heading">
            <code class="highlight language-python"><span class="nb">iter</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]</span></code>

<a href="#affinity.services.opportunities.OpportunityService.iter" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Auto-paginate all opportunities.</p>
<p>Alias for <code>all()</code> (FR-006 public contract).</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/opportunities.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">iter</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Auto-paginate all opportunities.</span>

<span class="sd">    Alias for `all()` (FR-006 public contract).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">ids</span><span class="o">=</span><span class="n">ids</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.opportunities.OpportunityService.list" class="doc doc-heading">
            <code class="highlight language-python"><span class="nb">list</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cursor</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]</span></code>

<a href="#affinity.services.opportunities.OpportunityService.list" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>List all opportunities.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ids</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="affinity.models.types.OpportunityId">OpportunityId</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Specific opportunity IDs to fetch (batch lookup)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>limit</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of results per page</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cursor</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cursor to resume pagination (opaque; obtained from prior responses)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns the v2 opportunity representation (which may be partial).
For full opportunity row data, use list entries explicitly.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/opportunities.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">cursor</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    List all opportunities.</span>

<span class="sd">    Args:</span>
<span class="sd">        ids: Specific opportunity IDs to fetch (batch lookup)</span>
<span class="sd">        limit: Maximum number of results per page</span>
<span class="sd">        cursor: Cursor to resume pagination (opaque; obtained from prior responses)</span>

<span class="sd">    Returns the v2 opportunity representation (which may be partial).</span>
<span class="sd">    For full opportunity row data, use list entries explicitly.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">cursor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">limit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot combine &#39;cursor&#39; with other parameters; cursor encodes all query &quot;</span>
                <span class="s2">&quot;context. Start a new pagination sequence without a cursor to change &quot;</span>
                <span class="s2">&quot;parameters.&quot;</span>
            <span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get_url</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">ids</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;ids&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span> <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">limit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;limit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">limit</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/opportunities&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">](</span>
        <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">Opportunity</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">[])],</span>
        <span class="n">pagination</span><span class="o">=</span><span class="n">PaginationInfo</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pagination&quot;</span><span class="p">,</span> <span class="p">{})),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.opportunities.OpportunityService.pages" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pages</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cursor</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]]</span></code>

<a href="#affinity.services.opportunities.OpportunityService.pages" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Iterate opportunity pages (not items), yielding <code>PaginatedResponse[Opportunity]</code>.</p>
<p>This is useful for ETL scripts that want checkpoint/resume via <code>page.next_cursor</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ids</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="affinity.models.types.OpportunityId">OpportunityId</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Specific opportunity IDs to fetch (batch lookup)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>limit</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum results per page</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cursor</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cursor to resume pagination</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/opportunities.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pages</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">cursor</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Iterate opportunity pages (not items), yielding `PaginatedResponse[Opportunity]`.</span>

<span class="sd">    This is useful for ETL scripts that want checkpoint/resume via `page.next_cursor`.</span>

<span class="sd">    Args:</span>
<span class="sd">        ids: Specific opportunity IDs to fetch (batch lookup)</span>
<span class="sd">        limit: Maximum results per page</span>
<span class="sd">        cursor: Cursor to resume pagination</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">other_params</span> <span class="o">=</span> <span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cursor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="n">p</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">other_params</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Cannot combine &#39;cursor&#39; with other parameters; cursor encodes all query context. &quot;</span>
            <span class="s2">&quot;Start a new pagination sequence without a cursor to change parameters.&quot;</span>
        <span class="p">)</span>
    <span class="n">requested_cursor</span> <span class="o">=</span> <span class="n">cursor</span>
    <span class="n">page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">cursor</span><span class="o">=</span><span class="n">cursor</span><span class="p">)</span> <span class="k">if</span> <span class="n">cursor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">ids</span><span class="o">=</span><span class="n">ids</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">page</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">page</span><span class="o">.</span><span class="n">has_next</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">next_cursor</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">next_cursor</span>
        <span class="k">if</span> <span class="n">next_cursor</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">next_cursor</span> <span class="o">==</span> <span class="n">requested_cursor</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">requested_cursor</span> <span class="o">=</span> <span class="n">next_cursor</span>
        <span class="n">page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">cursor</span><span class="o">=</span><span class="n">next_cursor</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.opportunities.OpportunityService.resolve" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">resolve</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">list_id</span><span class="p">:</span> <span class="n">ListId</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Opportunity</span> <span class="o">|</span> <span class="kc">None</span></code>

<a href="#affinity.services.opportunities.OpportunityService.resolve" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Find a single opportunity by exact name within a specific list.</p>
<p>Notes:
- Opportunities are list-scoped; a list id is required.
- This iterates list-entry pages client-side (no dedicated search endpoint).
- If multiple matches exist, returns the first match in server-provided order.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/opportunities.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">resolve</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">list_id</span><span class="p">:</span> <span class="n">ListId</span><span class="p">,</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Opportunity</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find a single opportunity by exact name within a specific list.</span>

<span class="sd">    Notes:</span>
<span class="sd">    - Opportunities are list-scoped; a list id is required.</span>
<span class="sd">    - This iterates list-entry pages client-side (no dedicated search endpoint).</span>
<span class="sd">    - If multiple matches exist, returns the first match in server-provided order.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Name cannot be empty&quot;</span><span class="p">)</span>
    <span class="n">name_lower</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="n">entries</span> <span class="o">=</span> <span class="n">ListEntryService</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="p">,</span> <span class="n">list_id</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">entries</span><span class="o">.</span><span class="n">pages</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">page</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="n">entity</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">entity</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">Opportunity</span><span class="p">)</span> <span class="ow">and</span> <span class="n">entity</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">name_lower</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">entity</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.opportunities.OpportunityService.resolve_all" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">resolve_all</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">list_id</span><span class="p">:</span> <span class="n">ListId</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]</span></code>

<a href="#affinity.services.opportunities.OpportunityService.resolve_all" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Find all opportunities matching a name within a specific list.</p>
<p>Notes:
- Opportunities are list-scoped; a list id is required.
- This iterates list-entry pages client-side (no dedicated search endpoint).</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/opportunities.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">resolve_all</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">list_id</span><span class="p">:</span> <span class="n">ListId</span><span class="p">,</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find all opportunities matching a name within a specific list.</span>

<span class="sd">    Notes:</span>
<span class="sd">    - Opportunities are list-scoped; a list id is required.</span>
<span class="sd">    - This iterates list-entry pages client-side (no dedicated search endpoint).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Name cannot be empty&quot;</span><span class="p">)</span>
    <span class="n">name_lower</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">matches</span><span class="p">:</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">entries</span> <span class="o">=</span> <span class="n">ListEntryService</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="p">,</span> <span class="n">list_id</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">entries</span><span class="o">.</span><span class="n">pages</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">page</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="n">entity</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">entity</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">Opportunity</span><span class="p">)</span> <span class="ow">and</span> <span class="n">entity</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">name_lower</span><span class="p">:</span>
                <span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">matches</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.opportunities.OpportunityService.search" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">search</span><span class="p">(</span><span class="n">term</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">page_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">page_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]</span></code>

<a href="#affinity.services.opportunities.OpportunityService.search" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Search for opportunities by name.</p>
<p>Uses V1 API for search functionality.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>term</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Search term (matches opportunity name). If None, returns all.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>page_size</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Results per page (max 500)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>page_token</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pagination token</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="PaginatedResponse (affinity.models.pagination.PaginatedResponse)" href="../../models/#affinity.models.PaginatedResponse">PaginatedResponse</a>[<a class="autorefs autorefs-internal" title="Opportunity (affinity.models.entities.Opportunity)" href="../../models/#affinity.models.Opportunity">Opportunity</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>PaginatedResponse with opportunities and next_page_token</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/opportunities.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">search</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">term</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">page_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">page_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Search for opportunities by name.</span>

<span class="sd">    Uses V1 API for search functionality.</span>

<span class="sd">    Args:</span>
<span class="sd">        term: Search term (matches opportunity name). If None, returns all.</span>
<span class="sd">        page_size: Results per page (max 500)</span>
<span class="sd">        page_token: Pagination token</span>

<span class="sd">    Returns:</span>
<span class="sd">        PaginatedResponse with opportunities and next_page_token</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">term</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;term&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">term</span>
    <span class="k">if</span> <span class="n">page_size</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;page_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">page_size</span>
    <span class="k">if</span> <span class="n">page_token</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;page_token&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">page_token</span>

    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/opportunities&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">Opportunity</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;opportunities&quot;</span><span class="p">,</span> <span class="p">[])]</span>
    <span class="k">return</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">](</span>
        <span class="n">data</span><span class="o">=</span><span class="n">items</span><span class="p">,</span>
        <span class="n">next_page_token</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;next_page_token&quot;</span><span class="p">),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.opportunities.OpportunityService.search_all" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">search_all</span><span class="p">(</span><span class="n">term</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">page_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">page_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]</span></code>

<a href="#affinity.services.opportunities.OpportunityService.search_all" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Iterate all V1 opportunity-search results with automatic pagination.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>term</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Search term (matches opportunity name). If None, returns all.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>page_size</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Results per page (max 500)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>page_token</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Resume from this pagination token</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Yields:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="Opportunity (affinity.models.entities.Opportunity)" href="../../models/#affinity.models.Opportunity">Opportunity</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Each Opportunity individually</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/opportunities.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">search_all</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">term</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">page_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">page_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Iterate all V1 opportunity-search results with automatic pagination.</span>

<span class="sd">    Args:</span>
<span class="sd">        term: Search term (matches opportunity name). If None, returns all.</span>
<span class="sd">        page_size: Results per page (max 500)</span>
<span class="sd">        page_token: Resume from this pagination token</span>

<span class="sd">    Yields:</span>
<span class="sd">        Each Opportunity individually</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_pages</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">page_size</span><span class="o">=</span><span class="n">page_size</span><span class="p">,</span> <span class="n">page_token</span><span class="o">=</span><span class="n">page_token</span><span class="p">):</span>
        <span class="k">yield from</span> <span class="n">page</span><span class="o">.</span><span class="n">data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.opportunities.OpportunityService.search_pages" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">search_pages</span><span class="p">(</span><span class="n">term</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">page_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">page_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]]</span></code>

<a href="#affinity.services.opportunities.OpportunityService.search_pages" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Iterate V1 opportunity-search result pages.</p>
<p>Useful for scripts that need checkpoint/resume via <code>next_page_token</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>term</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Search term (matches opportunity name). If None, returns all.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>page_size</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Results per page (max 500)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>page_token</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Resume from this pagination token</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Yields:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="PaginatedResponse (affinity.models.pagination.PaginatedResponse)" href="../../models/#affinity.models.PaginatedResponse">PaginatedResponse</a>[<a class="autorefs autorefs-internal" title="Opportunity (affinity.models.entities.Opportunity)" href="../../models/#affinity.models.Opportunity">Opportunity</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>PaginatedResponse[Opportunity] for each page</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/opportunities.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">search_pages</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">term</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">page_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">page_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Iterate V1 opportunity-search result pages.</span>

<span class="sd">    Useful for scripts that need checkpoint/resume via `next_page_token`.</span>

<span class="sd">    Args:</span>
<span class="sd">        term: Search term (matches opportunity name). If None, returns all.</span>
<span class="sd">        page_size: Results per page (max 500)</span>
<span class="sd">        page_token: Resume from this pagination token</span>

<span class="sd">    Yields:</span>
<span class="sd">        PaginatedResponse[Opportunity] for each page</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">requested_token</span> <span class="o">=</span> <span class="n">page_token</span>
    <span class="n">page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">page_size</span><span class="o">=</span><span class="n">page_size</span><span class="p">,</span> <span class="n">page_token</span><span class="o">=</span><span class="n">page_token</span><span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">page</span>
        <span class="n">next_token</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">next_page_token</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">next_token</span> <span class="ow">or</span> <span class="n">next_token</span> <span class="o">==</span> <span class="n">requested_token</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">requested_token</span> <span class="o">=</span> <span class="n">next_token</span>
        <span class="n">page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">page_size</span><span class="o">=</span><span class="n">page_size</span><span class="p">,</span> <span class="n">page_token</span><span class="o">=</span><span class="n">next_token</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.opportunities.OpportunityService.update" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update</span><span class="p">(</span><span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">OpportunityUpdate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Opportunity</span></code>

<a href="#affinity.services.opportunities.OpportunityService.update" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Update an existing opportunity.</p>
<p>Note: When provided, <code>person_ids</code> and <code>company_ids</code> replace the existing
values. To add or remove associations safely, pass the full desired arrays.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/opportunities.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">OpportunityUpdate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Opportunity</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update an existing opportunity.</span>

<span class="sd">    Note: When provided, `person_ids` and `company_ids` replace the existing</span>
<span class="sd">    values. To add or remove associations safely, pass the full desired arrays.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span>
        <span class="n">by_alias</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">,</span>
        <span class="n">exclude_unset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Uses the v1 endpoint; its PUT semantics replace association arrays.</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/opportunities/</span><span class="si">{</span><span class="n">opportunity_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Opportunity</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<a id="affinity.services.opportunities.AsyncOpportunityService"></a>
    <div class="doc doc-contents first">



        <p>Async version of OpportunityService (TR-009).</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>affinity/services/opportunities.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AsyncOpportunityService</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Async version of OpportunityService (TR-009).&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">:</span> <span class="n">AsyncHTTPClient</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_client</span> <span class="o">=</span> <span class="n">client</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Opportunity</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a single opportunity by ID.</span>

<span class="sd">        Args:</span>
<span class="sd">            opportunity_id: The opportunity ID</span>
<span class="sd">            retries: Number of retries on 404 NotFoundError. Default is 0 (fail fast).</span>
<span class="sd">                Set to 2-3 if calling immediately after create() to handle V1V2</span>
<span class="sd">                eventual consistency lag.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The opportunity representation returned by v2 (may be partial).</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotFoundError: If opportunity does not exist after all retries.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">last_error</span><span class="p">:</span> <span class="n">NotFoundError</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">attempts</span> <span class="o">=</span> <span class="n">retries</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># retries=0 means 1 attempt</span>

        <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">attempts</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/opportunities/</span><span class="si">{</span><span class="n">opportunity_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">Opportunity</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">NotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">last_error</span> <span class="o">=</span> <span class="n">e</span>
                <span class="k">if</span> <span class="n">attempt</span> <span class="o">&lt;</span> <span class="n">attempts</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Don&#39;t sleep after last attempt</span>
                    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">attempt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>  <span class="c1"># 0.5s, 1s, 1.5s backoff</span>

        <span class="k">raise</span> <span class="n">last_error</span>  <span class="c1"># type: ignore[misc]</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_details</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Opportunity</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a single opportunity by ID with a more complete representation.</span>

<span class="sd">        Includes association IDs and (when present) list entries, which are not</span>
<span class="sd">        always included in the default `get()` response.</span>

<span class="sd">        See Also:</span>
<span class="sd">            - :meth:`get_associated_person_ids`: Get just person IDs (single API call)</span>
<span class="sd">            - :meth:`get_associated_people`: Get full Person objects</span>
<span class="sd">            - :meth:`get_associated_company_ids`: Get just company IDs (single API call)</span>
<span class="sd">            - :meth:`get_associated_companies`: Get full Company objects</span>
<span class="sd">            - :meth:`get_associations`: Get both person and company IDs in one call</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Uses the v1 endpoint because it returns a fuller payload (including</span>
        <span class="c1"># association IDs and, when present, list entries).</span>
        <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/opportunities/</span><span class="si">{</span><span class="n">opportunity_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Opportunity</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cursor</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List all opportunities.</span>

<span class="sd">        Args:</span>
<span class="sd">            ids: Specific opportunity IDs to fetch (batch lookup)</span>
<span class="sd">            limit: Maximum number of results per page</span>
<span class="sd">            cursor: Cursor to resume pagination (opaque; obtained from prior responses)</span>

<span class="sd">        Returns the v2 opportunity representation (which may be partial).</span>
<span class="sd">        For full opportunity row data, use list entries explicitly.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">cursor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">limit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Cannot combine &#39;cursor&#39; with other parameters; cursor encodes all query &quot;</span>
                    <span class="s2">&quot;context. Start a new pagination sequence without a cursor to change &quot;</span>
                    <span class="s2">&quot;parameters.&quot;</span>
                <span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get_url</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="n">ids</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s2">&quot;ids&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span> <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">limit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s2">&quot;limit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">limit</span>
            <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/opportunities&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">](</span>
            <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">Opportunity</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">[])],</span>
            <span class="n">pagination</span><span class="o">=</span><span class="n">PaginationInfo</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pagination&quot;</span><span class="p">,</span> <span class="p">{})),</span>
        <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">pages</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cursor</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterate opportunity pages (not items), yielding `PaginatedResponse[Opportunity]`.</span>

<span class="sd">        This is useful for ETL scripts that want checkpoint/resume via `page.next_cursor`.</span>

<span class="sd">        Args:</span>
<span class="sd">            ids: Specific opportunity IDs to fetch (batch lookup)</span>
<span class="sd">            limit: Maximum results per page</span>
<span class="sd">            cursor: Cursor to resume pagination</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">other_params</span> <span class="o">=</span> <span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cursor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="n">p</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">other_params</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot combine &#39;cursor&#39; with other parameters; cursor encodes all query context. &quot;</span>
                <span class="s2">&quot;Start a new pagination sequence without a cursor to change parameters.&quot;</span>
            <span class="p">)</span>
        <span class="n">requested_cursor</span> <span class="o">=</span> <span class="n">cursor</span>
        <span class="n">page</span> <span class="o">=</span> <span class="p">(</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">cursor</span><span class="o">=</span><span class="n">cursor</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cursor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">ids</span><span class="o">=</span><span class="n">ids</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">page</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">page</span><span class="o">.</span><span class="n">has_next</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">next_cursor</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">next_cursor</span>
            <span class="k">if</span> <span class="n">next_cursor</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">next_cursor</span> <span class="o">==</span> <span class="n">requested_cursor</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">requested_cursor</span> <span class="o">=</span> <span class="n">next_cursor</span>
            <span class="n">page</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">cursor</span><span class="o">=</span><span class="n">next_cursor</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">all</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterate through all opportunities with automatic pagination.</span>

<span class="sd">        Args:</span>
<span class="sd">            ids: Specific opportunity IDs to fetch (batch lookup)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">fetch_page</span><span class="p">(</span><span class="n">next_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">next_url</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get_url</span><span class="p">(</span><span class="n">next_url</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">](</span>
                    <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">Opportunity</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">[])],</span>
                    <span class="n">pagination</span><span class="o">=</span><span class="n">PaginationInfo</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pagination&quot;</span><span class="p">,</span> <span class="p">{})),</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">ids</span><span class="o">=</span><span class="n">ids</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">AsyncPageIterator</span><span class="p">(</span><span class="n">fetch_page</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">iter</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Auto-paginate all opportunities.</span>

<span class="sd">        Alias for `all()` (FR-006 public contract).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">ids</span><span class="o">=</span><span class="n">ids</span><span class="p">)</span>

    <span class="c1"># =========================================================================</span>
    <span class="c1"># Search (V1 API)</span>
    <span class="c1"># =========================================================================</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">search</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">term</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">page_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">page_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Search for opportunities by name.</span>

<span class="sd">        Uses V1 API for search functionality.</span>

<span class="sd">        Args:</span>
<span class="sd">            term: Search term (matches opportunity name). If None, returns all.</span>
<span class="sd">            page_size: Results per page (max 500)</span>
<span class="sd">            page_token: Pagination token</span>

<span class="sd">        Returns:</span>
<span class="sd">            PaginatedResponse with opportunities and next_page_token</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">term</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;term&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">term</span>
        <span class="k">if</span> <span class="n">page_size</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;page_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">page_size</span>
        <span class="k">if</span> <span class="n">page_token</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;page_token&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">page_token</span>

        <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/opportunities&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">Opportunity</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;opportunities&quot;</span><span class="p">,</span> <span class="p">[])]</span>
        <span class="k">return</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">](</span>
            <span class="n">data</span><span class="o">=</span><span class="n">items</span><span class="p">,</span>
            <span class="n">next_page_token</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;next_page_token&quot;</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">search_pages</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">term</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">page_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">page_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterate V1 opportunity-search result pages.</span>

<span class="sd">        Useful for scripts that need checkpoint/resume via `next_page_token`.</span>

<span class="sd">        Args:</span>
<span class="sd">            term: Search term (matches opportunity name). If None, returns all.</span>
<span class="sd">            page_size: Results per page (max 500)</span>
<span class="sd">            page_token: Resume from this pagination token</span>

<span class="sd">        Yields:</span>
<span class="sd">            PaginatedResponse[Opportunity] for each page</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">requested_token</span> <span class="o">=</span> <span class="n">page_token</span>
        <span class="n">page</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">page_size</span><span class="o">=</span><span class="n">page_size</span><span class="p">,</span> <span class="n">page_token</span><span class="o">=</span><span class="n">page_token</span><span class="p">)</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">page</span>
            <span class="n">next_token</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">next_page_token</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">next_token</span> <span class="ow">or</span> <span class="n">next_token</span> <span class="o">==</span> <span class="n">requested_token</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">requested_token</span> <span class="o">=</span> <span class="n">next_token</span>
            <span class="n">page</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">page_size</span><span class="o">=</span><span class="n">page_size</span><span class="p">,</span> <span class="n">page_token</span><span class="o">=</span><span class="n">next_token</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">search_all</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">term</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">page_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">page_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterate all V1 opportunity-search results with automatic pagination.</span>

<span class="sd">        Args:</span>
<span class="sd">            term: Search term (matches opportunity name). If None, returns all.</span>
<span class="sd">            page_size: Results per page (max 500)</span>
<span class="sd">            page_token: Resume from this pagination token</span>

<span class="sd">        Yields:</span>
<span class="sd">            Each Opportunity individually</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">async</span> <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_pages</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">page_size</span><span class="o">=</span><span class="n">page_size</span><span class="p">,</span> <span class="n">page_token</span><span class="o">=</span><span class="n">page_token</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">opp</span> <span class="ow">in</span> <span class="n">page</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">opp</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">resolve</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">list_id</span><span class="p">:</span> <span class="n">ListId</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Opportunity</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find a single opportunity by exact name within a specific list.</span>

<span class="sd">        Notes:</span>
<span class="sd">        - Opportunities are list-scoped; a list id is required.</span>
<span class="sd">        - This iterates list-entry pages client-side (no dedicated search endpoint).</span>
<span class="sd">        - If multiple matches exist, returns the first match in server-provided order.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Name cannot be empty&quot;</span><span class="p">)</span>
        <span class="n">name_lower</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="n">entries</span> <span class="o">=</span> <span class="n">AsyncListEntryService</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="p">,</span> <span class="n">list_id</span><span class="p">)</span>
        <span class="k">async</span> <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">entries</span><span class="o">.</span><span class="n">pages</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">page</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
                <span class="n">entity</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">entity</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">Opportunity</span><span class="p">)</span> <span class="ow">and</span> <span class="n">entity</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">name_lower</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">entity</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">resolve_all</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">list_id</span><span class="p">:</span> <span class="n">ListId</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find all opportunities matching a name within a specific list.</span>

<span class="sd">        Notes:</span>
<span class="sd">        - Opportunities are list-scoped; a list id is required.</span>
<span class="sd">        - This iterates list-entry pages client-side (no dedicated search endpoint).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Name cannot be empty&quot;</span><span class="p">)</span>
        <span class="n">name_lower</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">matches</span><span class="p">:</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">entries</span> <span class="o">=</span> <span class="n">AsyncListEntryService</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="p">,</span> <span class="n">list_id</span><span class="p">)</span>
        <span class="k">async</span> <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">entries</span><span class="o">.</span><span class="n">pages</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">page</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
                <span class="n">entity</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">entity</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">Opportunity</span><span class="p">)</span> <span class="ow">and</span> <span class="n">entity</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">name_lower</span><span class="p">:</span>
                    <span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">matches</span>

    <span class="c1"># =========================================================================</span>
    <span class="c1"># Write Operations (V1 API)</span>
    <span class="c1"># =========================================================================</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">OpportunityCreate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Opportunity</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new opportunity.</span>

<span class="sd">        The opportunity will be added to the specified list.</span>

<span class="sd">        Args:</span>
<span class="sd">            data: Opportunity creation data including list_id and name</span>

<span class="sd">        Returns:</span>
<span class="sd">            The created opportunity</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">by_alias</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="n">exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="o">.</span><span class="n">person_ids</span><span class="p">:</span>
            <span class="n">payload</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;person_ids&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="o">.</span><span class="n">company_ids</span><span class="p">:</span>
            <span class="n">payload</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;organization_ids&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/opportunities&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Opportunity</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">OpportunityUpdate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Opportunity</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update an existing opportunity.</span>

<span class="sd">        Note: When provided, `person_ids` and `company_ids` replace the existing</span>
<span class="sd">        values. To add or remove associations safely, pass the full desired arrays.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span>
            <span class="n">by_alias</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">,</span>
            <span class="n">exclude_unset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Uses the v1 endpoint; its PUT semantics replace association arrays.</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/opportunities/</span><span class="si">{</span><span class="n">opportunity_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Opportunity</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete an opportunity.</span>

<span class="sd">        This removes the opportunity and all associated list entries.</span>

<span class="sd">        Args:</span>
<span class="sd">            opportunity_id: The opportunity to delete</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if successful</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/opportunities/</span><span class="si">{</span><span class="n">opportunity_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;success&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>

    <span class="c1"># =========================================================================</span>
    <span class="c1"># Association Methods (V1 API)</span>
    <span class="c1"># =========================================================================</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_associated_person_ids</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">PersonId</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get associated person IDs for an opportunity.</span>

<span class="sd">        V1-only: V2 does not expose opportunity -&gt; person associations.</span>
<span class="sd">        Uses GET `/opportunities/{id}` (V1) and returns `person_ids`.</span>

<span class="sd">        Args:</span>
<span class="sd">            opportunity_id: The opportunity ID</span>
<span class="sd">            max_results: Maximum number of person IDs to return</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of PersonId values associated with this opportunity</span>

<span class="sd">        See Also:</span>
<span class="sd">            - :meth:`get_associated_people`: Returns full Person objects</span>
<span class="sd">            - :meth:`get_associations`: Get both person and company IDs in one call</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/opportunities/</span><span class="si">{</span><span class="n">opportunity_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Defensive: V1 returns directly (not wrapped), but handle potential wrapper</span>
        <span class="n">opportunity</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;opportunity&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">opportunity</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">opportunity</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">data</span>
        <span class="n">person_ids</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">person_ids</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;person_ids&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;personIds&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">person_ids</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">PersonId</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">pid</span><span class="p">))</span> <span class="k">for</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">person_ids</span> <span class="k">if</span> <span class="n">pid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">max_results</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_results</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ids</span><span class="p">[:</span><span class="n">max_results</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">ids</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_associated_people</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">Person</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get Person objects associated with an opportunity.</span>

<span class="sd">        Uses V2 batch lookup for efficiency (1 API call per 100 persons</span>
<span class="sd">        instead of 1 per person).</span>

<span class="sd">        Args:</span>
<span class="sd">            opportunity_id: The opportunity ID</span>
<span class="sd">            max_results: Maximum number of people to return</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of Person objects associated with this opportunity</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">person_ids</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_associated_person_ids</span><span class="p">(</span><span class="n">opportunity_id</span><span class="p">,</span> <span class="n">max_results</span><span class="o">=</span><span class="n">max_results</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">person_ids</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="c1"># Use V2 batch lookup: GET /persons?ids=1&amp;ids=2&amp;ids=3</span>
        <span class="c1"># Note: person_ids is already truncated by get_associated_person_ids if max_results set</span>
        <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ids&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span> <span class="k">for</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">person_ids</span><span class="p">]}</span>

        <span class="n">people</span><span class="p">:</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">Person</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/persons&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>  <span class="c1"># V2 batch</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="n">people</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>

        <span class="c1"># Handle pagination if needed (&gt;100 persons)</span>
        <span class="c1"># Note: max_results check is defensive - person_ids was already truncated above</span>
        <span class="n">pagination</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pagination&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">next_url</span> <span class="o">=</span> <span class="n">pagination</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nextUrl&quot;</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">next_url</span> <span class="ow">and</span> <span class="p">(</span><span class="n">max_results</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">people</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">max_results</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get_url</span><span class="p">(</span><span class="n">next_url</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="n">people</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
            <span class="n">next_url</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pagination&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nextUrl&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">max_results</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">people</span><span class="p">[:</span><span class="n">max_results</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">people</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_associated_company_ids</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">CompanyId</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get associated company IDs for an opportunity.</span>

<span class="sd">        V1-only: V2 does not expose opportunity -&gt; company associations.</span>
<span class="sd">        Uses GET `/opportunities/{id}` (V1) and returns `organization_ids`.</span>

<span class="sd">        Args:</span>
<span class="sd">            opportunity_id: The opportunity ID</span>
<span class="sd">            max_results: Maximum number of company IDs to return</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of CompanyId values associated with this opportunity</span>

<span class="sd">        See Also:</span>
<span class="sd">            - :meth:`get_associated_companies`: Returns full Company objects</span>
<span class="sd">            - :meth:`get_associations`: Get both person and company IDs in one call</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/opportunities/</span><span class="si">{</span><span class="n">opportunity_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Defensive: V1 returns directly (not wrapped), but handle potential wrapper</span>
        <span class="n">opportunity</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;opportunity&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">opportunity</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">opportunity</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">data</span>
        <span class="n">company_ids</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">company_ids</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organization_ids&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organizationIds&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">company_ids</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">CompanyId</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">cid</span><span class="p">))</span> <span class="k">for</span> <span class="n">cid</span> <span class="ow">in</span> <span class="n">company_ids</span> <span class="k">if</span> <span class="n">cid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">max_results</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_results</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ids</span><span class="p">[:</span><span class="n">max_results</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">ids</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_associated_companies</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">Company</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get Company objects associated with an opportunity.</span>

<span class="sd">        Uses V2 batch lookup for efficiency (1 API call per 100 companies</span>
<span class="sd">        instead of 1 per company).</span>

<span class="sd">        Args:</span>
<span class="sd">            opportunity_id: The opportunity ID</span>
<span class="sd">            max_results: Maximum number of companies to return</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of Company objects associated with this opportunity</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">company_ids</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_associated_company_ids</span><span class="p">(</span><span class="n">opportunity_id</span><span class="p">,</span> <span class="n">max_results</span><span class="o">=</span><span class="n">max_results</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">company_ids</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="c1"># Use V2 batch lookup: GET /companies?ids=1&amp;ids=2&amp;ids=3</span>
        <span class="c1"># Note: company_ids is already truncated by get_associated_company_ids if max_results set</span>
        <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ids&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">cid</span><span class="p">)</span> <span class="k">for</span> <span class="n">cid</span> <span class="ow">in</span> <span class="n">company_ids</span><span class="p">]}</span>

        <span class="n">companies</span><span class="p">:</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">Company</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/companies&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>  <span class="c1"># V2 batch</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="n">companies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Company</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>

        <span class="c1"># Handle pagination if needed (&gt;100 companies)</span>
        <span class="c1"># Note: max_results check is defensive - company_ids was already truncated above</span>
        <span class="n">pagination</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pagination&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">next_url</span> <span class="o">=</span> <span class="n">pagination</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nextUrl&quot;</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">next_url</span> <span class="ow">and</span> <span class="p">(</span><span class="n">max_results</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">companies</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">max_results</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get_url</span><span class="p">(</span><span class="n">next_url</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="n">companies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Company</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
            <span class="n">next_url</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pagination&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nextUrl&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">max_results</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">companies</span><span class="p">[:</span><span class="n">max_results</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">companies</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_associations</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OpportunityAssociations</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get both person and company associations in a single V1 call.</span>

<span class="sd">        Use this when you need both types of associations to avoid</span>
<span class="sd">        duplicate API calls from separate get_associated_*_ids() calls.</span>

<span class="sd">        Args:</span>
<span class="sd">            opportunity_id: The opportunity ID</span>

<span class="sd">        Returns:</span>
<span class="sd">            OpportunityAssociations named tuple with person_ids and company_ids</span>

<span class="sd">        Example:</span>
<span class="sd">            assoc = await client.opportunities.get_associations(opp_id)</span>
<span class="sd">            print(assoc.person_ids)   # IDE autocomplete works</span>
<span class="sd">            print(assoc.company_ids)  # IDE autocomplete works</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/opportunities/</span><span class="si">{</span><span class="n">opportunity_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Defensive: V1 returns directly (not wrapped), but handle potential wrapper</span>
        <span class="n">opportunity</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;opportunity&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">opportunity</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">opportunity</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">data</span>

        <span class="n">person_ids</span><span class="p">:</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">PersonId</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">company_ids</span><span class="p">:</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">CompanyId</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">raw_person_ids</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;person_ids&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;personIds&quot;</span><span class="p">)</span>
            <span class="n">raw_company_ids</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organization_ids&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organizationIds&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">raw_person_ids</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">person_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">PersonId</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">pid</span><span class="p">))</span> <span class="k">for</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">raw_person_ids</span> <span class="k">if</span> <span class="n">pid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">raw_company_ids</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">company_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">CompanyId</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">cid</span><span class="p">))</span> <span class="k">for</span> <span class="n">cid</span> <span class="ow">in</span> <span class="n">raw_company_ids</span> <span class="k">if</span> <span class="n">cid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">OpportunityAssociations</span><span class="p">(</span><span class="n">person_ids</span><span class="o">=</span><span class="n">person_ids</span><span class="p">,</span> <span class="n">company_ids</span><span class="o">=</span><span class="n">company_ids</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_associated_person_ids_batch</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">opportunity_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">],</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">on_error</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;raise&quot;</span><span class="p">,</span> <span class="s2">&quot;skip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;raise&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">PersonId</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get person associations for multiple opportunities.</span>

<span class="sd">        Makes one V1 API call per opportunity. Useful for iterating list entries</span>
<span class="sd">        where V2 returns empty person_ids.</span>

<span class="sd">        Args:</span>
<span class="sd">            opportunity_ids: Sequence of opportunity IDs to fetch</span>
<span class="sd">            on_error: How to handle errors - &quot;raise&quot; (default) or &quot;skip&quot; failed IDs</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict mapping opportunity_id -&gt; list of person_ids</span>

<span class="sd">        Raises:</span>
<span class="sd">            AffinityError: If on_error=&quot;raise&quot; and any fetch fails. The exception</span>
<span class="sd">                includes the failing opportunity_id in its context.</span>

<span class="sd">        Example:</span>
<span class="sd">            # Get all persons from an opportunity list</span>
<span class="sd">            opp_ids = [entry.entity.id async for entry in client.lists.entries(list_id).all()]</span>
<span class="sd">            associations = await client.opportunities.get_associated_person_ids_batch(opp_ids)</span>
<span class="sd">            all_person_ids = set()</span>
<span class="sd">            for person_ids in associations.values():</span>
<span class="sd">                all_person_ids.update(person_ids)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">PersonId</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">opp_id</span> <span class="ow">in</span> <span class="n">opportunity_ids</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="n">opp_id</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_associated_person_ids</span><span class="p">(</span><span class="n">opp_id</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">AffinityError</span><span class="p">:</span>
                <span class="c1"># Re-raise SDK errors directly - they already have good context</span>
                <span class="k">if</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s2">&quot;raise&quot;</span><span class="p">:</span>
                    <span class="k">raise</span>
                <span class="c1"># skip: continue without this opportunity</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s2">&quot;raise&quot;</span><span class="p">:</span>
                    <span class="c1"># Wrap non-SDK errors with context, preserving chain</span>
                    <span class="k">raise</span> <span class="n">AffinityError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Failed to get associations for opportunity </span><span class="si">{</span><span class="n">opp_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
                <span class="c1"># skip: continue without this opportunity</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_associated_company_ids_batch</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">opportunity_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">],</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">on_error</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;raise&quot;</span><span class="p">,</span> <span class="s2">&quot;skip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;raise&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">CompanyId</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get company associations for multiple opportunities.</span>

<span class="sd">        Makes one V1 API call per opportunity. Useful for iterating list entries</span>
<span class="sd">        where V2 returns empty company_ids.</span>

<span class="sd">        Args:</span>
<span class="sd">            opportunity_ids: Sequence of opportunity IDs to fetch</span>
<span class="sd">            on_error: How to handle errors - &quot;raise&quot; (default) or &quot;skip&quot; failed IDs</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict mapping opportunity_id -&gt; list of company_ids</span>

<span class="sd">        Raises:</span>
<span class="sd">            AffinityError: If on_error=&quot;raise&quot; and any fetch fails. The exception</span>
<span class="sd">                includes the failing opportunity_id in its context.</span>

<span class="sd">        Example:</span>
<span class="sd">            # Get all companies from an opportunity list</span>
<span class="sd">            opp_ids = [entry.entity.id async for entry in client.lists.entries(list_id).all()]</span>
<span class="sd">            associations = await client.opportunities.get_associated_company_ids_batch(opp_ids)</span>
<span class="sd">            all_company_ids = set()</span>
<span class="sd">            for company_ids in associations.values():</span>
<span class="sd">                all_company_ids.update(company_ids)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">CompanyId</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">opp_id</span> <span class="ow">in</span> <span class="n">opportunity_ids</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="n">opp_id</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_associated_company_ids</span><span class="p">(</span><span class="n">opp_id</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">AffinityError</span><span class="p">:</span>
                <span class="c1"># Re-raise SDK errors directly - they already have good context</span>
                <span class="k">if</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s2">&quot;raise&quot;</span><span class="p">:</span>
                    <span class="k">raise</span>
                <span class="c1"># skip: continue without this opportunity</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s2">&quot;raise&quot;</span><span class="p">:</span>
                    <span class="c1"># Wrap non-SDK errors with context, preserving chain</span>
                    <span class="k">raise</span> <span class="n">AffinityError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Failed to get company associations for opportunity </span><span class="si">{</span><span class="n">opp_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
                <span class="c1"># skip: continue without this opportunity</span>
        <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="affinity.services.opportunities.AsyncOpportunityService.all" class="doc doc-heading">
            <code class="highlight language-python"><span class="nb">all</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]</span></code>

<a href="#affinity.services.opportunities.AsyncOpportunityService.all" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Iterate through all opportunities with automatic pagination.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ids</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="affinity.models.types.OpportunityId">OpportunityId</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Specific opportunity IDs to fetch (batch lookup)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/opportunities.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">all</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Iterate through all opportunities with automatic pagination.</span>

<span class="sd">    Args:</span>
<span class="sd">        ids: Specific opportunity IDs to fetch (batch lookup)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">fetch_page</span><span class="p">(</span><span class="n">next_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">next_url</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get_url</span><span class="p">(</span><span class="n">next_url</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">](</span>
                <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">Opportunity</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">[])],</span>
                <span class="n">pagination</span><span class="o">=</span><span class="n">PaginationInfo</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pagination&quot;</span><span class="p">,</span> <span class="p">{})),</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">ids</span><span class="o">=</span><span class="n">ids</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">AsyncPageIterator</span><span class="p">(</span><span class="n">fetch_page</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.opportunities.AsyncOpportunityService.create" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">OpportunityCreate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Opportunity</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#affinity.services.opportunities.AsyncOpportunityService.create" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Create a new opportunity.</p>
<p>The opportunity will be added to the specified list.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="OpportunityCreate (affinity.models.entities.OpportunityCreate)" href="../../models/#affinity.models.OpportunityCreate">OpportunityCreate</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Opportunity creation data including list_id and name</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="Opportunity (affinity.models.entities.Opportunity)" href="../../models/#affinity.models.Opportunity">Opportunity</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The created opportunity</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/opportunities.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">OpportunityCreate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Opportunity</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a new opportunity.</span>

<span class="sd">    The opportunity will be added to the specified list.</span>

<span class="sd">    Args:</span>
<span class="sd">        data: Opportunity creation data including list_id and name</span>

<span class="sd">    Returns:</span>
<span class="sd">        The created opportunity</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">by_alias</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="n">exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="o">.</span><span class="n">person_ids</span><span class="p">:</span>
        <span class="n">payload</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;person_ids&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="o">.</span><span class="n">company_ids</span><span class="p">:</span>
        <span class="n">payload</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;organization_ids&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/opportunities&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Opportunity</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.opportunities.AsyncOpportunityService.delete" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete</span><span class="p">(</span><span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#affinity.services.opportunities.AsyncOpportunityService.delete" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Delete an opportunity.</p>
<p>This removes the opportunity and all associated list entries.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>opportunity_id</code>
            </td>
            <td>
                  <code><span title="affinity.models.types.OpportunityId">OpportunityId</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The opportunity to delete</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if successful</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/opportunities.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delete an opportunity.</span>

<span class="sd">    This removes the opportunity and all associated list entries.</span>

<span class="sd">    Args:</span>
<span class="sd">        opportunity_id: The opportunity to delete</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if successful</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/opportunities/</span><span class="si">{</span><span class="n">opportunity_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;success&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.opportunities.AsyncOpportunityService.get" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get</span><span class="p">(</span><span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Opportunity</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#affinity.services.opportunities.AsyncOpportunityService.get" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Get a single opportunity by ID.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>opportunity_id</code>
            </td>
            <td>
                  <code><span title="affinity.models.types.OpportunityId">OpportunityId</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The opportunity ID</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>retries</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of retries on 404 NotFoundError. Default is 0 (fail fast).
Set to 2-3 if calling immediately after create() to handle V1V2
eventual consistency lag.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="Opportunity (affinity.models.entities.Opportunity)" href="../../models/#affinity.models.Opportunity">Opportunity</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The opportunity representation returned by v2 (may be partial).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="NotFoundError (affinity.exceptions.NotFoundError)" href="../../exceptions/#affinity.exceptions.NotFoundError">NotFoundError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If opportunity does not exist after all retries.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/opportunities.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Opportunity</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a single opportunity by ID.</span>

<span class="sd">    Args:</span>
<span class="sd">        opportunity_id: The opportunity ID</span>
<span class="sd">        retries: Number of retries on 404 NotFoundError. Default is 0 (fail fast).</span>
<span class="sd">            Set to 2-3 if calling immediately after create() to handle V1V2</span>
<span class="sd">            eventual consistency lag.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The opportunity representation returned by v2 (may be partial).</span>

<span class="sd">    Raises:</span>
<span class="sd">        NotFoundError: If opportunity does not exist after all retries.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">last_error</span><span class="p">:</span> <span class="n">NotFoundError</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">attempts</span> <span class="o">=</span> <span class="n">retries</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># retries=0 means 1 attempt</span>

    <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">attempts</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/opportunities/</span><span class="si">{</span><span class="n">opportunity_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Opportunity</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">NotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">last_error</span> <span class="o">=</span> <span class="n">e</span>
            <span class="k">if</span> <span class="n">attempt</span> <span class="o">&lt;</span> <span class="n">attempts</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Don&#39;t sleep after last attempt</span>
                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">attempt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>  <span class="c1"># 0.5s, 1s, 1.5s backoff</span>

    <span class="k">raise</span> <span class="n">last_error</span>  <span class="c1"># type: ignore[misc]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.opportunities.AsyncOpportunityService.get_associated_companies" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_associated_companies</span><span class="p">(</span><span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">Company</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#affinity.services.opportunities.AsyncOpportunityService.get_associated_companies" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Get Company objects associated with an opportunity.</p>
<p>Uses V2 batch lookup for efficiency (1 API call per 100 companies
instead of 1 per company).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>opportunity_id</code>
            </td>
            <td>
                  <code><span title="affinity.models.types.OpportunityId">OpportunityId</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The opportunity ID</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_results</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of companies to return</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="builtins.list">list</span>[<a class="autorefs autorefs-internal" title="Company (affinity.models.entities.Company)" href="../../models/#affinity.models.Company">Company</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of Company objects associated with this opportunity</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/opportunities.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_associated_companies</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">Company</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get Company objects associated with an opportunity.</span>

<span class="sd">    Uses V2 batch lookup for efficiency (1 API call per 100 companies</span>
<span class="sd">    instead of 1 per company).</span>

<span class="sd">    Args:</span>
<span class="sd">        opportunity_id: The opportunity ID</span>
<span class="sd">        max_results: Maximum number of companies to return</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of Company objects associated with this opportunity</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">company_ids</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_associated_company_ids</span><span class="p">(</span><span class="n">opportunity_id</span><span class="p">,</span> <span class="n">max_results</span><span class="o">=</span><span class="n">max_results</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">company_ids</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="c1"># Use V2 batch lookup: GET /companies?ids=1&amp;ids=2&amp;ids=3</span>
    <span class="c1"># Note: company_ids is already truncated by get_associated_company_ids if max_results set</span>
    <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ids&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">cid</span><span class="p">)</span> <span class="k">for</span> <span class="n">cid</span> <span class="ow">in</span> <span class="n">company_ids</span><span class="p">]}</span>

    <span class="n">companies</span><span class="p">:</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">Company</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/companies&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>  <span class="c1"># V2 batch</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">[]):</span>
        <span class="n">companies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Company</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>

    <span class="c1"># Handle pagination if needed (&gt;100 companies)</span>
    <span class="c1"># Note: max_results check is defensive - company_ids was already truncated above</span>
    <span class="n">pagination</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pagination&quot;</span><span class="p">,</span> <span class="p">{})</span>
    <span class="n">next_url</span> <span class="o">=</span> <span class="n">pagination</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nextUrl&quot;</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">next_url</span> <span class="ow">and</span> <span class="p">(</span><span class="n">max_results</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">companies</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">max_results</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get_url</span><span class="p">(</span><span class="n">next_url</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="n">companies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Company</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
        <span class="n">next_url</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pagination&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nextUrl&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">max_results</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">companies</span><span class="p">[:</span><span class="n">max_results</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">companies</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.opportunities.AsyncOpportunityService.get_associated_company_ids" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_associated_company_ids</span><span class="p">(</span><span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">CompanyId</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#affinity.services.opportunities.AsyncOpportunityService.get_associated_company_ids" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Get associated company IDs for an opportunity.</p>
<p>V1-only: V2 does not expose opportunity -&gt; company associations.
Uses GET <code>/opportunities/{id}</code> (V1) and returns <code>organization_ids</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>opportunity_id</code>
            </td>
            <td>
                  <code><span title="affinity.models.types.OpportunityId">OpportunityId</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The opportunity ID</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_results</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of company IDs to return</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="builtins.list">list</span>[<a class="autorefs autorefs-internal" title="CompanyId (affinity.models.types.CompanyId)" href="../../types/#affinity.types.CompanyId">CompanyId</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of CompanyId values associated with this opportunity</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="see-also" open>
  <summary>See Also</summary>
  <ul>
<li>:meth:<code>get_associated_companies</code>: Returns full Company objects</li>
<li>:meth:<code>get_associations</code>: Get both person and company IDs in one call</li>
</ul>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/opportunities.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_associated_company_ids</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">CompanyId</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get associated company IDs for an opportunity.</span>

<span class="sd">    V1-only: V2 does not expose opportunity -&gt; company associations.</span>
<span class="sd">    Uses GET `/opportunities/{id}` (V1) and returns `organization_ids`.</span>

<span class="sd">    Args:</span>
<span class="sd">        opportunity_id: The opportunity ID</span>
<span class="sd">        max_results: Maximum number of company IDs to return</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of CompanyId values associated with this opportunity</span>

<span class="sd">    See Also:</span>
<span class="sd">        - :meth:`get_associated_companies`: Returns full Company objects</span>
<span class="sd">        - :meth:`get_associations`: Get both person and company IDs in one call</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/opportunities/</span><span class="si">{</span><span class="n">opportunity_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Defensive: V1 returns directly (not wrapped), but handle potential wrapper</span>
    <span class="n">opportunity</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;opportunity&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">opportunity</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">opportunity</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">data</span>
    <span class="n">company_ids</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">company_ids</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organization_ids&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organizationIds&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">company_ids</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">CompanyId</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">cid</span><span class="p">))</span> <span class="k">for</span> <span class="n">cid</span> <span class="ow">in</span> <span class="n">company_ids</span> <span class="k">if</span> <span class="n">cid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">max_results</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_results</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ids</span><span class="p">[:</span><span class="n">max_results</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ids</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.opportunities.AsyncOpportunityService.get_associated_company_ids_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_associated_company_ids_batch</span><span class="p">(</span><span class="n">opportunity_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">],</span> <span class="o">*</span><span class="p">,</span> <span class="n">on_error</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;raise&#39;</span><span class="p">,</span> <span class="s1">&#39;skip&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;raise&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">CompanyId</span><span class="p">]]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#affinity.services.opportunities.AsyncOpportunityService.get_associated_company_ids_batch" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Get company associations for multiple opportunities.</p>
<p>Makes one V1 API call per opportunity. Useful for iterating list entries
where V2 returns empty company_ids.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>opportunity_ids</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="affinity.models.types.OpportunityId">OpportunityId</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sequence of opportunity IDs to fetch</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>on_error</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;raise&#39;, &#39;skip&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How to handle errors - "raise" (default) or "skip" failed IDs</p>
              </div>
            </td>
            <td>
                  <code>&#39;raise&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="affinity.models.types.OpportunityId">OpportunityId</span>, <span title="builtins.list">list</span>[<a class="autorefs autorefs-internal" title="CompanyId (affinity.models.types.CompanyId)" href="../../types/#affinity.types.CompanyId">CompanyId</a>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict mapping opportunity_id -&gt; list of company_ids</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="AffinityError (affinity.exceptions.AffinityError)" href="../../exceptions/#affinity.exceptions.AffinityError">AffinityError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If on_error="raise" and any fetch fails. The exception
includes the failing opportunity_id in its context.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <h3 id="affinity.services.opportunities.AsyncOpportunityService.get_associated_company_ids_batch--get-all-companies-from-an-opportunity-list">Get all companies from an opportunity list<a class="headerlink" href="#affinity.services.opportunities.AsyncOpportunityService.get_associated_company_ids_batch--get-all-companies-from-an-opportunity-list" title="Permanent link">&para;</a></h3>
<p>opp_ids = [entry.entity.id async for entry in client.lists.entries(list_id).all()]
associations = await client.opportunities.get_associated_company_ids_batch(opp_ids)
all_company_ids = set()
for company_ids in associations.values():
    all_company_ids.update(company_ids)</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/opportunities.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_associated_company_ids_batch</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">opportunity_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">on_error</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;raise&quot;</span><span class="p">,</span> <span class="s2">&quot;skip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;raise&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">CompanyId</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get company associations for multiple opportunities.</span>

<span class="sd">    Makes one V1 API call per opportunity. Useful for iterating list entries</span>
<span class="sd">    where V2 returns empty company_ids.</span>

<span class="sd">    Args:</span>
<span class="sd">        opportunity_ids: Sequence of opportunity IDs to fetch</span>
<span class="sd">        on_error: How to handle errors - &quot;raise&quot; (default) or &quot;skip&quot; failed IDs</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dict mapping opportunity_id -&gt; list of company_ids</span>

<span class="sd">    Raises:</span>
<span class="sd">        AffinityError: If on_error=&quot;raise&quot; and any fetch fails. The exception</span>
<span class="sd">            includes the failing opportunity_id in its context.</span>

<span class="sd">    Example:</span>
<span class="sd">        # Get all companies from an opportunity list</span>
<span class="sd">        opp_ids = [entry.entity.id async for entry in client.lists.entries(list_id).all()]</span>
<span class="sd">        associations = await client.opportunities.get_associated_company_ids_batch(opp_ids)</span>
<span class="sd">        all_company_ids = set()</span>
<span class="sd">        for company_ids in associations.values():</span>
<span class="sd">            all_company_ids.update(company_ids)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">CompanyId</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">opp_id</span> <span class="ow">in</span> <span class="n">opportunity_ids</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="n">opp_id</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_associated_company_ids</span><span class="p">(</span><span class="n">opp_id</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">AffinityError</span><span class="p">:</span>
            <span class="c1"># Re-raise SDK errors directly - they already have good context</span>
            <span class="k">if</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s2">&quot;raise&quot;</span><span class="p">:</span>
                <span class="k">raise</span>
            <span class="c1"># skip: continue without this opportunity</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s2">&quot;raise&quot;</span><span class="p">:</span>
                <span class="c1"># Wrap non-SDK errors with context, preserving chain</span>
                <span class="k">raise</span> <span class="n">AffinityError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Failed to get company associations for opportunity </span><span class="si">{</span><span class="n">opp_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
            <span class="c1"># skip: continue without this opportunity</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.opportunities.AsyncOpportunityService.get_associated_people" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_associated_people</span><span class="p">(</span><span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">Person</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#affinity.services.opportunities.AsyncOpportunityService.get_associated_people" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Get Person objects associated with an opportunity.</p>
<p>Uses V2 batch lookup for efficiency (1 API call per 100 persons
instead of 1 per person).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>opportunity_id</code>
            </td>
            <td>
                  <code><span title="affinity.models.types.OpportunityId">OpportunityId</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The opportunity ID</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_results</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of people to return</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="builtins.list">list</span>[<a class="autorefs autorefs-internal" title="Person (affinity.models.entities.Person)" href="../../models/#affinity.models.Person">Person</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of Person objects associated with this opportunity</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/opportunities.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_associated_people</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">Person</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get Person objects associated with an opportunity.</span>

<span class="sd">    Uses V2 batch lookup for efficiency (1 API call per 100 persons</span>
<span class="sd">    instead of 1 per person).</span>

<span class="sd">    Args:</span>
<span class="sd">        opportunity_id: The opportunity ID</span>
<span class="sd">        max_results: Maximum number of people to return</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of Person objects associated with this opportunity</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">person_ids</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_associated_person_ids</span><span class="p">(</span><span class="n">opportunity_id</span><span class="p">,</span> <span class="n">max_results</span><span class="o">=</span><span class="n">max_results</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">person_ids</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="c1"># Use V2 batch lookup: GET /persons?ids=1&amp;ids=2&amp;ids=3</span>
    <span class="c1"># Note: person_ids is already truncated by get_associated_person_ids if max_results set</span>
    <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ids&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span> <span class="k">for</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">person_ids</span><span class="p">]}</span>

    <span class="n">people</span><span class="p">:</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">Person</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/persons&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>  <span class="c1"># V2 batch</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">[]):</span>
        <span class="n">people</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>

    <span class="c1"># Handle pagination if needed (&gt;100 persons)</span>
    <span class="c1"># Note: max_results check is defensive - person_ids was already truncated above</span>
    <span class="n">pagination</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pagination&quot;</span><span class="p">,</span> <span class="p">{})</span>
    <span class="n">next_url</span> <span class="o">=</span> <span class="n">pagination</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nextUrl&quot;</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">next_url</span> <span class="ow">and</span> <span class="p">(</span><span class="n">max_results</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">people</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">max_results</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get_url</span><span class="p">(</span><span class="n">next_url</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="n">people</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
        <span class="n">next_url</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pagination&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nextUrl&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">max_results</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">people</span><span class="p">[:</span><span class="n">max_results</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">people</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.opportunities.AsyncOpportunityService.get_associated_person_ids" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_associated_person_ids</span><span class="p">(</span><span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">PersonId</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#affinity.services.opportunities.AsyncOpportunityService.get_associated_person_ids" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Get associated person IDs for an opportunity.</p>
<p>V1-only: V2 does not expose opportunity -&gt; person associations.
Uses GET <code>/opportunities/{id}</code> (V1) and returns <code>person_ids</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>opportunity_id</code>
            </td>
            <td>
                  <code><span title="affinity.models.types.OpportunityId">OpportunityId</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The opportunity ID</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_results</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of person IDs to return</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="builtins.list">list</span>[<span title="affinity.models.types.PersonId">PersonId</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of PersonId values associated with this opportunity</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="see-also" open>
  <summary>See Also</summary>
  <ul>
<li>:meth:<code>get_associated_people</code>: Returns full Person objects</li>
<li>:meth:<code>get_associations</code>: Get both person and company IDs in one call</li>
</ul>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/opportunities.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_associated_person_ids</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">PersonId</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get associated person IDs for an opportunity.</span>

<span class="sd">    V1-only: V2 does not expose opportunity -&gt; person associations.</span>
<span class="sd">    Uses GET `/opportunities/{id}` (V1) and returns `person_ids`.</span>

<span class="sd">    Args:</span>
<span class="sd">        opportunity_id: The opportunity ID</span>
<span class="sd">        max_results: Maximum number of person IDs to return</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of PersonId values associated with this opportunity</span>

<span class="sd">    See Also:</span>
<span class="sd">        - :meth:`get_associated_people`: Returns full Person objects</span>
<span class="sd">        - :meth:`get_associations`: Get both person and company IDs in one call</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/opportunities/</span><span class="si">{</span><span class="n">opportunity_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Defensive: V1 returns directly (not wrapped), but handle potential wrapper</span>
    <span class="n">opportunity</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;opportunity&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">opportunity</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">opportunity</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">data</span>
    <span class="n">person_ids</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">person_ids</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;person_ids&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;personIds&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">person_ids</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">PersonId</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">pid</span><span class="p">))</span> <span class="k">for</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">person_ids</span> <span class="k">if</span> <span class="n">pid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">max_results</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_results</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ids</span><span class="p">[:</span><span class="n">max_results</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ids</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.opportunities.AsyncOpportunityService.get_associated_person_ids_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_associated_person_ids_batch</span><span class="p">(</span><span class="n">opportunity_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">],</span> <span class="o">*</span><span class="p">,</span> <span class="n">on_error</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;raise&#39;</span><span class="p">,</span> <span class="s1">&#39;skip&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;raise&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">PersonId</span><span class="p">]]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#affinity.services.opportunities.AsyncOpportunityService.get_associated_person_ids_batch" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Get person associations for multiple opportunities.</p>
<p>Makes one V1 API call per opportunity. Useful for iterating list entries
where V2 returns empty person_ids.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>opportunity_ids</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="affinity.models.types.OpportunityId">OpportunityId</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sequence of opportunity IDs to fetch</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>on_error</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;raise&#39;, &#39;skip&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How to handle errors - "raise" (default) or "skip" failed IDs</p>
              </div>
            </td>
            <td>
                  <code>&#39;raise&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="affinity.models.types.OpportunityId">OpportunityId</span>, <span title="builtins.list">list</span>[<span title="affinity.models.types.PersonId">PersonId</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict mapping opportunity_id -&gt; list of person_ids</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="AffinityError (affinity.exceptions.AffinityError)" href="../../exceptions/#affinity.exceptions.AffinityError">AffinityError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If on_error="raise" and any fetch fails. The exception
includes the failing opportunity_id in its context.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <h3 id="affinity.services.opportunities.AsyncOpportunityService.get_associated_person_ids_batch--get-all-persons-from-an-opportunity-list">Get all persons from an opportunity list<a class="headerlink" href="#affinity.services.opportunities.AsyncOpportunityService.get_associated_person_ids_batch--get-all-persons-from-an-opportunity-list" title="Permanent link">&para;</a></h3>
<p>opp_ids = [entry.entity.id async for entry in client.lists.entries(list_id).all()]
associations = await client.opportunities.get_associated_person_ids_batch(opp_ids)
all_person_ids = set()
for person_ids in associations.values():
    all_person_ids.update(person_ids)</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/opportunities.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_associated_person_ids_batch</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">opportunity_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">on_error</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;raise&quot;</span><span class="p">,</span> <span class="s2">&quot;skip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;raise&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">PersonId</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get person associations for multiple opportunities.</span>

<span class="sd">    Makes one V1 API call per opportunity. Useful for iterating list entries</span>
<span class="sd">    where V2 returns empty person_ids.</span>

<span class="sd">    Args:</span>
<span class="sd">        opportunity_ids: Sequence of opportunity IDs to fetch</span>
<span class="sd">        on_error: How to handle errors - &quot;raise&quot; (default) or &quot;skip&quot; failed IDs</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dict mapping opportunity_id -&gt; list of person_ids</span>

<span class="sd">    Raises:</span>
<span class="sd">        AffinityError: If on_error=&quot;raise&quot; and any fetch fails. The exception</span>
<span class="sd">            includes the failing opportunity_id in its context.</span>

<span class="sd">    Example:</span>
<span class="sd">        # Get all persons from an opportunity list</span>
<span class="sd">        opp_ids = [entry.entity.id async for entry in client.lists.entries(list_id).all()]</span>
<span class="sd">        associations = await client.opportunities.get_associated_person_ids_batch(opp_ids)</span>
<span class="sd">        all_person_ids = set()</span>
<span class="sd">        for person_ids in associations.values():</span>
<span class="sd">            all_person_ids.update(person_ids)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">PersonId</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">opp_id</span> <span class="ow">in</span> <span class="n">opportunity_ids</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="n">opp_id</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_associated_person_ids</span><span class="p">(</span><span class="n">opp_id</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">AffinityError</span><span class="p">:</span>
            <span class="c1"># Re-raise SDK errors directly - they already have good context</span>
            <span class="k">if</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s2">&quot;raise&quot;</span><span class="p">:</span>
                <span class="k">raise</span>
            <span class="c1"># skip: continue without this opportunity</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s2">&quot;raise&quot;</span><span class="p">:</span>
                <span class="c1"># Wrap non-SDK errors with context, preserving chain</span>
                <span class="k">raise</span> <span class="n">AffinityError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Failed to get associations for opportunity </span><span class="si">{</span><span class="n">opp_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
            <span class="c1"># skip: continue without this opportunity</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.opportunities.AsyncOpportunityService.get_associations" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_associations</span><span class="p">(</span><span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OpportunityAssociations</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#affinity.services.opportunities.AsyncOpportunityService.get_associations" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Get both person and company associations in a single V1 call.</p>
<p>Use this when you need both types of associations to avoid
duplicate API calls from separate get_associated_*_ids() calls.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>opportunity_id</code>
            </td>
            <td>
                  <code><span title="affinity.models.types.OpportunityId">OpportunityId</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The opportunity ID</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="affinity.services.opportunities.OpportunityAssociations">OpportunityAssociations</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>OpportunityAssociations named tuple with person_ids and company_ids</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <p>assoc = await client.opportunities.get_associations(opp_id)
print(assoc.person_ids)   # IDE autocomplete works
print(assoc.company_ids)  # IDE autocomplete works</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/opportunities.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_associations</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OpportunityAssociations</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get both person and company associations in a single V1 call.</span>

<span class="sd">    Use this when you need both types of associations to avoid</span>
<span class="sd">    duplicate API calls from separate get_associated_*_ids() calls.</span>

<span class="sd">    Args:</span>
<span class="sd">        opportunity_id: The opportunity ID</span>

<span class="sd">    Returns:</span>
<span class="sd">        OpportunityAssociations named tuple with person_ids and company_ids</span>

<span class="sd">    Example:</span>
<span class="sd">        assoc = await client.opportunities.get_associations(opp_id)</span>
<span class="sd">        print(assoc.person_ids)   # IDE autocomplete works</span>
<span class="sd">        print(assoc.company_ids)  # IDE autocomplete works</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/opportunities/</span><span class="si">{</span><span class="n">opportunity_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Defensive: V1 returns directly (not wrapped), but handle potential wrapper</span>
    <span class="n">opportunity</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;opportunity&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">opportunity</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">opportunity</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">data</span>

    <span class="n">person_ids</span><span class="p">:</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">PersonId</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">company_ids</span><span class="p">:</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">CompanyId</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">raw_person_ids</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;person_ids&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;personIds&quot;</span><span class="p">)</span>
        <span class="n">raw_company_ids</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organization_ids&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organizationIds&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">raw_person_ids</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">person_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">PersonId</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">pid</span><span class="p">))</span> <span class="k">for</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">raw_person_ids</span> <span class="k">if</span> <span class="n">pid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">raw_company_ids</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">company_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">CompanyId</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">cid</span><span class="p">))</span> <span class="k">for</span> <span class="n">cid</span> <span class="ow">in</span> <span class="n">raw_company_ids</span> <span class="k">if</span> <span class="n">cid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">OpportunityAssociations</span><span class="p">(</span><span class="n">person_ids</span><span class="o">=</span><span class="n">person_ids</span><span class="p">,</span> <span class="n">company_ids</span><span class="o">=</span><span class="n">company_ids</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.opportunities.AsyncOpportunityService.get_details" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_details</span><span class="p">(</span><span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Opportunity</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#affinity.services.opportunities.AsyncOpportunityService.get_details" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Get a single opportunity by ID with a more complete representation.</p>
<p>Includes association IDs and (when present) list entries, which are not
always included in the default <code>get()</code> response.</p>


<details class="see-also" open>
  <summary>See Also</summary>
  <ul>
<li>:meth:<code>get_associated_person_ids</code>: Get just person IDs (single API call)</li>
<li>:meth:<code>get_associated_people</code>: Get full Person objects</li>
<li>:meth:<code>get_associated_company_ids</code>: Get just company IDs (single API call)</li>
<li>:meth:<code>get_associated_companies</code>: Get full Company objects</li>
<li>:meth:<code>get_associations</code>: Get both person and company IDs in one call</li>
</ul>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/opportunities.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_details</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Opportunity</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a single opportunity by ID with a more complete representation.</span>

<span class="sd">    Includes association IDs and (when present) list entries, which are not</span>
<span class="sd">    always included in the default `get()` response.</span>

<span class="sd">    See Also:</span>
<span class="sd">        - :meth:`get_associated_person_ids`: Get just person IDs (single API call)</span>
<span class="sd">        - :meth:`get_associated_people`: Get full Person objects</span>
<span class="sd">        - :meth:`get_associated_company_ids`: Get just company IDs (single API call)</span>
<span class="sd">        - :meth:`get_associated_companies`: Get full Company objects</span>
<span class="sd">        - :meth:`get_associations`: Get both person and company IDs in one call</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Uses the v1 endpoint because it returns a fuller payload (including</span>
    <span class="c1"># association IDs and, when present, list entries).</span>
    <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/opportunities/</span><span class="si">{</span><span class="n">opportunity_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Opportunity</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.opportunities.AsyncOpportunityService.iter" class="doc doc-heading">
            <code class="highlight language-python"><span class="nb">iter</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]</span></code>

<a href="#affinity.services.opportunities.AsyncOpportunityService.iter" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Auto-paginate all opportunities.</p>
<p>Alias for <code>all()</code> (FR-006 public contract).</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/opportunities.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">iter</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Auto-paginate all opportunities.</span>

<span class="sd">    Alias for `all()` (FR-006 public contract).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">ids</span><span class="o">=</span><span class="n">ids</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.opportunities.AsyncOpportunityService.list" class="doc doc-heading">
            <code class="highlight language-python"><span class="nb">list</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cursor</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#affinity.services.opportunities.AsyncOpportunityService.list" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>List all opportunities.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ids</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="affinity.models.types.OpportunityId">OpportunityId</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Specific opportunity IDs to fetch (batch lookup)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>limit</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of results per page</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cursor</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cursor to resume pagination (opaque; obtained from prior responses)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns the v2 opportunity representation (which may be partial).
For full opportunity row data, use list entries explicitly.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/opportunities.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">cursor</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    List all opportunities.</span>

<span class="sd">    Args:</span>
<span class="sd">        ids: Specific opportunity IDs to fetch (batch lookup)</span>
<span class="sd">        limit: Maximum number of results per page</span>
<span class="sd">        cursor: Cursor to resume pagination (opaque; obtained from prior responses)</span>

<span class="sd">    Returns the v2 opportunity representation (which may be partial).</span>
<span class="sd">    For full opportunity row data, use list entries explicitly.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">cursor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">limit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot combine &#39;cursor&#39; with other parameters; cursor encodes all query &quot;</span>
                <span class="s2">&quot;context. Start a new pagination sequence without a cursor to change &quot;</span>
                <span class="s2">&quot;parameters.&quot;</span>
            <span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get_url</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">ids</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;ids&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span> <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">limit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;limit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">limit</span>
        <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/opportunities&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">](</span>
        <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">Opportunity</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">[])],</span>
        <span class="n">pagination</span><span class="o">=</span><span class="n">PaginationInfo</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pagination&quot;</span><span class="p">,</span> <span class="p">{})),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.opportunities.AsyncOpportunityService.pages" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pages</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cursor</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#affinity.services.opportunities.AsyncOpportunityService.pages" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Iterate opportunity pages (not items), yielding <code>PaginatedResponse[Opportunity]</code>.</p>
<p>This is useful for ETL scripts that want checkpoint/resume via <code>page.next_cursor</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ids</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="affinity.models.types.OpportunityId">OpportunityId</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Specific opportunity IDs to fetch (batch lookup)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>limit</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum results per page</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cursor</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cursor to resume pagination</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/opportunities.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">pages</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">cursor</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Iterate opportunity pages (not items), yielding `PaginatedResponse[Opportunity]`.</span>

<span class="sd">    This is useful for ETL scripts that want checkpoint/resume via `page.next_cursor`.</span>

<span class="sd">    Args:</span>
<span class="sd">        ids: Specific opportunity IDs to fetch (batch lookup)</span>
<span class="sd">        limit: Maximum results per page</span>
<span class="sd">        cursor: Cursor to resume pagination</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">other_params</span> <span class="o">=</span> <span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cursor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="n">p</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">other_params</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Cannot combine &#39;cursor&#39; with other parameters; cursor encodes all query context. &quot;</span>
            <span class="s2">&quot;Start a new pagination sequence without a cursor to change parameters.&quot;</span>
        <span class="p">)</span>
    <span class="n">requested_cursor</span> <span class="o">=</span> <span class="n">cursor</span>
    <span class="n">page</span> <span class="o">=</span> <span class="p">(</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">cursor</span><span class="o">=</span><span class="n">cursor</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cursor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">else</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">ids</span><span class="o">=</span><span class="n">ids</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">page</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">page</span><span class="o">.</span><span class="n">has_next</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">next_cursor</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">next_cursor</span>
        <span class="k">if</span> <span class="n">next_cursor</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">next_cursor</span> <span class="o">==</span> <span class="n">requested_cursor</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">requested_cursor</span> <span class="o">=</span> <span class="n">next_cursor</span>
        <span class="n">page</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">cursor</span><span class="o">=</span><span class="n">next_cursor</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.opportunities.AsyncOpportunityService.resolve" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">resolve</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">list_id</span><span class="p">:</span> <span class="n">ListId</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Opportunity</span> <span class="o">|</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#affinity.services.opportunities.AsyncOpportunityService.resolve" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Find a single opportunity by exact name within a specific list.</p>
<p>Notes:
- Opportunities are list-scoped; a list id is required.
- This iterates list-entry pages client-side (no dedicated search endpoint).
- If multiple matches exist, returns the first match in server-provided order.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/opportunities.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">resolve</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">list_id</span><span class="p">:</span> <span class="n">ListId</span><span class="p">,</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Opportunity</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find a single opportunity by exact name within a specific list.</span>

<span class="sd">    Notes:</span>
<span class="sd">    - Opportunities are list-scoped; a list id is required.</span>
<span class="sd">    - This iterates list-entry pages client-side (no dedicated search endpoint).</span>
<span class="sd">    - If multiple matches exist, returns the first match in server-provided order.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Name cannot be empty&quot;</span><span class="p">)</span>
    <span class="n">name_lower</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="n">entries</span> <span class="o">=</span> <span class="n">AsyncListEntryService</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="p">,</span> <span class="n">list_id</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">entries</span><span class="o">.</span><span class="n">pages</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">page</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="n">entity</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">entity</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">Opportunity</span><span class="p">)</span> <span class="ow">and</span> <span class="n">entity</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">name_lower</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">entity</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.opportunities.AsyncOpportunityService.resolve_all" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">resolve_all</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">list_id</span><span class="p">:</span> <span class="n">ListId</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#affinity.services.opportunities.AsyncOpportunityService.resolve_all" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Find all opportunities matching a name within a specific list.</p>
<p>Notes:
- Opportunities are list-scoped; a list id is required.
- This iterates list-entry pages client-side (no dedicated search endpoint).</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/opportunities.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">resolve_all</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">list_id</span><span class="p">:</span> <span class="n">ListId</span><span class="p">,</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find all opportunities matching a name within a specific list.</span>

<span class="sd">    Notes:</span>
<span class="sd">    - Opportunities are list-scoped; a list id is required.</span>
<span class="sd">    - This iterates list-entry pages client-side (no dedicated search endpoint).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Name cannot be empty&quot;</span><span class="p">)</span>
    <span class="n">name_lower</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">matches</span><span class="p">:</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">entries</span> <span class="o">=</span> <span class="n">AsyncListEntryService</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="p">,</span> <span class="n">list_id</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">entries</span><span class="o">.</span><span class="n">pages</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">page</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="n">entity</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">entity</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">Opportunity</span><span class="p">)</span> <span class="ow">and</span> <span class="n">entity</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">name_lower</span><span class="p">:</span>
                <span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">matches</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.opportunities.AsyncOpportunityService.search" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">search</span><span class="p">(</span><span class="n">term</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">page_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">page_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#affinity.services.opportunities.AsyncOpportunityService.search" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Search for opportunities by name.</p>
<p>Uses V1 API for search functionality.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>term</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Search term (matches opportunity name). If None, returns all.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>page_size</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Results per page (max 500)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>page_token</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pagination token</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="PaginatedResponse (affinity.models.pagination.PaginatedResponse)" href="../../models/#affinity.models.PaginatedResponse">PaginatedResponse</a>[<a class="autorefs autorefs-internal" title="Opportunity (affinity.models.entities.Opportunity)" href="../../models/#affinity.models.Opportunity">Opportunity</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>PaginatedResponse with opportunities and next_page_token</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/opportunities.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">search</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">term</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">page_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">page_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Search for opportunities by name.</span>

<span class="sd">    Uses V1 API for search functionality.</span>

<span class="sd">    Args:</span>
<span class="sd">        term: Search term (matches opportunity name). If None, returns all.</span>
<span class="sd">        page_size: Results per page (max 500)</span>
<span class="sd">        page_token: Pagination token</span>

<span class="sd">    Returns:</span>
<span class="sd">        PaginatedResponse with opportunities and next_page_token</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">term</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;term&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">term</span>
    <span class="k">if</span> <span class="n">page_size</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;page_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">page_size</span>
    <span class="k">if</span> <span class="n">page_token</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;page_token&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">page_token</span>

    <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/opportunities&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">Opportunity</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;opportunities&quot;</span><span class="p">,</span> <span class="p">[])]</span>
    <span class="k">return</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">](</span>
        <span class="n">data</span><span class="o">=</span><span class="n">items</span><span class="p">,</span>
        <span class="n">next_page_token</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;next_page_token&quot;</span><span class="p">),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.opportunities.AsyncOpportunityService.search_all" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">search_all</span><span class="p">(</span><span class="n">term</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">page_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">page_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#affinity.services.opportunities.AsyncOpportunityService.search_all" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Iterate all V1 opportunity-search results with automatic pagination.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>term</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Search term (matches opportunity name). If None, returns all.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>page_size</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Results per page (max 500)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>page_token</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Resume from this pagination token</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Yields:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="collections.abc.AsyncIterator">AsyncIterator</span>[<a class="autorefs autorefs-internal" title="Opportunity (affinity.models.entities.Opportunity)" href="../../models/#affinity.models.Opportunity">Opportunity</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Each Opportunity individually</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/opportunities.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">977</span>
<span class="normal">978</span>
<span class="normal">979</span>
<span class="normal">980</span>
<span class="normal">981</span>
<span class="normal">982</span>
<span class="normal">983</span>
<span class="normal">984</span>
<span class="normal">985</span>
<span class="normal">986</span>
<span class="normal">987</span>
<span class="normal">988</span>
<span class="normal">989</span>
<span class="normal">990</span>
<span class="normal">991</span>
<span class="normal">992</span>
<span class="normal">993</span>
<span class="normal">994</span>
<span class="normal">995</span>
<span class="normal">996</span>
<span class="normal">997</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">search_all</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">term</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">page_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">page_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Iterate all V1 opportunity-search results with automatic pagination.</span>

<span class="sd">    Args:</span>
<span class="sd">        term: Search term (matches opportunity name). If None, returns all.</span>
<span class="sd">        page_size: Results per page (max 500)</span>
<span class="sd">        page_token: Resume from this pagination token</span>

<span class="sd">    Yields:</span>
<span class="sd">        Each Opportunity individually</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">async</span> <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_pages</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">page_size</span><span class="o">=</span><span class="n">page_size</span><span class="p">,</span> <span class="n">page_token</span><span class="o">=</span><span class="n">page_token</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">opp</span> <span class="ow">in</span> <span class="n">page</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">opp</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.opportunities.AsyncOpportunityService.search_pages" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">search_pages</span><span class="p">(</span><span class="n">term</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">page_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">page_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#affinity.services.opportunities.AsyncOpportunityService.search_pages" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Iterate V1 opportunity-search result pages.</p>
<p>Useful for scripts that need checkpoint/resume via <code>next_page_token</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>term</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Search term (matches opportunity name). If None, returns all.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>page_size</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Results per page (max 500)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>page_token</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Resume from this pagination token</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Yields:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="collections.abc.AsyncIterator">AsyncIterator</span>[<a class="autorefs autorefs-internal" title="PaginatedResponse (affinity.models.pagination.PaginatedResponse)" href="../../models/#affinity.models.PaginatedResponse">PaginatedResponse</a>[<a class="autorefs autorefs-internal" title="Opportunity (affinity.models.entities.Opportunity)" href="../../models/#affinity.models.Opportunity">Opportunity</a>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>PaginatedResponse[Opportunity] for each page</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/opportunities.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">search_pages</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">term</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">page_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">page_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Opportunity</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Iterate V1 opportunity-search result pages.</span>

<span class="sd">    Useful for scripts that need checkpoint/resume via `next_page_token`.</span>

<span class="sd">    Args:</span>
<span class="sd">        term: Search term (matches opportunity name). If None, returns all.</span>
<span class="sd">        page_size: Results per page (max 500)</span>
<span class="sd">        page_token: Resume from this pagination token</span>

<span class="sd">    Yields:</span>
<span class="sd">        PaginatedResponse[Opportunity] for each page</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">requested_token</span> <span class="o">=</span> <span class="n">page_token</span>
    <span class="n">page</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">page_size</span><span class="o">=</span><span class="n">page_size</span><span class="p">,</span> <span class="n">page_token</span><span class="o">=</span><span class="n">page_token</span><span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">page</span>
        <span class="n">next_token</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">next_page_token</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">next_token</span> <span class="ow">or</span> <span class="n">next_token</span> <span class="o">==</span> <span class="n">requested_token</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">requested_token</span> <span class="o">=</span> <span class="n">next_token</span>
        <span class="n">page</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">page_size</span><span class="o">=</span><span class="n">page_size</span><span class="p">,</span> <span class="n">page_token</span><span class="o">=</span><span class="n">next_token</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.opportunities.AsyncOpportunityService.update" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update</span><span class="p">(</span><span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">OpportunityUpdate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Opportunity</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#affinity.services.opportunities.AsyncOpportunityService.update" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Update an existing opportunity.</p>
<p>Note: When provided, <code>person_ids</code> and <code>company_ids</code> replace the existing
values. To add or remove associations safely, pass the full desired arrays.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/opportunities.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opportunity_id</span><span class="p">:</span> <span class="n">OpportunityId</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">OpportunityUpdate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Opportunity</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update an existing opportunity.</span>

<span class="sd">    Note: When provided, `person_ids` and `company_ids` replace the existing</span>
<span class="sd">    values. To add or remove associations safely, pass the full desired arrays.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span>
        <span class="n">by_alias</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">,</span>
        <span class="n">exclude_unset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Uses the v1 endpoint; its PUT semantics replace association arrays.</span>
    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/opportunities/</span><span class="si">{</span><span class="n">opportunity_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Opportunity</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Disclaimer: Unofficial community project; not affiliated with, endorsed by, or sponsored by Affinity. "Affinity" and related marks are trademarks of their respective owners. Use of the Affinity API is subject to Affinity Terms of Service.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>