
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Strongly-typed Python SDK for the Affinity CRM API">
      
      
      
      
        <link rel="prev" href="../companies/">
      
      
        <link rel="next" href="../lists/">
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Persons - Affinity Python SDK</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#persons" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Affinity Python SDK" class="md-header__button md-logo" aria-label="Affinity Python SDK" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Affinity Python SDK
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Persons
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/yaniv-golan/affinity-sdk" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Affinity Python SDK" class="md-nav__button md-logo" aria-label="Affinity Python SDK" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Affinity Python SDK
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/yaniv-golan/affinity-sdk" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting-started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Getting started
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Examples
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../glossary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Glossary
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Changelog
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    CLI
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    CLI
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cli/commands/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Commands
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cli/scripting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Scripting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cli-reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    JSON Output Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    AI Integrations
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    AI Integrations
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ai-integrations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../mcp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MCP Server
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/claude-code-plugins/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Claude Code Plugins & Skills
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Guides
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Guides
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/authentication/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Authentication
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/performance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Performance tuning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/api-versions-and-routing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API versions & routing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/pagination/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Pagination
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/errors-and-retries/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Errors & retries
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/rate-limits/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Rate limits
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/filtering/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Filtering
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/query-command/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Query command
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/datetime-handling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Datetime handling
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/csv-export/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CSV Export (CLI)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/field-types-and-values/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Field types & values
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/field-values/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Field values
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Models
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/ids-and-types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IDs & types
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/sync-vs-async/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sync vs async
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/debugging-hooks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Debugging hooks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/webhooks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Webhooks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/opportunity-associations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Opportunity associations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../troubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Troubleshooting
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" checked>
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../client/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Client
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../exceptions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Exceptions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Types
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../filters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Filters
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../query-language/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Query Language
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Models
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_7" checked>
        
          
          <label class="md-nav__link" for="__nav_10_7" id="__nav_10_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Services
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_10_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Services
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../companies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Companies
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Persons
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Persons
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#interaction-dates" class="md-nav__link">
    <span class="md-ellipsis">
      
        Interaction Dates
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.PersonService" class="md-nav__link">
    <span class="md-ellipsis">
      
        PersonService
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.PersonService.all" class="md-nav__link">
    <span class="md-ellipsis">
      
        all
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.PersonService.create" class="md-nav__link">
    <span class="md-ellipsis">
      
        create
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.PersonService.delete" class="md-nav__link">
    <span class="md-ellipsis">
      
        delete
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.PersonService.get" class="md-nav__link">
    <span class="md-ellipsis">
      
        get
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.PersonService.get_associated_company_ids" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_associated_company_ids
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.PersonService.get_associated_company_ids_batch" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_associated_company_ids_batch
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.PersonService.get_associated_opportunity_ids" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_associated_opportunity_ids
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.PersonService.get_associated_opportunity_ids_batch" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_associated_opportunity_ids_batch
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.PersonService.get_fields" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_fields
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.PersonService.get_list_entries" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_list_entries
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.PersonService.get_lists" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_lists
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.PersonService.get_merge_status" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_merge_status
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.PersonService.iter" class="md-nav__link">
    <span class="md-ellipsis">
      
        iter
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.PersonService.list" class="md-nav__link">
    <span class="md-ellipsis">
      
        list
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.PersonService.merge" class="md-nav__link">
    <span class="md-ellipsis">
      
        merge
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.PersonService.pages" class="md-nav__link">
    <span class="md-ellipsis">
      
        pages
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.PersonService.resolve" class="md-nav__link">
    <span class="md-ellipsis">
      
        resolve
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.PersonService.resolve_all" class="md-nav__link">
    <span class="md-ellipsis">
      
        resolve_all
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.PersonService.search" class="md-nav__link">
    <span class="md-ellipsis">
      
        search
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.PersonService.search_all" class="md-nav__link">
    <span class="md-ellipsis">
      
        search_all
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.PersonService.search_pages" class="md-nav__link">
    <span class="md-ellipsis">
      
        search_pages
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.PersonService.update" class="md-nav__link">
    <span class="md-ellipsis">
      
        update
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.AsyncPersonService" class="md-nav__link">
    <span class="md-ellipsis">
      
        AsyncPersonService
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.AsyncPersonService.all" class="md-nav__link">
    <span class="md-ellipsis">
      
        all
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.AsyncPersonService.create" class="md-nav__link">
    <span class="md-ellipsis">
      
        create
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.AsyncPersonService.delete" class="md-nav__link">
    <span class="md-ellipsis">
      
        delete
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.AsyncPersonService.get" class="md-nav__link">
    <span class="md-ellipsis">
      
        get
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.AsyncPersonService.get_associated_company_ids" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_associated_company_ids
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.AsyncPersonService.get_associated_company_ids_batch" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_associated_company_ids_batch
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.AsyncPersonService.get_associated_opportunity_ids" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_associated_opportunity_ids
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.AsyncPersonService.get_associated_opportunity_ids_batch" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_associated_opportunity_ids_batch
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.AsyncPersonService.get_fields" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_fields
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.AsyncPersonService.get_list_entries" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_list_entries
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.AsyncPersonService.get_lists" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_lists
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.AsyncPersonService.get_merge_status" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_merge_status
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.AsyncPersonService.iter" class="md-nav__link">
    <span class="md-ellipsis">
      
        iter
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.AsyncPersonService.list" class="md-nav__link">
    <span class="md-ellipsis">
      
        list
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.AsyncPersonService.merge" class="md-nav__link">
    <span class="md-ellipsis">
      
        merge
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.AsyncPersonService.pages" class="md-nav__link">
    <span class="md-ellipsis">
      
        pages
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.AsyncPersonService.resolve" class="md-nav__link">
    <span class="md-ellipsis">
      
        resolve
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.AsyncPersonService.resolve_all" class="md-nav__link">
    <span class="md-ellipsis">
      
        resolve_all
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.AsyncPersonService.search" class="md-nav__link">
    <span class="md-ellipsis">
      
        search
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.AsyncPersonService.search_all" class="md-nav__link">
    <span class="md-ellipsis">
      
        search_all
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.AsyncPersonService.search_pages" class="md-nav__link">
    <span class="md-ellipsis">
      
        search_pages
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.AsyncPersonService.update" class="md-nav__link">
    <span class="md-ellipsis">
      
        update
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lists/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lists
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../opportunities/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Opportunities
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tasks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tasks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_7_6" >
        
          
          <label class="md-nav__link" for="__nav_10_7_6" id="__nav_10_7_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    V1 endpoints
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_10_7_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_7_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    V1 endpoints
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../v1/notes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Notes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../v1/reminders/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Reminders
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../v1/webhooks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Webhooks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../v1/interactions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Interactions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../v1/fields/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Fields
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../v1/field-values/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Field values
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../v1/files/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Files
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../v1/relationships/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Relationships
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../v1/auth/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Auth
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#interaction-dates" class="md-nav__link">
    <span class="md-ellipsis">
      
        Interaction Dates
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.PersonService" class="md-nav__link">
    <span class="md-ellipsis">
      
        PersonService
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.PersonService.all" class="md-nav__link">
    <span class="md-ellipsis">
      
        all
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.PersonService.create" class="md-nav__link">
    <span class="md-ellipsis">
      
        create
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.PersonService.delete" class="md-nav__link">
    <span class="md-ellipsis">
      
        delete
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.PersonService.get" class="md-nav__link">
    <span class="md-ellipsis">
      
        get
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.PersonService.get_associated_company_ids" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_associated_company_ids
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.PersonService.get_associated_company_ids_batch" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_associated_company_ids_batch
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.PersonService.get_associated_opportunity_ids" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_associated_opportunity_ids
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.PersonService.get_associated_opportunity_ids_batch" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_associated_opportunity_ids_batch
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.PersonService.get_fields" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_fields
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.PersonService.get_list_entries" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_list_entries
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.PersonService.get_lists" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_lists
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.PersonService.get_merge_status" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_merge_status
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.PersonService.iter" class="md-nav__link">
    <span class="md-ellipsis">
      
        iter
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.PersonService.list" class="md-nav__link">
    <span class="md-ellipsis">
      
        list
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.PersonService.merge" class="md-nav__link">
    <span class="md-ellipsis">
      
        merge
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.PersonService.pages" class="md-nav__link">
    <span class="md-ellipsis">
      
        pages
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.PersonService.resolve" class="md-nav__link">
    <span class="md-ellipsis">
      
        resolve
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.PersonService.resolve_all" class="md-nav__link">
    <span class="md-ellipsis">
      
        resolve_all
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.PersonService.search" class="md-nav__link">
    <span class="md-ellipsis">
      
        search
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.PersonService.search_all" class="md-nav__link">
    <span class="md-ellipsis">
      
        search_all
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.PersonService.search_pages" class="md-nav__link">
    <span class="md-ellipsis">
      
        search_pages
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.PersonService.update" class="md-nav__link">
    <span class="md-ellipsis">
      
        update
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.AsyncPersonService" class="md-nav__link">
    <span class="md-ellipsis">
      
        AsyncPersonService
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.AsyncPersonService.all" class="md-nav__link">
    <span class="md-ellipsis">
      
        all
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.AsyncPersonService.create" class="md-nav__link">
    <span class="md-ellipsis">
      
        create
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.AsyncPersonService.delete" class="md-nav__link">
    <span class="md-ellipsis">
      
        delete
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.AsyncPersonService.get" class="md-nav__link">
    <span class="md-ellipsis">
      
        get
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.AsyncPersonService.get_associated_company_ids" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_associated_company_ids
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.AsyncPersonService.get_associated_company_ids_batch" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_associated_company_ids_batch
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.AsyncPersonService.get_associated_opportunity_ids" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_associated_opportunity_ids
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.AsyncPersonService.get_associated_opportunity_ids_batch" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_associated_opportunity_ids_batch
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.AsyncPersonService.get_fields" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_fields
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.AsyncPersonService.get_list_entries" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_list_entries
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.AsyncPersonService.get_lists" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_lists
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.AsyncPersonService.get_merge_status" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_merge_status
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.AsyncPersonService.iter" class="md-nav__link">
    <span class="md-ellipsis">
      
        iter
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.AsyncPersonService.list" class="md-nav__link">
    <span class="md-ellipsis">
      
        list
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.AsyncPersonService.merge" class="md-nav__link">
    <span class="md-ellipsis">
      
        merge
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.AsyncPersonService.pages" class="md-nav__link">
    <span class="md-ellipsis">
      
        pages
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.AsyncPersonService.resolve" class="md-nav__link">
    <span class="md-ellipsis">
      
        resolve
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.AsyncPersonService.resolve_all" class="md-nav__link">
    <span class="md-ellipsis">
      
        resolve_all
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.AsyncPersonService.search" class="md-nav__link">
    <span class="md-ellipsis">
      
        search
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.AsyncPersonService.search_all" class="md-nav__link">
    <span class="md-ellipsis">
      
        search_all
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.AsyncPersonService.search_pages" class="md-nav__link">
    <span class="md-ellipsis">
      
        search_pages
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#affinity.services.persons.AsyncPersonService.update" class="md-nav__link">
    <span class="md-ellipsis">
      
        update
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="persons">Persons<a class="headerlink" href="#persons" title="Permanent link">&para;</a></h1>
<h2 id="interaction-dates">Interaction Dates<a class="headerlink" href="#interaction-dates" title="Permanent link">&para;</a></h2>
<p>The <code>get()</code> method supports fetching interaction date summaries for a person using the
<code>with_interaction_dates</code> parameter. When enabled, the returned <code>Person</code> object will have
its <code>interaction_dates</code> and <code>interactions</code> fields populated with:</p>
<ul>
<li><strong>Last meeting date</strong>: When the last calendar event with this person occurred</li>
<li><strong>Next meeting date</strong>: When the next scheduled calendar event is</li>
<li><strong>Last email date</strong>: When the last email exchange happened</li>
<li><strong>Last interaction date</strong>: The most recent interaction of any type</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">affinity</span><span class="w"> </span><span class="kn">import</span> <span class="n">Affinity</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">affinity.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">PersonId</span>

<span class="k">with</span> <span class="n">Affinity</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="s2">&quot;YOUR_API_KEY&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
    <span class="c1"># Fetch person with interaction dates</span>
    <span class="n">person</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">persons</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="n">PersonId</span><span class="p">(</span><span class="mi">456</span><span class="p">),</span>
        <span class="n">with_interaction_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">with_interaction_persons</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Include person IDs for each interaction</span>
    <span class="p">)</span>

    <span class="c1"># Access interaction data</span>
    <span class="k">if</span> <span class="n">person</span><span class="o">.</span><span class="n">interaction_dates</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Last meeting: </span><span class="si">{</span><span class="n">person</span><span class="o">.</span><span class="n">interaction_dates</span><span class="o">.</span><span class="n">last_event_date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Next meeting: </span><span class="si">{</span><span class="n">person</span><span class="o">.</span><span class="n">interaction_dates</span><span class="o">.</span><span class="n">next_event_date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Last email: </span><span class="si">{</span><span class="n">person</span><span class="o">.</span><span class="n">interaction_dates</span><span class="o">.</span><span class="n">last_email_date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Access team member IDs from interactions</span>
    <span class="k">if</span> <span class="n">person</span><span class="o">.</span><span class="n">interactions</span> <span class="ow">and</span> <span class="n">person</span><span class="o">.</span><span class="n">interactions</span><span class="o">.</span><span class="n">last_event</span><span class="p">:</span>
        <span class="n">team_ids</span> <span class="o">=</span> <span class="n">person</span><span class="o">.</span><span class="n">interactions</span><span class="o">.</span><span class="n">last_event</span><span class="o">.</span><span class="n">person_ids</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Last meeting attendees: </span><span class="si">{</span><span class="n">team_ids</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>


<div class="doc doc-object doc-class">



<a id="affinity.services.persons.PersonService"></a>
    <div class="doc doc-contents first">



        <p>Service for managing persons (contacts).</p>
<p>Uses V2 API for efficient reading with field selection,
V1 API for create/update/delete operations.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>affinity/services/persons.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">PersonService</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Service for managing persons (contacts).</span>

<span class="sd">    Uses V2 API for efficient reading with field selection,</span>
<span class="sd">    V1 API for create/update/delete operations.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">:</span> <span class="n">HTTPClient</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_client</span> <span class="o">=</span> <span class="n">client</span>

    <span class="c1"># =========================================================================</span>
    <span class="c1"># Read Operations (V2 API)</span>
    <span class="c1"># =========================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">PersonId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">field_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">AnyFieldId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">field_types</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">FieldType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">FilterExpression</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cursor</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Person</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a page of persons.</span>

<span class="sd">        Args:</span>
<span class="sd">            ids: Specific person IDs to fetch (batch lookup)</span>
<span class="sd">            field_ids: Specific field IDs to include in response</span>
<span class="sd">            field_types: Field types to include</span>
<span class="sd">            filter: V2 filter expression string, or a FilterExpression built via `affinity.F`</span>
<span class="sd">            limit: Maximum number of results</span>
<span class="sd">            cursor: Cursor to resume pagination (opaque; obtained from prior responses)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Paginated response with persons</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">cursor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">p</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">field_ids</span><span class="p">,</span> <span class="n">field_types</span><span class="p">,</span> <span class="nb">filter</span><span class="p">,</span> <span class="n">limit</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Cannot combine &#39;cursor&#39; with other parameters; cursor encodes all query &quot;</span>
                    <span class="s2">&quot;context. Start a new pagination sequence without a cursor to change &quot;</span>
                    <span class="s2">&quot;parameters.&quot;</span>
                <span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get_url</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="n">ids</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s2">&quot;ids&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span> <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">field_ids</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s2">&quot;fieldIds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">field_id</span><span class="p">)</span> <span class="k">for</span> <span class="n">field_id</span> <span class="ow">in</span> <span class="n">field_ids</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">field_types</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s2">&quot;fieldTypes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">field_type</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">field_type</span> <span class="ow">in</span> <span class="n">field_types</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">filter_text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">filter</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">filter_text</span><span class="p">:</span>
                    <span class="n">params</span><span class="p">[</span><span class="s2">&quot;filter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filter_text</span>
            <span class="k">if</span> <span class="n">limit</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s2">&quot;limit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">limit</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/persons&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Person</span><span class="p">](</span>
            <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">Person</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">[])],</span>
            <span class="n">pagination</span><span class="o">=</span><span class="n">PaginationInfo</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pagination&quot;</span><span class="p">,</span> <span class="p">{})),</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">pages</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">PersonId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">field_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">AnyFieldId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">field_types</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">FieldType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">FilterExpression</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cursor</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Person</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterate person pages (not items), yielding `PaginatedResponse[Person]`.</span>

<span class="sd">        Useful for ETL scripts that need checkpoint/resume via `page.next_cursor`.</span>

<span class="sd">        Args:</span>
<span class="sd">            ids: Specific person IDs to fetch (batch lookup)</span>
<span class="sd">            field_ids: Specific field IDs to include in response</span>
<span class="sd">            field_types: Field types to include</span>
<span class="sd">            filter: V2 filter expression string or FilterExpression</span>
<span class="sd">            limit: Maximum results per page</span>
<span class="sd">            cursor: Cursor to resume pagination</span>

<span class="sd">        Yields:</span>
<span class="sd">            PaginatedResponse[Person] for each page</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">other_params</span> <span class="o">=</span> <span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">field_ids</span><span class="p">,</span> <span class="n">field_types</span><span class="p">,</span> <span class="nb">filter</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cursor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="n">p</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">other_params</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot combine &#39;cursor&#39; with other parameters; cursor encodes all query context. &quot;</span>
                <span class="s2">&quot;Start a new pagination sequence without a cursor to change parameters.&quot;</span>
            <span class="p">)</span>
        <span class="n">requested_cursor</span> <span class="o">=</span> <span class="n">cursor</span>
        <span class="n">page</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">cursor</span><span class="o">=</span><span class="n">cursor</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cursor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">(</span>
                <span class="n">ids</span><span class="o">=</span><span class="n">ids</span><span class="p">,</span> <span class="n">field_ids</span><span class="o">=</span><span class="n">field_ids</span><span class="p">,</span> <span class="n">field_types</span><span class="o">=</span><span class="n">field_types</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">page</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">page</span><span class="o">.</span><span class="n">has_next</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">next_cursor</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">next_cursor</span>
            <span class="k">if</span> <span class="n">next_cursor</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">next_cursor</span> <span class="o">==</span> <span class="n">requested_cursor</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">requested_cursor</span> <span class="o">=</span> <span class="n">next_cursor</span>
            <span class="n">page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">cursor</span><span class="o">=</span><span class="n">next_cursor</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">all</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">PersonId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">field_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">AnyFieldId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">field_types</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">FieldType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">FilterExpression</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Person</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterate through all persons with automatic pagination.</span>

<span class="sd">        Args:</span>
<span class="sd">            ids: Specific person IDs to fetch (batch lookup)</span>
<span class="sd">            field_ids: Specific field IDs to include</span>
<span class="sd">            field_types: Field types to include</span>
<span class="sd">            filter: V2 filter expression</span>

<span class="sd">        Yields:</span>
<span class="sd">            Person objects</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">fetch_page</span><span class="p">(</span><span class="n">next_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Person</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">next_url</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get_url</span><span class="p">(</span><span class="n">next_url</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Person</span><span class="p">](</span>
                    <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">Person</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">[])],</span>
                    <span class="n">pagination</span><span class="o">=</span><span class="n">PaginationInfo</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pagination&quot;</span><span class="p">,</span> <span class="p">{})),</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">(</span>
                <span class="n">ids</span><span class="o">=</span><span class="n">ids</span><span class="p">,</span>
                <span class="n">field_ids</span><span class="o">=</span><span class="n">field_ids</span><span class="p">,</span>
                <span class="n">field_types</span><span class="o">=</span><span class="n">field_types</span><span class="p">,</span>
                <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">PageIterator</span><span class="p">(</span><span class="n">fetch_page</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">iter</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">PersonId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">field_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">AnyFieldId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">field_types</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">FieldType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">FilterExpression</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Person</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Auto-paginate all persons.</span>

<span class="sd">        Alias for `all()` (FR-006 public contract).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">ids</span><span class="o">=</span><span class="n">ids</span><span class="p">,</span> <span class="n">field_ids</span><span class="o">=</span><span class="n">field_ids</span><span class="p">,</span> <span class="n">field_types</span><span class="o">=</span><span class="n">field_types</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">person_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">field_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">AnyFieldId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">field_types</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">FieldType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">include_field_values</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">with_interaction_dates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">with_interaction_persons</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Person</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a single person by ID.</span>

<span class="sd">        Args:</span>
<span class="sd">            person_id: The person ID</span>
<span class="sd">            field_ids: Specific field IDs to include in response</span>
<span class="sd">            field_types: Field types to include (e.g., [&quot;enriched&quot;, &quot;global&quot;])</span>
<span class="sd">            include_field_values: If True, fetch embedded field values. This saves</span>
<span class="sd">                one API call when you need both person info and field values.</span>
<span class="sd">                Cannot be combined with field_ids/field_types.</span>
<span class="sd">            retries: Number of retries on 404 NotFoundError. Default is 0 (fail fast).</span>
<span class="sd">                Set to 2-3 if calling immediately after create() to handle eventual</span>
<span class="sd">                consistency lag.</span>
<span class="sd">            with_interaction_dates: Include interaction date summaries (last/next</span>
<span class="sd">                meeting dates, email dates).</span>
<span class="sd">            with_interaction_persons: Include person IDs for each interaction.</span>
<span class="sd">                Only applies when with_interaction_dates=True.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Person object with requested field data.</span>
<span class="sd">            When include_field_values=True, the Person will have a `field_values`</span>
<span class="sd">            attribute containing the list of FieldValue objects.</span>
<span class="sd">            When with_interaction_dates=True, the Person will have interaction_dates</span>
<span class="sd">            and interactions populated.</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotFoundError: If person does not exist after all retries.</span>
<span class="sd">            ValueError: If include_field_values is combined with field_ids/field_types.</span>

<span class="sd">        Note:</span>
<span class="sd">            When combining with_interaction_dates with field_ids/field_types,</span>
<span class="sd">            two API calls are made internally and the results are merged.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_with_retry</span><span class="p">(</span>
            <span class="n">person_id</span><span class="p">,</span>
            <span class="n">field_ids</span><span class="o">=</span><span class="n">field_ids</span><span class="p">,</span>
            <span class="n">field_types</span><span class="o">=</span><span class="n">field_types</span><span class="p">,</span>
            <span class="n">include_field_values</span><span class="o">=</span><span class="n">include_field_values</span><span class="p">,</span>
            <span class="n">retries</span><span class="o">=</span><span class="n">retries</span><span class="p">,</span>
            <span class="n">with_interaction_dates</span><span class="o">=</span><span class="n">with_interaction_dates</span><span class="p">,</span>
            <span class="n">with_interaction_persons</span><span class="o">=</span><span class="n">with_interaction_persons</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_with_retry</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">person_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">field_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">AnyFieldId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">field_types</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">FieldType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">include_field_values</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">with_interaction_dates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">with_interaction_persons</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Person</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Internal: get with retry logic.&quot;&quot;&quot;</span>
        <span class="n">last_error</span><span class="p">:</span> <span class="n">NotFoundError</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">attempts</span> <span class="o">=</span> <span class="n">retries</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># retries=0 means 1 attempt</span>

        <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">attempts</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_impl</span><span class="p">(</span>
                    <span class="n">person_id</span><span class="p">,</span>
                    <span class="n">field_ids</span><span class="o">=</span><span class="n">field_ids</span><span class="p">,</span>
                    <span class="n">field_types</span><span class="o">=</span><span class="n">field_types</span><span class="p">,</span>
                    <span class="n">include_field_values</span><span class="o">=</span><span class="n">include_field_values</span><span class="p">,</span>
                    <span class="n">with_interaction_dates</span><span class="o">=</span><span class="n">with_interaction_dates</span><span class="p">,</span>
                    <span class="n">with_interaction_persons</span><span class="o">=</span><span class="n">with_interaction_persons</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="n">NotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">last_error</span> <span class="o">=</span> <span class="n">e</span>
                <span class="k">if</span> <span class="n">attempt</span> <span class="o">&lt;</span> <span class="n">attempts</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Don&#39;t sleep after last attempt</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">attempt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>  <span class="c1"># 0.5s, 1s, 1.5s backoff</span>

        <span class="c1"># V1 fallback: If V2 returned 404, try V1 API (handles V1V2 sync delays)</span>
        <span class="c1"># Skip if already using V1 path (include_field_values or with_interaction_dates)</span>
        <span class="k">if</span> <span class="n">last_error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">include_field_values</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">with_interaction_dates</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">v1_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/persons/</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">normalized</span> <span class="o">=</span> <span class="n">_normalize_v1_person_response</span><span class="p">(</span><span class="n">v1_data</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">Person</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">normalized</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">NotFoundError</span><span class="p">:</span>
                <span class="k">pass</span>  <span class="c1"># V1 also failed, raise original V2 error</span>

        <span class="k">raise</span> <span class="n">last_error</span>  <span class="c1"># type: ignore[misc]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_impl</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">person_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">field_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">AnyFieldId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">field_types</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">FieldType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">include_field_values</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">with_interaction_dates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">with_interaction_persons</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Person</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Internal: actual get implementation.&quot;&quot;&quot;</span>
        <span class="n">has_field_filters</span> <span class="o">=</span> <span class="n">field_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">field_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

        <span class="c1"># include_field_values returns embedded field values, which is incompatible</span>
        <span class="c1"># with field_ids/field_types filtering (different data structures)</span>
        <span class="k">if</span> <span class="n">include_field_values</span> <span class="ow">and</span> <span class="n">has_field_filters</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot combine &#39;include_field_values&#39; with &#39;field_ids&#39; or &#39;field_types&#39;. &quot;</span>
                <span class="s2">&quot;Use include_field_values alone for embedded field values, or use &quot;</span>
                <span class="s2">&quot;field_ids/field_types alone for filtered fields.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Path 1: include_field_values (V1 API, may include interaction dates)</span>
        <span class="k">if</span> <span class="n">include_field_values</span><span class="p">:</span>
            <span class="n">v1_params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="n">with_interaction_dates</span><span class="p">:</span>
                <span class="n">v1_params</span><span class="p">[</span><span class="s2">&quot;with_interaction_dates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">with_interaction_persons</span><span class="p">:</span>
                <span class="n">v1_params</span><span class="p">[</span><span class="s2">&quot;with_interaction_persons&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;/persons/</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">params</span><span class="o">=</span><span class="n">v1_params</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">field_values_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;field_values&quot;</span><span class="p">,</span> <span class="p">[])</span>
            <span class="c1"># V1 embedded field_values don&#39;t include entityId; add it before validation</span>
            <span class="n">field_values</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">FieldValue</span><span class="o">.</span><span class="n">model_validate</span><span class="p">({</span><span class="o">**</span><span class="n">fv</span><span class="p">,</span> <span class="s2">&quot;entityId&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">person_id</span><span class="p">)})</span>
                <span class="k">for</span> <span class="n">fv</span> <span class="ow">in</span> <span class="n">field_values_data</span>
            <span class="p">]</span>
            <span class="n">normalized</span> <span class="o">=</span> <span class="n">_normalize_v1_person_response</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">person</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">normalized</span><span class="p">)</span>
            <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="s2">&quot;field_values&quot;</span><span class="p">,</span> <span class="n">field_values</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">person</span>

        <span class="c1"># Path 2: with_interaction_dates (may need merge if field filters present)</span>
        <span class="k">if</span> <span class="n">with_interaction_dates</span><span class="p">:</span>
            <span class="n">v1_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;with_interaction_dates&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">with_interaction_persons</span><span class="p">:</span>
                <span class="n">v1_params</span><span class="p">[</span><span class="s2">&quot;with_interaction_persons&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="n">interaction_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;/persons/</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">params</span><span class="o">=</span><span class="n">v1_params</span><span class="p">,</span>
                <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># If field filtering is also requested, fetch filtered fields and merge</span>
            <span class="k">if</span> <span class="n">has_field_filters</span><span class="p">:</span>
                <span class="n">v2_params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">if</span> <span class="n">field_ids</span><span class="p">:</span>
                    <span class="n">v2_params</span><span class="p">[</span><span class="s2">&quot;fieldIds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">fid</span><span class="p">)</span> <span class="k">for</span> <span class="n">fid</span> <span class="ow">in</span> <span class="n">field_ids</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">field_types</span><span class="p">:</span>
                    <span class="n">v2_params</span><span class="p">[</span><span class="s2">&quot;fieldTypes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ft</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">ft</span> <span class="ow">in</span> <span class="n">field_types</span><span class="p">]</span>

                <span class="n">filtered_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;/persons/</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">params</span><span class="o">=</span><span class="n">v2_params</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="c1"># Merge: filtered fields + interaction data</span>
                <span class="n">filtered_data</span><span class="p">[</span><span class="s2">&quot;interaction_dates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interaction_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;interaction_dates&quot;</span><span class="p">)</span>
                <span class="n">filtered_data</span><span class="p">[</span><span class="s2">&quot;interactions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interaction_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;interactions&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">Person</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">filtered_data</span><span class="p">)</span>

            <span class="c1"># No field filtering, normalize and return V1 data</span>
            <span class="n">normalized</span> <span class="o">=</span> <span class="n">_normalize_v1_person_response</span><span class="p">(</span><span class="n">interaction_data</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Person</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">normalized</span><span class="p">)</span>

        <span class="c1"># Path 3: Standard path (supports field filtering)</span>
        <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">field_ids</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;fieldIds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">field_id</span><span class="p">)</span> <span class="k">for</span> <span class="n">field_id</span> <span class="ow">in</span> <span class="n">field_ids</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">field_types</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;fieldTypes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">field_type</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">field_type</span> <span class="ow">in</span> <span class="n">field_types</span><span class="p">]</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;/persons/</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="n">params</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">Person</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_list_entries</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">person_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">ListEntry</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all list entries for a person across all lists.&quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/persons/</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">/list-entries&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">ListEntry</span><span class="p">](</span>
            <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">ListEntry</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">[])],</span>
            <span class="n">pagination</span><span class="o">=</span><span class="n">PaginationInfo</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pagination&quot;</span><span class="p">,</span> <span class="p">{})),</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_lists</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">person_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">ListSummary</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all lists that contain this person.&quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/persons/</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">/lists&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">ListSummary</span><span class="p">](</span>
            <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">ListSummary</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">[])],</span>
            <span class="n">pagination</span><span class="o">=</span><span class="n">PaginationInfo</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pagination&quot;</span><span class="p">,</span> <span class="p">{})),</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_fields</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">field_types</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">FieldType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">FieldMetadata</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get metadata about person fields.</span>

<span class="sd">        Cached for performance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">field_types</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;fieldTypes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">field_type</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">field_type</span> <span class="ow">in</span> <span class="n">field_types</span><span class="p">]</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;/persons/fields&quot;</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="n">params</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">cache_key</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;person_fields:</span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">field_types</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">[])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">cache_ttl</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">FieldMetadata</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">[])]</span>

    <span class="c1"># =========================================================================</span>
    <span class="c1"># Associations (V1 API)</span>
    <span class="c1"># =========================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_associated_company_ids</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">person_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">CompanyId</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get associated company IDs for a person.</span>

<span class="sd">        V1-only: V2 does not expose person -&gt; company associations directly.</span>
<span class="sd">        Uses GET `/persons/{id}` (V1) and returns `organization_ids`.</span>

<span class="sd">        Args:</span>
<span class="sd">            person_id: The person ID</span>
<span class="sd">            max_results: Maximum number of company IDs to return</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of CompanyId values associated with this person</span>

<span class="sd">        Note:</span>
<span class="sd">            The Person model already has `company_ids` populated from V1&#39;s</span>
<span class="sd">            `organizationIds` field. This method provides API parity with</span>
<span class="sd">            `CompanyService.get_associated_person_ids()`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/persons/</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Defensive: handle potential {&quot;person&quot;: {...}} wrapper</span>
        <span class="c1"># (consistent with CompanyService.get_associated_person_ids pattern)</span>
        <span class="n">person</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;person&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">person</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">data</span>
        <span class="n">org_ids</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">org_ids</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organization_ids&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organizationIds&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">org_ids</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">CompanyId</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">cid</span><span class="p">))</span> <span class="k">for</span> <span class="n">cid</span> <span class="ow">in</span> <span class="n">org_ids</span> <span class="k">if</span> <span class="n">cid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">max_results</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_results</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ids</span><span class="p">[:</span><span class="n">max_results</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">ids</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_associated_company_ids_batch</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">person_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">PersonId</span><span class="p">],</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">on_error</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;raise&quot;</span><span class="p">,</span> <span class="s2">&quot;skip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;raise&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">PersonId</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">CompanyId</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get company associations for multiple persons.</span>

<span class="sd">        Makes one V1 API call per person.</span>

<span class="sd">        Args:</span>
<span class="sd">            person_ids: Sequence of person IDs to fetch</span>
<span class="sd">            on_error: How to handle errors - &quot;raise&quot; (default) or &quot;skip&quot; failed IDs</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict mapping person_id -&gt; list of company_ids</span>

<span class="sd">        Raises:</span>
<span class="sd">            AffinityError: If on_error=&quot;raise&quot; and any fetch fails.</span>

<span class="sd">        Example:</span>
<span class="sd">            associations = client.persons.get_associated_company_ids_batch(person_ids)</span>
<span class="sd">            all_company_ids = set()</span>
<span class="sd">            for company_ids in associations.values():</span>
<span class="sd">                all_company_ids.update(company_ids)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">PersonId</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">CompanyId</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">person_id</span> <span class="ow">in</span> <span class="n">person_ids</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_associated_company_ids</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">AffinityError</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s2">&quot;raise&quot;</span><span class="p">:</span>
                    <span class="k">raise</span>
                <span class="c1"># skip: continue without this person</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s2">&quot;raise&quot;</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">AffinityError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Failed to get associations for person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
                <span class="c1"># skip: continue without this person</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_associated_opportunity_ids</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">person_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get associated opportunity IDs for a person.</span>

<span class="sd">        V1-only: V2 does not expose person -&gt; opportunity associations directly.</span>
<span class="sd">        Uses GET `/persons/{id}` (V1) and returns `opportunity_ids`.</span>

<span class="sd">        Args:</span>
<span class="sd">            person_id: The person ID</span>
<span class="sd">            max_results: Maximum number of opportunity IDs to return</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of OpportunityId values associated with this person</span>

<span class="sd">        Note:</span>
<span class="sd">            The Person model already has `opportunity_ids` populated from V1&#39;s</span>
<span class="sd">            `opportunityIds` field. This method provides API parity with</span>
<span class="sd">            `OpportunityService.get_associated_person_ids()`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/persons/</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Defensive: handle potential {&quot;person&quot;: {...}} wrapper</span>
        <span class="n">person</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;person&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">person</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">data</span>
        <span class="n">opp_ids</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">opp_ids</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;opportunity_ids&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;opportunityIds&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">opp_ids</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">OpportunityId</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">oid</span><span class="p">))</span> <span class="k">for</span> <span class="n">oid</span> <span class="ow">in</span> <span class="n">opp_ids</span> <span class="k">if</span> <span class="n">oid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">max_results</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_results</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ids</span><span class="p">[:</span><span class="n">max_results</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">ids</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_associated_opportunity_ids_batch</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">person_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">PersonId</span><span class="p">],</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">on_error</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;raise&quot;</span><span class="p">,</span> <span class="s2">&quot;skip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;raise&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">PersonId</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get opportunity associations for multiple persons.</span>

<span class="sd">        Makes one V1 API call per person.</span>

<span class="sd">        Args:</span>
<span class="sd">            person_ids: Sequence of person IDs to fetch</span>
<span class="sd">            on_error: How to handle errors - &quot;raise&quot; (default) or &quot;skip&quot; failed IDs</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict mapping person_id -&gt; list of opportunity_ids</span>

<span class="sd">        Raises:</span>
<span class="sd">            AffinityError: If on_error=&quot;raise&quot; and any fetch fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">PersonId</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">person_id</span> <span class="ow">in</span> <span class="n">person_ids</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_associated_opportunity_ids</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">AffinityError</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s2">&quot;raise&quot;</span><span class="p">:</span>
                    <span class="k">raise</span>
                <span class="c1"># skip: continue without this person</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s2">&quot;raise&quot;</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">AffinityError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Failed to get associations for person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
                <span class="c1"># skip: continue without this person</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="c1"># =========================================================================</span>
    <span class="c1"># Search (V1 API)</span>
    <span class="c1"># =========================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">search</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">term</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">with_interaction_dates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">with_interaction_persons</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">with_opportunities</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">page_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">page_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Person</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Search for persons by name or email.</span>

<span class="sd">        Uses V1 API for search functionality.</span>

<span class="sd">        Args:</span>
<span class="sd">            term: Search term (name or email)</span>
<span class="sd">            with_interaction_dates: Include interaction date data</span>
<span class="sd">            with_interaction_persons: Include persons for interactions</span>
<span class="sd">            with_opportunities: Include associated opportunity IDs</span>
<span class="sd">            page_size: Results per page (max 500)</span>
<span class="sd">            page_token: Pagination token</span>

<span class="sd">        Returns:</span>
<span class="sd">            PaginatedResponse[Person] with matching persons and pagination info</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;term&quot;</span><span class="p">:</span> <span class="n">term</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">with_interaction_dates</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;with_interaction_dates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">with_interaction_persons</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;with_interaction_persons&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">with_opportunities</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;with_opportunities&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">page_size</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;page_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">page_size</span>
        <span class="k">if</span> <span class="n">page_token</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;page_token&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">page_token</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/persons&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">Person</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;persons&quot;</span><span class="p">,</span> <span class="p">[])]</span>
        <span class="k">return</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Person</span><span class="p">](</span>
            <span class="n">data</span><span class="o">=</span><span class="n">items</span><span class="p">,</span>
            <span class="n">next_page_token</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;next_page_token&quot;</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">search_pages</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">term</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">with_interaction_dates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">with_interaction_persons</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">with_opportunities</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">page_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">page_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Person</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterate V1 person-search result pages.</span>

<span class="sd">        Useful for scripts that need checkpoint/resume via `next_page_token`.</span>

<span class="sd">        Args:</span>
<span class="sd">            term: Search term (name or email)</span>
<span class="sd">            with_interaction_dates: Include interaction date data</span>
<span class="sd">            with_interaction_persons: Include persons for interactions</span>
<span class="sd">            with_opportunities: Include associated opportunity IDs</span>
<span class="sd">            page_size: Results per page (max 500)</span>
<span class="sd">            page_token: Resume from this pagination token</span>

<span class="sd">        Yields:</span>
<span class="sd">            PaginatedResponse[Person] for each page</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">requested_token</span> <span class="o">=</span> <span class="n">page_token</span>
        <span class="n">page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
            <span class="n">term</span><span class="p">,</span>
            <span class="n">with_interaction_dates</span><span class="o">=</span><span class="n">with_interaction_dates</span><span class="p">,</span>
            <span class="n">with_interaction_persons</span><span class="o">=</span><span class="n">with_interaction_persons</span><span class="p">,</span>
            <span class="n">with_opportunities</span><span class="o">=</span><span class="n">with_opportunities</span><span class="p">,</span>
            <span class="n">page_size</span><span class="o">=</span><span class="n">page_size</span><span class="p">,</span>
            <span class="n">page_token</span><span class="o">=</span><span class="n">page_token</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">page</span>
            <span class="n">next_token</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">next_page_token</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">next_token</span> <span class="ow">or</span> <span class="n">next_token</span> <span class="o">==</span> <span class="n">requested_token</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">requested_token</span> <span class="o">=</span> <span class="n">next_token</span>
            <span class="n">page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
                <span class="n">term</span><span class="p">,</span>
                <span class="n">with_interaction_dates</span><span class="o">=</span><span class="n">with_interaction_dates</span><span class="p">,</span>
                <span class="n">with_interaction_persons</span><span class="o">=</span><span class="n">with_interaction_persons</span><span class="p">,</span>
                <span class="n">with_opportunities</span><span class="o">=</span><span class="n">with_opportunities</span><span class="p">,</span>
                <span class="n">page_size</span><span class="o">=</span><span class="n">page_size</span><span class="p">,</span>
                <span class="n">page_token</span><span class="o">=</span><span class="n">next_token</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">search_all</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">term</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">with_interaction_dates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">with_interaction_persons</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">with_opportunities</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">page_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">page_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Person</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterate all V1 person-search results with automatic pagination.</span>

<span class="sd">        Args:</span>
<span class="sd">            term: Search term (name or email)</span>
<span class="sd">            with_interaction_dates: Include interaction date data</span>
<span class="sd">            with_interaction_persons: Include persons for interactions</span>
<span class="sd">            with_opportunities: Include associated opportunity IDs</span>
<span class="sd">            page_size: Results per page (max 500)</span>
<span class="sd">            page_token: Resume from this pagination token</span>

<span class="sd">        Yields:</span>
<span class="sd">            Person objects matching the search term</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_pages</span><span class="p">(</span>
            <span class="n">term</span><span class="p">,</span>
            <span class="n">with_interaction_dates</span><span class="o">=</span><span class="n">with_interaction_dates</span><span class="p">,</span>
            <span class="n">with_interaction_persons</span><span class="o">=</span><span class="n">with_interaction_persons</span><span class="p">,</span>
            <span class="n">with_opportunities</span><span class="o">=</span><span class="n">with_opportunities</span><span class="p">,</span>
            <span class="n">page_size</span><span class="o">=</span><span class="n">page_size</span><span class="p">,</span>
            <span class="n">page_token</span><span class="o">=</span><span class="n">page_token</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="k">yield from</span> <span class="n">page</span><span class="o">.</span><span class="n">data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">resolve</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">email</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Person</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find a single person by email or name.</span>

<span class="sd">        This is a convenience helper that searches and returns the first exact match,</span>
<span class="sd">        or None if not found. Uses V1 search internally.</span>

<span class="sd">        Args:</span>
<span class="sd">            email: Email address to search for</span>
<span class="sd">            name: Person name to search for (first + last)</span>

<span class="sd">        Returns:</span>
<span class="sd">            The matching Person, or None if not found</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If neither email nor name is provided</span>

<span class="sd">        Note:</span>
<span class="sd">            This auto-paginates V1 search results until a match is found.</span>
<span class="sd">            If multiple matches are found, returns the first one. For full</span>
<span class="sd">            disambiguation, use resolve_all() or search() directly.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">email</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must provide either email or name&quot;</span><span class="p">)</span>

        <span class="n">term</span> <span class="o">=</span> <span class="n">email</span> <span class="ow">or</span> <span class="n">name</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_pages</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">page_size</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">page</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_person_matches</span><span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">person</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">resolve_all</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">email</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">Person</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find all persons matching an email or name.</span>

<span class="sd">        Notes:</span>
<span class="sd">        - This auto-paginates V1 search results to collect exact matches.</span>
<span class="sd">        - Unlike resolve(), this returns every match in server-provided order.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">email</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must provide either email or name&quot;</span><span class="p">)</span>

        <span class="n">term</span> <span class="o">=</span> <span class="n">email</span> <span class="ow">or</span> <span class="n">name</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
        <span class="n">matches</span><span class="p">:</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">Person</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_pages</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">page_size</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">page</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_person_matches</span><span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">):</span>
                    <span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">person</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">matches</span>

    <span class="c1"># =========================================================================</span>
    <span class="c1"># Write Operations (V1 API)</span>
    <span class="c1"># =========================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">PersonCreate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Person</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new person.</span>

<span class="sd">        Note:</span>
<span class="sd">            Creates use V1 API, while reads use V2 API. Due to eventual consistency</span>
<span class="sd">            between V1 and V2, a `get()` call immediately after `create()` may return</span>
<span class="sd">            404 NotFoundError. If you need to read immediately after creation, either:</span>
<span class="sd">            - Use the Person object returned by this method (it contains the created data)</span>
<span class="sd">            - Add a short delay (100-500ms) before calling get()</span>
<span class="sd">            - Implement retry logic in your application</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValidationError: If email conflicts with existing person</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">by_alias</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="o">.</span><span class="n">company_ids</span><span class="p">:</span>
            <span class="n">payload</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;organization_ids&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/persons&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">cache</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">invalidate_prefix</span><span class="p">(</span><span class="s2">&quot;person&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Person</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">person_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">PersonUpdate</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Person</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update an existing person.</span>

<span class="sd">        Note: To add emails/organizations, include existing values plus new ones.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span>
            <span class="n">by_alias</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">,</span>
            <span class="n">exclude_unset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">put</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;/persons/</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
            <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">cache</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">invalidate_prefix</span><span class="p">(</span><span class="s2">&quot;person&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Person</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete a person (also deletes associated field values).&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/persons/</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">cache</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">invalidate_prefix</span><span class="p">(</span><span class="s2">&quot;person&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;success&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>

    <span class="c1"># =========================================================================</span>
    <span class="c1"># Merge Operations (V2 BETA)</span>
    <span class="c1"># =========================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">merge</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">primary_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">,</span>
        <span class="n">duplicate_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Merge a duplicate person into a primary person.</span>

<span class="sd">        Returns a task URL to check merge status.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">enable_beta_endpoints</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">BetaEndpointDisabledError</span><span class="p">(</span>
                <span class="s2">&quot;Person merge is a beta endpoint; set enable_beta_endpoints=True to use it.&quot;</span>
            <span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s2">&quot;/person-merges&quot;</span><span class="p">,</span>
            <span class="n">json</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;primaryPersonId&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">primary_id</span><span class="p">),</span>
                <span class="s2">&quot;duplicatePersonId&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">duplicate_id</span><span class="p">),</span>
            <span class="p">},</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;taskUrl&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_merge_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MergeTask</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check the status of a merge operation.&quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/tasks/person-merges/</span><span class="si">{</span><span class="n">task_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">MergeTask</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="affinity.services.persons.PersonService.all" class="doc doc-heading">
            <code class="highlight language-python"><span class="nb">all</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">PersonId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">field_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">AnyFieldId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">field_types</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">FieldType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">FilterExpression</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Person</span><span class="p">]</span></code>

<a href="#affinity.services.persons.PersonService.all" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Iterate through all persons with automatic pagination.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ids</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="affinity.models.types.PersonId">PersonId</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Specific person IDs to fetch (batch lookup)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>field_ids</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="affinity.models.types.AnyFieldId">AnyFieldId</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Specific field IDs to include</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>field_types</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<a class="autorefs autorefs-internal" title="FieldType (affinity.models.types.FieldType)" href="../../types/#affinity.types.FieldType">FieldType</a>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Field types to include</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filter</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <a class="autorefs autorefs-internal" title="FilterExpression (affinity.filters.FilterExpression)" href="../../filters/#affinity.filters.FilterExpression">FilterExpression</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>V2 filter expression</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Yields:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="Person (affinity.models.entities.Person)" href="../../models/#affinity.models.Person">Person</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Person objects</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/persons.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">all</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">PersonId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">field_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">AnyFieldId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">field_types</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">FieldType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">FilterExpression</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Person</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Iterate through all persons with automatic pagination.</span>

<span class="sd">    Args:</span>
<span class="sd">        ids: Specific person IDs to fetch (batch lookup)</span>
<span class="sd">        field_ids: Specific field IDs to include</span>
<span class="sd">        field_types: Field types to include</span>
<span class="sd">        filter: V2 filter expression</span>

<span class="sd">    Yields:</span>
<span class="sd">        Person objects</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fetch_page</span><span class="p">(</span><span class="n">next_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Person</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">next_url</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get_url</span><span class="p">(</span><span class="n">next_url</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Person</span><span class="p">](</span>
                <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">Person</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">[])],</span>
                <span class="n">pagination</span><span class="o">=</span><span class="n">PaginationInfo</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pagination&quot;</span><span class="p">,</span> <span class="p">{})),</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">(</span>
            <span class="n">ids</span><span class="o">=</span><span class="n">ids</span><span class="p">,</span>
            <span class="n">field_ids</span><span class="o">=</span><span class="n">field_ids</span><span class="p">,</span>
            <span class="n">field_types</span><span class="o">=</span><span class="n">field_types</span><span class="p">,</span>
            <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">PageIterator</span><span class="p">(</span><span class="n">fetch_page</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.persons.PersonService.create" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">PersonCreate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Person</span></code>

<a href="#affinity.services.persons.PersonService.create" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Create a new person.</p>


<details class="note" open>
  <summary>Note</summary>
  <p>Creates use V1 API, while reads use V2 API. Due to eventual consistency
between V1 and V2, a <code>get()</code> call immediately after <code>create()</code> may return
404 NotFoundError. If you need to read immediately after creation, either:
- Use the Person object returned by this method (it contains the created data)
- Add a short delay (100-500ms) before calling get()
- Implement retry logic in your application</p>
</details>

<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="ValidationError (affinity.exceptions.ValidationError)" href="../../exceptions/#affinity.exceptions.ValidationError">ValidationError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If email conflicts with existing person</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/persons.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">PersonCreate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Person</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a new person.</span>

<span class="sd">    Note:</span>
<span class="sd">        Creates use V1 API, while reads use V2 API. Due to eventual consistency</span>
<span class="sd">        between V1 and V2, a `get()` call immediately after `create()` may return</span>
<span class="sd">        404 NotFoundError. If you need to read immediately after creation, either:</span>
<span class="sd">        - Use the Person object returned by this method (it contains the created data)</span>
<span class="sd">        - Add a short delay (100-500ms) before calling get()</span>
<span class="sd">        - Implement retry logic in your application</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValidationError: If email conflicts with existing person</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">by_alias</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="o">.</span><span class="n">company_ids</span><span class="p">:</span>
        <span class="n">payload</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;organization_ids&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/persons&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">cache</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">invalidate_prefix</span><span class="p">(</span><span class="s2">&quot;person&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">Person</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.persons.PersonService.delete" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete</span><span class="p">(</span><span class="n">person_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span></code>

<a href="#affinity.services.persons.PersonService.delete" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Delete a person (also deletes associated field values).</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/persons.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Delete a person (also deletes associated field values).&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/persons/</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">cache</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">invalidate_prefix</span><span class="p">(</span><span class="s2">&quot;person&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;success&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.persons.PersonService.get" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get</span><span class="p">(</span><span class="n">person_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">field_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">AnyFieldId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">field_types</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">FieldType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">include_field_values</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">with_interaction_dates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">with_interaction_persons</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Person</span></code>

<a href="#affinity.services.persons.PersonService.get" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Get a single person by ID.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>person_id</code>
            </td>
            <td>
                  <code><span title="affinity.models.types.PersonId">PersonId</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The person ID</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>field_ids</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="affinity.models.types.AnyFieldId">AnyFieldId</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Specific field IDs to include in response</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>field_types</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<a class="autorefs autorefs-internal" title="FieldType (affinity.models.types.FieldType)" href="../../types/#affinity.types.FieldType">FieldType</a>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Field types to include (e.g., ["enriched", "global"])</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>include_field_values</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, fetch embedded field values. This saves
one API call when you need both person info and field values.
Cannot be combined with field_ids/field_types.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>retries</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of retries on 404 NotFoundError. Default is 0 (fail fast).
Set to 2-3 if calling immediately after create() to handle eventual
consistency lag.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>with_interaction_dates</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Include interaction date summaries (last/next
meeting dates, email dates).</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>with_interaction_persons</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Include person IDs for each interaction.
Only applies when with_interaction_dates=True.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="Person (affinity.models.entities.Person)" href="../../models/#affinity.models.Person">Person</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Person object with requested field data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="Person (affinity.models.entities.Person)" href="../../models/#affinity.models.Person">Person</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When include_field_values=True, the Person will have a <code>field_values</code></p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="Person (affinity.models.entities.Person)" href="../../models/#affinity.models.Person">Person</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>attribute containing the list of FieldValue objects.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="Person (affinity.models.entities.Person)" href="../../models/#affinity.models.Person">Person</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When with_interaction_dates=True, the Person will have interaction_dates</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="Person (affinity.models.entities.Person)" href="../../models/#affinity.models.Person">Person</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>and interactions populated.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="NotFoundError (affinity.exceptions.NotFoundError)" href="../../exceptions/#affinity.exceptions.NotFoundError">NotFoundError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If person does not exist after all retries.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If include_field_values is combined with field_ids/field_types.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>When combining with_interaction_dates with field_ids/field_types,
two API calls are made internally and the results are merged.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/persons.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">person_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">field_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">AnyFieldId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">field_types</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">FieldType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">include_field_values</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">with_interaction_dates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">with_interaction_persons</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Person</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a single person by ID.</span>

<span class="sd">    Args:</span>
<span class="sd">        person_id: The person ID</span>
<span class="sd">        field_ids: Specific field IDs to include in response</span>
<span class="sd">        field_types: Field types to include (e.g., [&quot;enriched&quot;, &quot;global&quot;])</span>
<span class="sd">        include_field_values: If True, fetch embedded field values. This saves</span>
<span class="sd">            one API call when you need both person info and field values.</span>
<span class="sd">            Cannot be combined with field_ids/field_types.</span>
<span class="sd">        retries: Number of retries on 404 NotFoundError. Default is 0 (fail fast).</span>
<span class="sd">            Set to 2-3 if calling immediately after create() to handle eventual</span>
<span class="sd">            consistency lag.</span>
<span class="sd">        with_interaction_dates: Include interaction date summaries (last/next</span>
<span class="sd">            meeting dates, email dates).</span>
<span class="sd">        with_interaction_persons: Include person IDs for each interaction.</span>
<span class="sd">            Only applies when with_interaction_dates=True.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Person object with requested field data.</span>
<span class="sd">        When include_field_values=True, the Person will have a `field_values`</span>
<span class="sd">        attribute containing the list of FieldValue objects.</span>
<span class="sd">        When with_interaction_dates=True, the Person will have interaction_dates</span>
<span class="sd">        and interactions populated.</span>

<span class="sd">    Raises:</span>
<span class="sd">        NotFoundError: If person does not exist after all retries.</span>
<span class="sd">        ValueError: If include_field_values is combined with field_ids/field_types.</span>

<span class="sd">    Note:</span>
<span class="sd">        When combining with_interaction_dates with field_ids/field_types,</span>
<span class="sd">        two API calls are made internally and the results are merged.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_with_retry</span><span class="p">(</span>
        <span class="n">person_id</span><span class="p">,</span>
        <span class="n">field_ids</span><span class="o">=</span><span class="n">field_ids</span><span class="p">,</span>
        <span class="n">field_types</span><span class="o">=</span><span class="n">field_types</span><span class="p">,</span>
        <span class="n">include_field_values</span><span class="o">=</span><span class="n">include_field_values</span><span class="p">,</span>
        <span class="n">retries</span><span class="o">=</span><span class="n">retries</span><span class="p">,</span>
        <span class="n">with_interaction_dates</span><span class="o">=</span><span class="n">with_interaction_dates</span><span class="p">,</span>
        <span class="n">with_interaction_persons</span><span class="o">=</span><span class="n">with_interaction_persons</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.persons.PersonService.get_associated_company_ids" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_associated_company_ids</span><span class="p">(</span><span class="n">person_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">CompanyId</span><span class="p">]</span></code>

<a href="#affinity.services.persons.PersonService.get_associated_company_ids" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Get associated company IDs for a person.</p>
<p>V1-only: V2 does not expose person -&gt; company associations directly.
Uses GET <code>/persons/{id}</code> (V1) and returns <code>organization_ids</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>person_id</code>
            </td>
            <td>
                  <code><span title="affinity.models.types.PersonId">PersonId</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The person ID</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_results</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of company IDs to return</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="builtins.list">list</span>[<a class="autorefs autorefs-internal" title="CompanyId (affinity.models.types.CompanyId)" href="../../types/#affinity.types.CompanyId">CompanyId</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of CompanyId values associated with this person</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>The Person model already has <code>company_ids</code> populated from V1's
<code>organizationIds</code> field. This method provides API parity with
<code>CompanyService.get_associated_person_ids()</code>.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/persons.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_associated_company_ids</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">person_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">CompanyId</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get associated company IDs for a person.</span>

<span class="sd">    V1-only: V2 does not expose person -&gt; company associations directly.</span>
<span class="sd">    Uses GET `/persons/{id}` (V1) and returns `organization_ids`.</span>

<span class="sd">    Args:</span>
<span class="sd">        person_id: The person ID</span>
<span class="sd">        max_results: Maximum number of company IDs to return</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of CompanyId values associated with this person</span>

<span class="sd">    Note:</span>
<span class="sd">        The Person model already has `company_ids` populated from V1&#39;s</span>
<span class="sd">        `organizationIds` field. This method provides API parity with</span>
<span class="sd">        `CompanyService.get_associated_person_ids()`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/persons/</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Defensive: handle potential {&quot;person&quot;: {...}} wrapper</span>
    <span class="c1"># (consistent with CompanyService.get_associated_person_ids pattern)</span>
    <span class="n">person</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;person&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">person</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">data</span>
    <span class="n">org_ids</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">org_ids</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organization_ids&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organizationIds&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">org_ids</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">CompanyId</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">cid</span><span class="p">))</span> <span class="k">for</span> <span class="n">cid</span> <span class="ow">in</span> <span class="n">org_ids</span> <span class="k">if</span> <span class="n">cid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">max_results</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_results</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ids</span><span class="p">[:</span><span class="n">max_results</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ids</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.persons.PersonService.get_associated_company_ids_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_associated_company_ids_batch</span><span class="p">(</span><span class="n">person_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">PersonId</span><span class="p">],</span> <span class="o">*</span><span class="p">,</span> <span class="n">on_error</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;raise&#39;</span><span class="p">,</span> <span class="s1">&#39;skip&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;raise&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">PersonId</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">CompanyId</span><span class="p">]]</span></code>

<a href="#affinity.services.persons.PersonService.get_associated_company_ids_batch" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Get company associations for multiple persons.</p>
<p>Makes one V1 API call per person.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>person_ids</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="affinity.models.types.PersonId">PersonId</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sequence of person IDs to fetch</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>on_error</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;raise&#39;, &#39;skip&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How to handle errors - "raise" (default) or "skip" failed IDs</p>
              </div>
            </td>
            <td>
                  <code>&#39;raise&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="affinity.models.types.PersonId">PersonId</span>, <span title="builtins.list">list</span>[<a class="autorefs autorefs-internal" title="CompanyId (affinity.models.types.CompanyId)" href="../../types/#affinity.types.CompanyId">CompanyId</a>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict mapping person_id -&gt; list of company_ids</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="AffinityError (affinity.exceptions.AffinityError)" href="../../exceptions/#affinity.exceptions.AffinityError">AffinityError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If on_error="raise" and any fetch fails.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <p>associations = client.persons.get_associated_company_ids_batch(person_ids)
all_company_ids = set()
for company_ids in associations.values():
    all_company_ids.update(company_ids)</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/persons.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_associated_company_ids_batch</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">person_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">PersonId</span><span class="p">],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">on_error</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;raise&quot;</span><span class="p">,</span> <span class="s2">&quot;skip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;raise&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">PersonId</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">CompanyId</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get company associations for multiple persons.</span>

<span class="sd">    Makes one V1 API call per person.</span>

<span class="sd">    Args:</span>
<span class="sd">        person_ids: Sequence of person IDs to fetch</span>
<span class="sd">        on_error: How to handle errors - &quot;raise&quot; (default) or &quot;skip&quot; failed IDs</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dict mapping person_id -&gt; list of company_ids</span>

<span class="sd">    Raises:</span>
<span class="sd">        AffinityError: If on_error=&quot;raise&quot; and any fetch fails.</span>

<span class="sd">    Example:</span>
<span class="sd">        associations = client.persons.get_associated_company_ids_batch(person_ids)</span>
<span class="sd">        all_company_ids = set()</span>
<span class="sd">        for company_ids in associations.values():</span>
<span class="sd">            all_company_ids.update(company_ids)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">PersonId</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">CompanyId</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">person_id</span> <span class="ow">in</span> <span class="n">person_ids</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_associated_company_ids</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">AffinityError</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s2">&quot;raise&quot;</span><span class="p">:</span>
                <span class="k">raise</span>
            <span class="c1"># skip: continue without this person</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s2">&quot;raise&quot;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">AffinityError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Failed to get associations for person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
            <span class="c1"># skip: continue without this person</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.persons.PersonService.get_associated_opportunity_ids" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_associated_opportunity_ids</span><span class="p">(</span><span class="n">person_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">]</span></code>

<a href="#affinity.services.persons.PersonService.get_associated_opportunity_ids" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Get associated opportunity IDs for a person.</p>
<p>V1-only: V2 does not expose person -&gt; opportunity associations directly.
Uses GET <code>/persons/{id}</code> (V1) and returns <code>opportunity_ids</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>person_id</code>
            </td>
            <td>
                  <code><span title="affinity.models.types.PersonId">PersonId</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The person ID</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_results</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of opportunity IDs to return</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="builtins.list">list</span>[<span title="affinity.models.types.OpportunityId">OpportunityId</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of OpportunityId values associated with this person</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>The Person model already has <code>opportunity_ids</code> populated from V1's
<code>opportunityIds</code> field. This method provides API parity with
<code>OpportunityService.get_associated_person_ids()</code>.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/persons.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_associated_opportunity_ids</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">person_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get associated opportunity IDs for a person.</span>

<span class="sd">    V1-only: V2 does not expose person -&gt; opportunity associations directly.</span>
<span class="sd">    Uses GET `/persons/{id}` (V1) and returns `opportunity_ids`.</span>

<span class="sd">    Args:</span>
<span class="sd">        person_id: The person ID</span>
<span class="sd">        max_results: Maximum number of opportunity IDs to return</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of OpportunityId values associated with this person</span>

<span class="sd">    Note:</span>
<span class="sd">        The Person model already has `opportunity_ids` populated from V1&#39;s</span>
<span class="sd">        `opportunityIds` field. This method provides API parity with</span>
<span class="sd">        `OpportunityService.get_associated_person_ids()`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/persons/</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Defensive: handle potential {&quot;person&quot;: {...}} wrapper</span>
    <span class="n">person</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;person&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">person</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">data</span>
    <span class="n">opp_ids</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">opp_ids</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;opportunity_ids&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;opportunityIds&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">opp_ids</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">OpportunityId</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">oid</span><span class="p">))</span> <span class="k">for</span> <span class="n">oid</span> <span class="ow">in</span> <span class="n">opp_ids</span> <span class="k">if</span> <span class="n">oid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">max_results</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_results</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ids</span><span class="p">[:</span><span class="n">max_results</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ids</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.persons.PersonService.get_associated_opportunity_ids_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_associated_opportunity_ids_batch</span><span class="p">(</span><span class="n">person_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">PersonId</span><span class="p">],</span> <span class="o">*</span><span class="p">,</span> <span class="n">on_error</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;raise&#39;</span><span class="p">,</span> <span class="s1">&#39;skip&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;raise&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">PersonId</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">]]</span></code>

<a href="#affinity.services.persons.PersonService.get_associated_opportunity_ids_batch" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Get opportunity associations for multiple persons.</p>
<p>Makes one V1 API call per person.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>person_ids</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="affinity.models.types.PersonId">PersonId</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sequence of person IDs to fetch</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>on_error</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;raise&#39;, &#39;skip&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How to handle errors - "raise" (default) or "skip" failed IDs</p>
              </div>
            </td>
            <td>
                  <code>&#39;raise&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="affinity.models.types.PersonId">PersonId</span>, <span title="builtins.list">list</span>[<span title="affinity.models.types.OpportunityId">OpportunityId</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict mapping person_id -&gt; list of opportunity_ids</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="AffinityError (affinity.exceptions.AffinityError)" href="../../exceptions/#affinity.exceptions.AffinityError">AffinityError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If on_error="raise" and any fetch fails.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/persons.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_associated_opportunity_ids_batch</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">person_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">PersonId</span><span class="p">],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">on_error</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;raise&quot;</span><span class="p">,</span> <span class="s2">&quot;skip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;raise&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">PersonId</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get opportunity associations for multiple persons.</span>

<span class="sd">    Makes one V1 API call per person.</span>

<span class="sd">    Args:</span>
<span class="sd">        person_ids: Sequence of person IDs to fetch</span>
<span class="sd">        on_error: How to handle errors - &quot;raise&quot; (default) or &quot;skip&quot; failed IDs</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dict mapping person_id -&gt; list of opportunity_ids</span>

<span class="sd">    Raises:</span>
<span class="sd">        AffinityError: If on_error=&quot;raise&quot; and any fetch fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">PersonId</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">person_id</span> <span class="ow">in</span> <span class="n">person_ids</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_associated_opportunity_ids</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">AffinityError</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s2">&quot;raise&quot;</span><span class="p">:</span>
                <span class="k">raise</span>
            <span class="c1"># skip: continue without this person</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s2">&quot;raise&quot;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">AffinityError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Failed to get associations for person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
            <span class="c1"># skip: continue without this person</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.persons.PersonService.get_fields" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_fields</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">field_types</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">FieldType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">FieldMetadata</span><span class="p">]</span></code>

<a href="#affinity.services.persons.PersonService.get_fields" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Get metadata about person fields.</p>
<p>Cached for performance.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/persons.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_fields</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">field_types</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">FieldType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">FieldMetadata</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get metadata about person fields.</span>

<span class="sd">    Cached for performance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">field_types</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;fieldTypes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">field_type</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">field_type</span> <span class="ow">in</span> <span class="n">field_types</span><span class="p">]</span>

    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="s2">&quot;/persons/fields&quot;</span><span class="p">,</span>
        <span class="n">params</span><span class="o">=</span><span class="n">params</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cache_key</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;person_fields:</span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">field_types</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">[])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">cache_ttl</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">FieldMetadata</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">[])]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.persons.PersonService.get_list_entries" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_list_entries</span><span class="p">(</span><span class="n">person_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">ListEntry</span><span class="p">]</span></code>

<a href="#affinity.services.persons.PersonService.get_list_entries" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Get all list entries for a person across all lists.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/persons.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_list_entries</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">person_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">ListEntry</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all list entries for a person across all lists.&quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/persons/</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">/list-entries&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">ListEntry</span><span class="p">](</span>
        <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">ListEntry</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">[])],</span>
        <span class="n">pagination</span><span class="o">=</span><span class="n">PaginationInfo</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pagination&quot;</span><span class="p">,</span> <span class="p">{})),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.persons.PersonService.get_lists" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_lists</span><span class="p">(</span><span class="n">person_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">ListSummary</span><span class="p">]</span></code>

<a href="#affinity.services.persons.PersonService.get_lists" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Get all lists that contain this person.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/persons.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_lists</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">person_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">ListSummary</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all lists that contain this person.&quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/persons/</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">/lists&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">ListSummary</span><span class="p">](</span>
        <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">ListSummary</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">[])],</span>
        <span class="n">pagination</span><span class="o">=</span><span class="n">PaginationInfo</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pagination&quot;</span><span class="p">,</span> <span class="p">{})),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.persons.PersonService.get_merge_status" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_merge_status</span><span class="p">(</span><span class="n">task_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MergeTask</span></code>

<a href="#affinity.services.persons.PersonService.get_merge_status" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Check the status of a merge operation.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/persons.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_merge_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MergeTask</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check the status of a merge operation.&quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/tasks/person-merges/</span><span class="si">{</span><span class="n">task_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">MergeTask</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.persons.PersonService.iter" class="doc doc-heading">
            <code class="highlight language-python"><span class="nb">iter</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">PersonId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">field_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">AnyFieldId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">field_types</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">FieldType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">FilterExpression</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Person</span><span class="p">]</span></code>

<a href="#affinity.services.persons.PersonService.iter" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Auto-paginate all persons.</p>
<p>Alias for <code>all()</code> (FR-006 public contract).</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/persons.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">iter</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">PersonId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">field_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">AnyFieldId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">field_types</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">FieldType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">FilterExpression</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Person</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Auto-paginate all persons.</span>

<span class="sd">    Alias for `all()` (FR-006 public contract).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">ids</span><span class="o">=</span><span class="n">ids</span><span class="p">,</span> <span class="n">field_ids</span><span class="o">=</span><span class="n">field_ids</span><span class="p">,</span> <span class="n">field_types</span><span class="o">=</span><span class="n">field_types</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.persons.PersonService.list" class="doc doc-heading">
            <code class="highlight language-python"><span class="nb">list</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">PersonId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">field_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">AnyFieldId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">field_types</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">FieldType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">FilterExpression</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cursor</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Person</span><span class="p">]</span></code>

<a href="#affinity.services.persons.PersonService.list" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Get a page of persons.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ids</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="affinity.models.types.PersonId">PersonId</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Specific person IDs to fetch (batch lookup)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>field_ids</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="affinity.models.types.AnyFieldId">AnyFieldId</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Specific field IDs to include in response</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>field_types</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<a class="autorefs autorefs-internal" title="FieldType (affinity.models.types.FieldType)" href="../../types/#affinity.types.FieldType">FieldType</a>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Field types to include</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filter</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <a class="autorefs autorefs-internal" title="FilterExpression (affinity.filters.FilterExpression)" href="../../filters/#affinity.filters.FilterExpression">FilterExpression</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>V2 filter expression string, or a FilterExpression built via <code>affinity.F</code></p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>limit</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of results</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cursor</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cursor to resume pagination (opaque; obtained from prior responses)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="PaginatedResponse (affinity.models.pagination.PaginatedResponse)" href="../../models/#affinity.models.PaginatedResponse">PaginatedResponse</a>[<a class="autorefs autorefs-internal" title="Person (affinity.models.entities.Person)" href="../../models/#affinity.models.Person">Person</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Paginated response with persons</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/persons.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">PersonId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">field_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">AnyFieldId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">field_types</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">FieldType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">FilterExpression</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">cursor</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Person</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a page of persons.</span>

<span class="sd">    Args:</span>
<span class="sd">        ids: Specific person IDs to fetch (batch lookup)</span>
<span class="sd">        field_ids: Specific field IDs to include in response</span>
<span class="sd">        field_types: Field types to include</span>
<span class="sd">        filter: V2 filter expression string, or a FilterExpression built via `affinity.F`</span>
<span class="sd">        limit: Maximum number of results</span>
<span class="sd">        cursor: Cursor to resume pagination (opaque; obtained from prior responses)</span>

<span class="sd">    Returns:</span>
<span class="sd">        Paginated response with persons</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">cursor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">p</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">field_ids</span><span class="p">,</span> <span class="n">field_types</span><span class="p">,</span> <span class="nb">filter</span><span class="p">,</span> <span class="n">limit</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot combine &#39;cursor&#39; with other parameters; cursor encodes all query &quot;</span>
                <span class="s2">&quot;context. Start a new pagination sequence without a cursor to change &quot;</span>
                <span class="s2">&quot;parameters.&quot;</span>
            <span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get_url</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">ids</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;ids&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span> <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">field_ids</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;fieldIds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">field_id</span><span class="p">)</span> <span class="k">for</span> <span class="n">field_id</span> <span class="ow">in</span> <span class="n">field_ids</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">field_types</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;fieldTypes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">field_type</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">field_type</span> <span class="ow">in</span> <span class="n">field_types</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filter_text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">filter</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">filter_text</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s2">&quot;filter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filter_text</span>
        <span class="k">if</span> <span class="n">limit</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;limit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">limit</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/persons&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Person</span><span class="p">](</span>
        <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">Person</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">[])],</span>
        <span class="n">pagination</span><span class="o">=</span><span class="n">PaginationInfo</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pagination&quot;</span><span class="p">,</span> <span class="p">{})),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.persons.PersonService.merge" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">merge</span><span class="p">(</span><span class="n">primary_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">,</span> <span class="n">duplicate_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span></code>

<a href="#affinity.services.persons.PersonService.merge" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Merge a duplicate person into a primary person.</p>
<p>Returns a task URL to check merge status.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/persons.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">merge</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">primary_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">,</span>
    <span class="n">duplicate_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Merge a duplicate person into a primary person.</span>

<span class="sd">    Returns a task URL to check merge status.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">enable_beta_endpoints</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">BetaEndpointDisabledError</span><span class="p">(</span>
            <span class="s2">&quot;Person merge is a beta endpoint; set enable_beta_endpoints=True to use it.&quot;</span>
        <span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
        <span class="s2">&quot;/person-merges&quot;</span><span class="p">,</span>
        <span class="n">json</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;primaryPersonId&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">primary_id</span><span class="p">),</span>
            <span class="s2">&quot;duplicatePersonId&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">duplicate_id</span><span class="p">),</span>
        <span class="p">},</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;taskUrl&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.persons.PersonService.pages" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pages</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">PersonId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">field_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">AnyFieldId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">field_types</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">FieldType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">FilterExpression</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cursor</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Person</span><span class="p">]]</span></code>

<a href="#affinity.services.persons.PersonService.pages" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Iterate person pages (not items), yielding <code>PaginatedResponse[Person]</code>.</p>
<p>Useful for ETL scripts that need checkpoint/resume via <code>page.next_cursor</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ids</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="affinity.models.types.PersonId">PersonId</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Specific person IDs to fetch (batch lookup)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>field_ids</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="affinity.models.types.AnyFieldId">AnyFieldId</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Specific field IDs to include in response</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>field_types</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<a class="autorefs autorefs-internal" title="FieldType (affinity.models.types.FieldType)" href="../../types/#affinity.types.FieldType">FieldType</a>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Field types to include</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filter</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <a class="autorefs autorefs-internal" title="FilterExpression (affinity.filters.FilterExpression)" href="../../filters/#affinity.filters.FilterExpression">FilterExpression</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>V2 filter expression string or FilterExpression</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>limit</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum results per page</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cursor</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cursor to resume pagination</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Yields:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="PaginatedResponse (affinity.models.pagination.PaginatedResponse)" href="../../models/#affinity.models.PaginatedResponse">PaginatedResponse</a>[<a class="autorefs autorefs-internal" title="Person (affinity.models.entities.Person)" href="../../models/#affinity.models.Person">Person</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>PaginatedResponse[Person] for each page</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/persons.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pages</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">PersonId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">field_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">AnyFieldId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">field_types</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">FieldType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">FilterExpression</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">cursor</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Person</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Iterate person pages (not items), yielding `PaginatedResponse[Person]`.</span>

<span class="sd">    Useful for ETL scripts that need checkpoint/resume via `page.next_cursor`.</span>

<span class="sd">    Args:</span>
<span class="sd">        ids: Specific person IDs to fetch (batch lookup)</span>
<span class="sd">        field_ids: Specific field IDs to include in response</span>
<span class="sd">        field_types: Field types to include</span>
<span class="sd">        filter: V2 filter expression string or FilterExpression</span>
<span class="sd">        limit: Maximum results per page</span>
<span class="sd">        cursor: Cursor to resume pagination</span>

<span class="sd">    Yields:</span>
<span class="sd">        PaginatedResponse[Person] for each page</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">other_params</span> <span class="o">=</span> <span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">field_ids</span><span class="p">,</span> <span class="n">field_types</span><span class="p">,</span> <span class="nb">filter</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cursor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="n">p</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">other_params</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Cannot combine &#39;cursor&#39; with other parameters; cursor encodes all query context. &quot;</span>
            <span class="s2">&quot;Start a new pagination sequence without a cursor to change parameters.&quot;</span>
        <span class="p">)</span>
    <span class="n">requested_cursor</span> <span class="o">=</span> <span class="n">cursor</span>
    <span class="n">page</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">cursor</span><span class="o">=</span><span class="n">cursor</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cursor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">(</span>
            <span class="n">ids</span><span class="o">=</span><span class="n">ids</span><span class="p">,</span> <span class="n">field_ids</span><span class="o">=</span><span class="n">field_ids</span><span class="p">,</span> <span class="n">field_types</span><span class="o">=</span><span class="n">field_types</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">page</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">page</span><span class="o">.</span><span class="n">has_next</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">next_cursor</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">next_cursor</span>
        <span class="k">if</span> <span class="n">next_cursor</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">next_cursor</span> <span class="o">==</span> <span class="n">requested_cursor</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">requested_cursor</span> <span class="o">=</span> <span class="n">next_cursor</span>
        <span class="n">page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">cursor</span><span class="o">=</span><span class="n">next_cursor</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.persons.PersonService.resolve" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">resolve</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">email</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Person</span> <span class="o">|</span> <span class="kc">None</span></code>

<a href="#affinity.services.persons.PersonService.resolve" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Find a single person by email or name.</p>
<p>This is a convenience helper that searches and returns the first exact match,
or None if not found. Uses V1 search internally.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>email</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Email address to search for</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Person name to search for (first + last)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="Person (affinity.models.entities.Person)" href="../../models/#affinity.models.Person">Person</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The matching Person, or None if not found</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If neither email nor name is provided</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>This auto-paginates V1 search results until a match is found.
If multiple matches are found, returns the first one. For full
disambiguation, use resolve_all() or search() directly.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/persons.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">resolve</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">email</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Person</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find a single person by email or name.</span>

<span class="sd">    This is a convenience helper that searches and returns the first exact match,</span>
<span class="sd">    or None if not found. Uses V1 search internally.</span>

<span class="sd">    Args:</span>
<span class="sd">        email: Email address to search for</span>
<span class="sd">        name: Person name to search for (first + last)</span>

<span class="sd">    Returns:</span>
<span class="sd">        The matching Person, or None if not found</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If neither email nor name is provided</span>

<span class="sd">    Note:</span>
<span class="sd">        This auto-paginates V1 search results until a match is found.</span>
<span class="sd">        If multiple matches are found, returns the first one. For full</span>
<span class="sd">        disambiguation, use resolve_all() or search() directly.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">email</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must provide either email or name&quot;</span><span class="p">)</span>

    <span class="n">term</span> <span class="o">=</span> <span class="n">email</span> <span class="ow">or</span> <span class="n">name</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_pages</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">page_size</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">page</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_person_matches</span><span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">person</span>

    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.persons.PersonService.resolve_all" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">resolve_all</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">email</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">Person</span><span class="p">]</span></code>

<a href="#affinity.services.persons.PersonService.resolve_all" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Find all persons matching an email or name.</p>
<p>Notes:
- This auto-paginates V1 search results to collect exact matches.
- Unlike resolve(), this returns every match in server-provided order.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/persons.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">resolve_all</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">email</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">Person</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find all persons matching an email or name.</span>

<span class="sd">    Notes:</span>
<span class="sd">    - This auto-paginates V1 search results to collect exact matches.</span>
<span class="sd">    - Unlike resolve(), this returns every match in server-provided order.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">email</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must provide either email or name&quot;</span><span class="p">)</span>

    <span class="n">term</span> <span class="o">=</span> <span class="n">email</span> <span class="ow">or</span> <span class="n">name</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
    <span class="n">matches</span><span class="p">:</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">Person</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_pages</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">page_size</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">page</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_person_matches</span><span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">):</span>
                <span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">person</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">matches</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.persons.PersonService.search" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">search</span><span class="p">(</span><span class="n">term</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">with_interaction_dates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">with_interaction_persons</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">with_opportunities</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">page_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">page_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Person</span><span class="p">]</span></code>

<a href="#affinity.services.persons.PersonService.search" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Search for persons by name or email.</p>
<p>Uses V1 API for search functionality.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>term</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Search term (name or email)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>with_interaction_dates</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Include interaction date data</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>with_interaction_persons</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Include persons for interactions</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>with_opportunities</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Include associated opportunity IDs</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>page_size</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Results per page (max 500)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>page_token</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pagination token</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="PaginatedResponse (affinity.models.pagination.PaginatedResponse)" href="../../models/#affinity.models.PaginatedResponse">PaginatedResponse</a>[<a class="autorefs autorefs-internal" title="Person (affinity.models.entities.Person)" href="../../models/#affinity.models.Person">Person</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>PaginatedResponse[Person] with matching persons and pagination info</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/persons.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">search</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">term</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">with_interaction_dates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">with_interaction_persons</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">with_opportunities</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">page_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">page_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Person</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Search for persons by name or email.</span>

<span class="sd">    Uses V1 API for search functionality.</span>

<span class="sd">    Args:</span>
<span class="sd">        term: Search term (name or email)</span>
<span class="sd">        with_interaction_dates: Include interaction date data</span>
<span class="sd">        with_interaction_persons: Include persons for interactions</span>
<span class="sd">        with_opportunities: Include associated opportunity IDs</span>
<span class="sd">        page_size: Results per page (max 500)</span>
<span class="sd">        page_token: Pagination token</span>

<span class="sd">    Returns:</span>
<span class="sd">        PaginatedResponse[Person] with matching persons and pagination info</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;term&quot;</span><span class="p">:</span> <span class="n">term</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">with_interaction_dates</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;with_interaction_dates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">with_interaction_persons</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;with_interaction_persons&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">with_opportunities</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;with_opportunities&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">page_size</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;page_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">page_size</span>
    <span class="k">if</span> <span class="n">page_token</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;page_token&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">page_token</span>

    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/persons&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">Person</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;persons&quot;</span><span class="p">,</span> <span class="p">[])]</span>
    <span class="k">return</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Person</span><span class="p">](</span>
        <span class="n">data</span><span class="o">=</span><span class="n">items</span><span class="p">,</span>
        <span class="n">next_page_token</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;next_page_token&quot;</span><span class="p">),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.persons.PersonService.search_all" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">search_all</span><span class="p">(</span><span class="n">term</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">with_interaction_dates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">with_interaction_persons</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">with_opportunities</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">page_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">page_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Person</span><span class="p">]</span></code>

<a href="#affinity.services.persons.PersonService.search_all" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Iterate all V1 person-search results with automatic pagination.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>term</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Search term (name or email)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>with_interaction_dates</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Include interaction date data</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>with_interaction_persons</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Include persons for interactions</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>with_opportunities</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Include associated opportunity IDs</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>page_size</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Results per page (max 500)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>page_token</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Resume from this pagination token</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Yields:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="Person (affinity.models.entities.Person)" href="../../models/#affinity.models.Person">Person</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Person objects matching the search term</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/persons.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">search_all</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">term</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">with_interaction_dates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">with_interaction_persons</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">with_opportunities</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">page_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">page_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Person</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Iterate all V1 person-search results with automatic pagination.</span>

<span class="sd">    Args:</span>
<span class="sd">        term: Search term (name or email)</span>
<span class="sd">        with_interaction_dates: Include interaction date data</span>
<span class="sd">        with_interaction_persons: Include persons for interactions</span>
<span class="sd">        with_opportunities: Include associated opportunity IDs</span>
<span class="sd">        page_size: Results per page (max 500)</span>
<span class="sd">        page_token: Resume from this pagination token</span>

<span class="sd">    Yields:</span>
<span class="sd">        Person objects matching the search term</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_pages</span><span class="p">(</span>
        <span class="n">term</span><span class="p">,</span>
        <span class="n">with_interaction_dates</span><span class="o">=</span><span class="n">with_interaction_dates</span><span class="p">,</span>
        <span class="n">with_interaction_persons</span><span class="o">=</span><span class="n">with_interaction_persons</span><span class="p">,</span>
        <span class="n">with_opportunities</span><span class="o">=</span><span class="n">with_opportunities</span><span class="p">,</span>
        <span class="n">page_size</span><span class="o">=</span><span class="n">page_size</span><span class="p">,</span>
        <span class="n">page_token</span><span class="o">=</span><span class="n">page_token</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">yield from</span> <span class="n">page</span><span class="o">.</span><span class="n">data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.persons.PersonService.search_pages" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">search_pages</span><span class="p">(</span><span class="n">term</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">with_interaction_dates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">with_interaction_persons</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">with_opportunities</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">page_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">page_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Person</span><span class="p">]]</span></code>

<a href="#affinity.services.persons.PersonService.search_pages" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Iterate V1 person-search result pages.</p>
<p>Useful for scripts that need checkpoint/resume via <code>next_page_token</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>term</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Search term (name or email)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>with_interaction_dates</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Include interaction date data</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>with_interaction_persons</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Include persons for interactions</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>with_opportunities</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Include associated opportunity IDs</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>page_size</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Results per page (max 500)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>page_token</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Resume from this pagination token</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Yields:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="PaginatedResponse (affinity.models.pagination.PaginatedResponse)" href="../../models/#affinity.models.PaginatedResponse">PaginatedResponse</a>[<a class="autorefs autorefs-internal" title="Person (affinity.models.entities.Person)" href="../../models/#affinity.models.Person">Person</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>PaginatedResponse[Person] for each page</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/persons.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">search_pages</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">term</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">with_interaction_dates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">with_interaction_persons</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">with_opportunities</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">page_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">page_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Person</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Iterate V1 person-search result pages.</span>

<span class="sd">    Useful for scripts that need checkpoint/resume via `next_page_token`.</span>

<span class="sd">    Args:</span>
<span class="sd">        term: Search term (name or email)</span>
<span class="sd">        with_interaction_dates: Include interaction date data</span>
<span class="sd">        with_interaction_persons: Include persons for interactions</span>
<span class="sd">        with_opportunities: Include associated opportunity IDs</span>
<span class="sd">        page_size: Results per page (max 500)</span>
<span class="sd">        page_token: Resume from this pagination token</span>

<span class="sd">    Yields:</span>
<span class="sd">        PaginatedResponse[Person] for each page</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">requested_token</span> <span class="o">=</span> <span class="n">page_token</span>
    <span class="n">page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
        <span class="n">term</span><span class="p">,</span>
        <span class="n">with_interaction_dates</span><span class="o">=</span><span class="n">with_interaction_dates</span><span class="p">,</span>
        <span class="n">with_interaction_persons</span><span class="o">=</span><span class="n">with_interaction_persons</span><span class="p">,</span>
        <span class="n">with_opportunities</span><span class="o">=</span><span class="n">with_opportunities</span><span class="p">,</span>
        <span class="n">page_size</span><span class="o">=</span><span class="n">page_size</span><span class="p">,</span>
        <span class="n">page_token</span><span class="o">=</span><span class="n">page_token</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">page</span>
        <span class="n">next_token</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">next_page_token</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">next_token</span> <span class="ow">or</span> <span class="n">next_token</span> <span class="o">==</span> <span class="n">requested_token</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">requested_token</span> <span class="o">=</span> <span class="n">next_token</span>
        <span class="n">page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
            <span class="n">term</span><span class="p">,</span>
            <span class="n">with_interaction_dates</span><span class="o">=</span><span class="n">with_interaction_dates</span><span class="p">,</span>
            <span class="n">with_interaction_persons</span><span class="o">=</span><span class="n">with_interaction_persons</span><span class="p">,</span>
            <span class="n">with_opportunities</span><span class="o">=</span><span class="n">with_opportunities</span><span class="p">,</span>
            <span class="n">page_size</span><span class="o">=</span><span class="n">page_size</span><span class="p">,</span>
            <span class="n">page_token</span><span class="o">=</span><span class="n">next_token</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.persons.PersonService.update" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update</span><span class="p">(</span><span class="n">person_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">PersonUpdate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Person</span></code>

<a href="#affinity.services.persons.PersonService.update" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Update an existing person.</p>
<p>Note: To add emails/organizations, include existing values plus new ones.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/persons.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">person_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">,</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">PersonUpdate</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Person</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update an existing person.</span>

<span class="sd">    Note: To add emails/organizations, include existing values plus new ones.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span>
        <span class="n">by_alias</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">,</span>
        <span class="n">exclude_unset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">put</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;/persons/</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
        <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">cache</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">invalidate_prefix</span><span class="p">(</span><span class="s2">&quot;person&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">Person</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<a id="affinity.services.persons.AsyncPersonService"></a>
    <div class="doc doc-contents first">



        <p>Async version of PersonService.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>affinity/services/persons.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span>
<span class="normal">1768</span>
<span class="normal">1769</span>
<span class="normal">1770</span>
<span class="normal">1771</span>
<span class="normal">1772</span>
<span class="normal">1773</span>
<span class="normal">1774</span>
<span class="normal">1775</span>
<span class="normal">1776</span>
<span class="normal">1777</span>
<span class="normal">1778</span>
<span class="normal">1779</span>
<span class="normal">1780</span>
<span class="normal">1781</span>
<span class="normal">1782</span>
<span class="normal">1783</span>
<span class="normal">1784</span>
<span class="normal">1785</span>
<span class="normal">1786</span>
<span class="normal">1787</span>
<span class="normal">1788</span>
<span class="normal">1789</span>
<span class="normal">1790</span>
<span class="normal">1791</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AsyncPersonService</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Async version of PersonService.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">:</span> <span class="n">AsyncHTTPClient</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_client</span> <span class="o">=</span> <span class="n">client</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">PersonId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">field_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">AnyFieldId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">field_types</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">FieldType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">FilterExpression</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cursor</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Person</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a page of persons.</span>

<span class="sd">        Args:</span>
<span class="sd">            ids: Specific person IDs to fetch (batch lookup)</span>
<span class="sd">            field_ids: Specific field IDs to include in response</span>
<span class="sd">            field_types: Field types to include</span>
<span class="sd">            filter: V2 filter expression string, or a FilterExpression built via `affinity.F`</span>
<span class="sd">            limit: Maximum number of results</span>
<span class="sd">            cursor: Cursor to resume pagination (opaque; obtained from prior responses)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Paginated response with persons</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">cursor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">p</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">field_ids</span><span class="p">,</span> <span class="n">field_types</span><span class="p">,</span> <span class="nb">filter</span><span class="p">,</span> <span class="n">limit</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Cannot combine &#39;cursor&#39; with other parameters; cursor encodes all query &quot;</span>
                    <span class="s2">&quot;context. Start a new pagination sequence without a cursor to change &quot;</span>
                    <span class="s2">&quot;parameters.&quot;</span>
                <span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get_url</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="n">ids</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s2">&quot;ids&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span> <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">field_ids</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s2">&quot;fieldIds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">field_id</span><span class="p">)</span> <span class="k">for</span> <span class="n">field_id</span> <span class="ow">in</span> <span class="n">field_ids</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">field_types</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s2">&quot;fieldTypes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">field_type</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">field_type</span> <span class="ow">in</span> <span class="n">field_types</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">filter_text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">filter</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">filter_text</span><span class="p">:</span>
                    <span class="n">params</span><span class="p">[</span><span class="s2">&quot;filter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filter_text</span>
            <span class="k">if</span> <span class="n">limit</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s2">&quot;limit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">limit</span>
            <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/persons&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Person</span><span class="p">](</span>
            <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">Person</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">[])],</span>
            <span class="n">pagination</span><span class="o">=</span><span class="n">PaginationInfo</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pagination&quot;</span><span class="p">,</span> <span class="p">{})),</span>
        <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">pages</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">PersonId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">field_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">AnyFieldId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">field_types</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">FieldType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">FilterExpression</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cursor</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Person</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterate person pages (not items), yielding `PaginatedResponse[Person]`.</span>

<span class="sd">        Useful for ETL scripts that need checkpoint/resume via `page.next_cursor`.</span>

<span class="sd">        Args:</span>
<span class="sd">            ids: Specific person IDs to fetch (batch lookup)</span>
<span class="sd">            field_ids: Specific field IDs to include in response</span>
<span class="sd">            field_types: Field types to include</span>
<span class="sd">            filter: V2 filter expression string or FilterExpression</span>
<span class="sd">            limit: Maximum results per page</span>
<span class="sd">            cursor: Cursor to resume pagination</span>

<span class="sd">        Yields:</span>
<span class="sd">            PaginatedResponse[Person] for each page</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">other_params</span> <span class="o">=</span> <span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">field_ids</span><span class="p">,</span> <span class="n">field_types</span><span class="p">,</span> <span class="nb">filter</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cursor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="n">p</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">other_params</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot combine &#39;cursor&#39; with other parameters; cursor encodes all query context. &quot;</span>
                <span class="s2">&quot;Start a new pagination sequence without a cursor to change parameters.&quot;</span>
            <span class="p">)</span>
        <span class="n">requested_cursor</span> <span class="o">=</span> <span class="n">cursor</span>
        <span class="k">if</span> <span class="n">cursor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">page</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">cursor</span><span class="o">=</span><span class="n">cursor</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">page</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">(</span>
                <span class="n">ids</span><span class="o">=</span><span class="n">ids</span><span class="p">,</span>
                <span class="n">field_ids</span><span class="o">=</span><span class="n">field_ids</span><span class="p">,</span>
                <span class="n">field_types</span><span class="o">=</span><span class="n">field_types</span><span class="p">,</span>
                <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">,</span>
                <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">page</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">page</span><span class="o">.</span><span class="n">has_next</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">next_cursor</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">next_cursor</span>
            <span class="k">if</span> <span class="n">next_cursor</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">next_cursor</span> <span class="o">==</span> <span class="n">requested_cursor</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">requested_cursor</span> <span class="o">=</span> <span class="n">next_cursor</span>
            <span class="n">page</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">cursor</span><span class="o">=</span><span class="n">next_cursor</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">all</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">PersonId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">field_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">AnyFieldId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">field_types</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">FieldType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">FilterExpression</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">Person</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterate through all persons with automatic pagination.</span>

<span class="sd">        Args:</span>
<span class="sd">            ids: Specific person IDs to fetch (batch lookup)</span>
<span class="sd">            field_ids: Specific field IDs to include</span>
<span class="sd">            field_types: Field types to include</span>
<span class="sd">            filter: V2 filter expression</span>

<span class="sd">        Yields:</span>
<span class="sd">            Person objects</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">fetch_page</span><span class="p">(</span><span class="n">next_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Person</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">next_url</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get_url</span><span class="p">(</span><span class="n">next_url</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Person</span><span class="p">](</span>
                    <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">Person</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">[])],</span>
                    <span class="n">pagination</span><span class="o">=</span><span class="n">PaginationInfo</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pagination&quot;</span><span class="p">,</span> <span class="p">{})),</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">(</span>
                <span class="n">ids</span><span class="o">=</span><span class="n">ids</span><span class="p">,</span> <span class="n">field_ids</span><span class="o">=</span><span class="n">field_ids</span><span class="p">,</span> <span class="n">field_types</span><span class="o">=</span><span class="n">field_types</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">AsyncPageIterator</span><span class="p">(</span><span class="n">fetch_page</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">iter</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">PersonId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">field_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">AnyFieldId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">field_types</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">FieldType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">FilterExpression</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">Person</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Auto-paginate all persons.</span>

<span class="sd">        Alias for `all()` (FR-006 public contract).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">ids</span><span class="o">=</span><span class="n">ids</span><span class="p">,</span> <span class="n">field_ids</span><span class="o">=</span><span class="n">field_ids</span><span class="p">,</span> <span class="n">field_types</span><span class="o">=</span><span class="n">field_types</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">person_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">field_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">AnyFieldId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">field_types</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">FieldType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">include_field_values</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">with_interaction_dates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">with_interaction_persons</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Person</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a single person by ID.</span>

<span class="sd">        Args:</span>
<span class="sd">            person_id: The person ID</span>
<span class="sd">            field_ids: Specific field IDs to include in response</span>
<span class="sd">            field_types: Field types to include (e.g., [&quot;enriched&quot;, &quot;global&quot;])</span>
<span class="sd">            include_field_values: If True, fetch embedded field values. This saves</span>
<span class="sd">                one API call when you need both person info and field values.</span>
<span class="sd">                Cannot be combined with field_ids/field_types.</span>
<span class="sd">            retries: Number of retries on 404 NotFoundError. Default is 0 (fail fast).</span>
<span class="sd">                Set to 2-3 if calling immediately after create() to handle eventual</span>
<span class="sd">                consistency lag.</span>
<span class="sd">            with_interaction_dates: Include interaction date summaries (last/next</span>
<span class="sd">                meeting dates, email dates).</span>
<span class="sd">            with_interaction_persons: Include person IDs for each interaction.</span>
<span class="sd">                Only applies when with_interaction_dates=True.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Person object with requested field data.</span>
<span class="sd">            When include_field_values=True, the Person will have a `field_values`</span>
<span class="sd">            attribute containing the list of FieldValue objects.</span>
<span class="sd">            When with_interaction_dates=True, the Person will have interaction_dates</span>
<span class="sd">            and interactions populated.</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotFoundError: If person does not exist after all retries.</span>
<span class="sd">            ValueError: If include_field_values is combined with field_ids/field_types.</span>

<span class="sd">        Note:</span>
<span class="sd">            When combining with_interaction_dates with field_ids/field_types,</span>
<span class="sd">            two API calls are made internally and the results are merged.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_with_retry</span><span class="p">(</span>
            <span class="n">person_id</span><span class="p">,</span>
            <span class="n">field_ids</span><span class="o">=</span><span class="n">field_ids</span><span class="p">,</span>
            <span class="n">field_types</span><span class="o">=</span><span class="n">field_types</span><span class="p">,</span>
            <span class="n">include_field_values</span><span class="o">=</span><span class="n">include_field_values</span><span class="p">,</span>
            <span class="n">retries</span><span class="o">=</span><span class="n">retries</span><span class="p">,</span>
            <span class="n">with_interaction_dates</span><span class="o">=</span><span class="n">with_interaction_dates</span><span class="p">,</span>
            <span class="n">with_interaction_persons</span><span class="o">=</span><span class="n">with_interaction_persons</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_get_with_retry</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">person_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">field_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">AnyFieldId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">field_types</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">FieldType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">include_field_values</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">with_interaction_dates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">with_interaction_persons</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Person</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Internal: get with retry logic.&quot;&quot;&quot;</span>
        <span class="n">last_error</span><span class="p">:</span> <span class="n">NotFoundError</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">attempts</span> <span class="o">=</span> <span class="n">retries</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># retries=0 means 1 attempt</span>

        <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">attempts</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_impl</span><span class="p">(</span>
                    <span class="n">person_id</span><span class="p">,</span>
                    <span class="n">field_ids</span><span class="o">=</span><span class="n">field_ids</span><span class="p">,</span>
                    <span class="n">field_types</span><span class="o">=</span><span class="n">field_types</span><span class="p">,</span>
                    <span class="n">include_field_values</span><span class="o">=</span><span class="n">include_field_values</span><span class="p">,</span>
                    <span class="n">with_interaction_dates</span><span class="o">=</span><span class="n">with_interaction_dates</span><span class="p">,</span>
                    <span class="n">with_interaction_persons</span><span class="o">=</span><span class="n">with_interaction_persons</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="n">NotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">last_error</span> <span class="o">=</span> <span class="n">e</span>
                <span class="k">if</span> <span class="n">attempt</span> <span class="o">&lt;</span> <span class="n">attempts</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Don&#39;t sleep after last attempt</span>
                    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">attempt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>  <span class="c1"># 0.5s, 1s, 1.5s backoff</span>

        <span class="c1"># V1 fallback: If V2 returned 404, try V1 API (handles V1V2 sync delays)</span>
        <span class="c1"># Skip if already using V1 path (include_field_values or with_interaction_dates)</span>
        <span class="k">if</span> <span class="n">last_error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">include_field_values</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">with_interaction_dates</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">v1_data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/persons/</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">normalized</span> <span class="o">=</span> <span class="n">_normalize_v1_person_response</span><span class="p">(</span><span class="n">v1_data</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">Person</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">normalized</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">NotFoundError</span><span class="p">:</span>
                <span class="k">pass</span>  <span class="c1"># V1 also failed, raise original V2 error</span>

        <span class="k">raise</span> <span class="n">last_error</span>  <span class="c1"># type: ignore[misc]</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_get_impl</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">person_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">field_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">AnyFieldId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">field_types</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">FieldType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">include_field_values</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">with_interaction_dates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">with_interaction_persons</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Person</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Internal: actual get implementation.&quot;&quot;&quot;</span>
        <span class="n">has_field_filters</span> <span class="o">=</span> <span class="n">field_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">field_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

        <span class="c1"># include_field_values returns embedded field values, which is incompatible</span>
        <span class="c1"># with field_ids/field_types filtering (different data structures)</span>
        <span class="k">if</span> <span class="n">include_field_values</span> <span class="ow">and</span> <span class="n">has_field_filters</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot combine &#39;include_field_values&#39; with &#39;field_ids&#39; or &#39;field_types&#39;. &quot;</span>
                <span class="s2">&quot;Use include_field_values alone for embedded field values, or use &quot;</span>
                <span class="s2">&quot;field_ids/field_types alone for filtered fields.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Path 1: include_field_values (V1 API, may include interaction dates)</span>
        <span class="k">if</span> <span class="n">include_field_values</span><span class="p">:</span>
            <span class="n">v1_params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="n">with_interaction_dates</span><span class="p">:</span>
                <span class="n">v1_params</span><span class="p">[</span><span class="s2">&quot;with_interaction_dates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">with_interaction_persons</span><span class="p">:</span>
                <span class="n">v1_params</span><span class="p">[</span><span class="s2">&quot;with_interaction_persons&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;/persons/</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">params</span><span class="o">=</span><span class="n">v1_params</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">field_values_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;field_values&quot;</span><span class="p">,</span> <span class="p">[])</span>
            <span class="c1"># V1 embedded field_values don&#39;t include entityId; add it before validation</span>
            <span class="n">field_values</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">FieldValue</span><span class="o">.</span><span class="n">model_validate</span><span class="p">({</span><span class="o">**</span><span class="n">fv</span><span class="p">,</span> <span class="s2">&quot;entityId&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">person_id</span><span class="p">)})</span>
                <span class="k">for</span> <span class="n">fv</span> <span class="ow">in</span> <span class="n">field_values_data</span>
            <span class="p">]</span>
            <span class="n">normalized</span> <span class="o">=</span> <span class="n">_normalize_v1_person_response</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">person</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">normalized</span><span class="p">)</span>
            <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="s2">&quot;field_values&quot;</span><span class="p">,</span> <span class="n">field_values</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">person</span>

        <span class="c1"># Path 2: with_interaction_dates (may need merge if field filters present)</span>
        <span class="k">if</span> <span class="n">with_interaction_dates</span><span class="p">:</span>
            <span class="n">v1_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;with_interaction_dates&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">with_interaction_persons</span><span class="p">:</span>
                <span class="n">v1_params</span><span class="p">[</span><span class="s2">&quot;with_interaction_persons&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="n">interaction_data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;/persons/</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">params</span><span class="o">=</span><span class="n">v1_params</span><span class="p">,</span>
                <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># If field filtering is also requested, fetch filtered fields and merge</span>
            <span class="k">if</span> <span class="n">has_field_filters</span><span class="p">:</span>
                <span class="n">v2_params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">if</span> <span class="n">field_ids</span><span class="p">:</span>
                    <span class="n">v2_params</span><span class="p">[</span><span class="s2">&quot;fieldIds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">fid</span><span class="p">)</span> <span class="k">for</span> <span class="n">fid</span> <span class="ow">in</span> <span class="n">field_ids</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">field_types</span><span class="p">:</span>
                    <span class="n">v2_params</span><span class="p">[</span><span class="s2">&quot;fieldTypes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ft</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">ft</span> <span class="ow">in</span> <span class="n">field_types</span><span class="p">]</span>

                <span class="n">filtered_data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;/persons/</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">params</span><span class="o">=</span><span class="n">v2_params</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="c1"># Merge: filtered fields + interaction data</span>
                <span class="n">filtered_data</span><span class="p">[</span><span class="s2">&quot;interaction_dates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interaction_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;interaction_dates&quot;</span><span class="p">)</span>
                <span class="n">filtered_data</span><span class="p">[</span><span class="s2">&quot;interactions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interaction_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;interactions&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">Person</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">filtered_data</span><span class="p">)</span>

            <span class="c1"># No field filtering, normalize and return V1 data</span>
            <span class="n">normalized</span> <span class="o">=</span> <span class="n">_normalize_v1_person_response</span><span class="p">(</span><span class="n">interaction_data</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Person</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">normalized</span><span class="p">)</span>

        <span class="c1"># Path 3: Standard path (supports field filtering)</span>
        <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">field_ids</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;fieldIds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">field_id</span><span class="p">)</span> <span class="k">for</span> <span class="n">field_id</span> <span class="ow">in</span> <span class="n">field_ids</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">field_types</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;fieldTypes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">field_type</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">field_type</span> <span class="ow">in</span> <span class="n">field_types</span><span class="p">]</span>

        <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/persons/</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Person</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_list_entries</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">person_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">ListEntry</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all list entries for a person across all lists.&quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/persons/</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">/list-entries&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">ListEntry</span><span class="p">](</span>
            <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">ListEntry</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">[])],</span>
            <span class="n">pagination</span><span class="o">=</span><span class="n">PaginationInfo</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pagination&quot;</span><span class="p">,</span> <span class="p">{})),</span>
        <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_lists</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">person_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">ListSummary</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all lists that contain this person.&quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/persons/</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">/lists&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">ListSummary</span><span class="p">](</span>
            <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">ListSummary</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">[])],</span>
            <span class="n">pagination</span><span class="o">=</span><span class="n">PaginationInfo</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pagination&quot;</span><span class="p">,</span> <span class="p">{})),</span>
        <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_fields</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">field_types</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">FieldType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">FieldMetadata</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get metadata about person fields.</span>

<span class="sd">        Cached for performance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">field_types</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;fieldTypes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">field_type</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">field_type</span> <span class="ow">in</span> <span class="n">field_types</span><span class="p">]</span>

        <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;/persons/fields&quot;</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="n">params</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">cache_key</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;person_fields:</span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">field_types</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">[])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">cache_ttl</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">FieldMetadata</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">[])]</span>

    <span class="c1"># =========================================================================</span>
    <span class="c1"># Associations (V1 API)</span>
    <span class="c1"># =========================================================================</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_associated_company_ids</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">person_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">CompanyId</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get associated company IDs for a person.</span>

<span class="sd">        V1-only: V2 does not expose person -&gt; company associations directly.</span>
<span class="sd">        Uses GET `/persons/{id}` (V1) and returns `organization_ids`.</span>

<span class="sd">        Args:</span>
<span class="sd">            person_id: The person ID</span>
<span class="sd">            max_results: Maximum number of company IDs to return</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of CompanyId values associated with this person</span>

<span class="sd">        Note:</span>
<span class="sd">            The Person model already has `company_ids` populated from V1&#39;s</span>
<span class="sd">            `organizationIds` field. This method provides API parity with</span>
<span class="sd">            `CompanyService.get_associated_person_ids()`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/persons/</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Defensive: handle potential {&quot;person&quot;: {...}} wrapper</span>
        <span class="c1"># (consistent with CompanyService.get_associated_person_ids pattern)</span>
        <span class="n">person</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;person&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">person</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">data</span>
        <span class="n">org_ids</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">org_ids</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organization_ids&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organizationIds&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">org_ids</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">CompanyId</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">cid</span><span class="p">))</span> <span class="k">for</span> <span class="n">cid</span> <span class="ow">in</span> <span class="n">org_ids</span> <span class="k">if</span> <span class="n">cid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">max_results</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_results</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ids</span><span class="p">[:</span><span class="n">max_results</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">ids</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_associated_company_ids_batch</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">person_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">PersonId</span><span class="p">],</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">on_error</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;raise&quot;</span><span class="p">,</span> <span class="s2">&quot;skip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;raise&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">PersonId</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">CompanyId</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get company associations for multiple persons.</span>

<span class="sd">        Makes one V1 API call per person.</span>

<span class="sd">        Args:</span>
<span class="sd">            person_ids: Sequence of person IDs to fetch</span>
<span class="sd">            on_error: How to handle errors - &quot;raise&quot; (default) or &quot;skip&quot; failed IDs</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict mapping person_id -&gt; list of company_ids</span>

<span class="sd">        Raises:</span>
<span class="sd">            AffinityError: If on_error=&quot;raise&quot; and any fetch fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">PersonId</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">CompanyId</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">person_id</span> <span class="ow">in</span> <span class="n">person_ids</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_associated_company_ids</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">AffinityError</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s2">&quot;raise&quot;</span><span class="p">:</span>
                    <span class="k">raise</span>
                <span class="c1"># skip: continue without this person</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s2">&quot;raise&quot;</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">AffinityError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Failed to get associations for person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
                <span class="c1"># skip: continue without this person</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_associated_opportunity_ids</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">person_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get associated opportunity IDs for a person.</span>

<span class="sd">        V1-only: V2 does not expose person -&gt; opportunity associations directly.</span>
<span class="sd">        Uses GET `/persons/{id}` (V1) and returns `opportunity_ids`.</span>

<span class="sd">        Args:</span>
<span class="sd">            person_id: The person ID</span>
<span class="sd">            max_results: Maximum number of opportunity IDs to return</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of OpportunityId values associated with this person</span>

<span class="sd">        Note:</span>
<span class="sd">            The Person model already has `opportunity_ids` populated from V1&#39;s</span>
<span class="sd">            `opportunityIds` field. This method provides API parity with</span>
<span class="sd">            `OpportunityService.get_associated_person_ids()`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/persons/</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Defensive: handle potential {&quot;person&quot;: {...}} wrapper</span>
        <span class="n">person</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;person&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">person</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">data</span>
        <span class="n">opp_ids</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">opp_ids</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;opportunity_ids&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;opportunityIds&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">opp_ids</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">OpportunityId</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">oid</span><span class="p">))</span> <span class="k">for</span> <span class="n">oid</span> <span class="ow">in</span> <span class="n">opp_ids</span> <span class="k">if</span> <span class="n">oid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">max_results</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_results</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ids</span><span class="p">[:</span><span class="n">max_results</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">ids</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_associated_opportunity_ids_batch</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">person_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">PersonId</span><span class="p">],</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">on_error</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;raise&quot;</span><span class="p">,</span> <span class="s2">&quot;skip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;raise&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">PersonId</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get opportunity associations for multiple persons.</span>

<span class="sd">        Makes one V1 API call per person.</span>

<span class="sd">        Args:</span>
<span class="sd">            person_ids: Sequence of person IDs to fetch</span>
<span class="sd">            on_error: How to handle errors - &quot;raise&quot; (default) or &quot;skip&quot; failed IDs</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict mapping person_id -&gt; list of opportunity_ids</span>

<span class="sd">        Raises:</span>
<span class="sd">            AffinityError: If on_error=&quot;raise&quot; and any fetch fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">PersonId</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">person_id</span> <span class="ow">in</span> <span class="n">person_ids</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_associated_opportunity_ids</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">AffinityError</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s2">&quot;raise&quot;</span><span class="p">:</span>
                    <span class="k">raise</span>
                <span class="c1"># skip: continue without this person</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s2">&quot;raise&quot;</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">AffinityError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Failed to get associations for person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
                <span class="c1"># skip: continue without this person</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="c1"># =========================================================================</span>
    <span class="c1"># Search (V1 API)</span>
    <span class="c1"># =========================================================================</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">search</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">term</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">with_interaction_dates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">with_interaction_persons</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">with_opportunities</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">page_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">page_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Person</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Search for persons by name or email.</span>

<span class="sd">        Uses V1 API for search functionality.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;term&quot;</span><span class="p">:</span> <span class="n">term</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">with_interaction_dates</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;with_interaction_dates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">with_interaction_persons</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;with_interaction_persons&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">with_opportunities</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;with_opportunities&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">page_size</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;page_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">page_size</span>
        <span class="k">if</span> <span class="n">page_token</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;page_token&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">page_token</span>

        <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/persons&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">Person</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;persons&quot;</span><span class="p">,</span> <span class="p">[])]</span>
        <span class="k">return</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Person</span><span class="p">](</span>
            <span class="n">data</span><span class="o">=</span><span class="n">items</span><span class="p">,</span>
            <span class="n">next_page_token</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;next_page_token&quot;</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">search_pages</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">term</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">with_interaction_dates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">with_interaction_persons</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">with_opportunities</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">page_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">page_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Person</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterate V1 person-search result pages.</span>

<span class="sd">        Useful for scripts that need checkpoint/resume via `next_page_token`.</span>

<span class="sd">        Args:</span>
<span class="sd">            term: Search term (name or email)</span>
<span class="sd">            with_interaction_dates: Include interaction date data</span>
<span class="sd">            with_interaction_persons: Include persons for interactions</span>
<span class="sd">            with_opportunities: Include associated opportunity IDs</span>
<span class="sd">            page_size: Results per page (max 500)</span>
<span class="sd">            page_token: Resume from this pagination token</span>

<span class="sd">        Yields:</span>
<span class="sd">            PaginatedResponse[Person] for each page</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">requested_token</span> <span class="o">=</span> <span class="n">page_token</span>
        <span class="n">page</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
            <span class="n">term</span><span class="p">,</span>
            <span class="n">with_interaction_dates</span><span class="o">=</span><span class="n">with_interaction_dates</span><span class="p">,</span>
            <span class="n">with_interaction_persons</span><span class="o">=</span><span class="n">with_interaction_persons</span><span class="p">,</span>
            <span class="n">with_opportunities</span><span class="o">=</span><span class="n">with_opportunities</span><span class="p">,</span>
            <span class="n">page_size</span><span class="o">=</span><span class="n">page_size</span><span class="p">,</span>
            <span class="n">page_token</span><span class="o">=</span><span class="n">page_token</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">page</span>
            <span class="n">next_token</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">next_page_token</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">next_token</span> <span class="ow">or</span> <span class="n">next_token</span> <span class="o">==</span> <span class="n">requested_token</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">requested_token</span> <span class="o">=</span> <span class="n">next_token</span>
            <span class="n">page</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
                <span class="n">term</span><span class="p">,</span>
                <span class="n">with_interaction_dates</span><span class="o">=</span><span class="n">with_interaction_dates</span><span class="p">,</span>
                <span class="n">with_interaction_persons</span><span class="o">=</span><span class="n">with_interaction_persons</span><span class="p">,</span>
                <span class="n">with_opportunities</span><span class="o">=</span><span class="n">with_opportunities</span><span class="p">,</span>
                <span class="n">page_size</span><span class="o">=</span><span class="n">page_size</span><span class="p">,</span>
                <span class="n">page_token</span><span class="o">=</span><span class="n">next_token</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">search_all</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">term</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">with_interaction_dates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">with_interaction_persons</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">with_opportunities</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">page_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">page_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">Person</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterate all V1 person-search results with automatic pagination.</span>

<span class="sd">        Args:</span>
<span class="sd">            term: Search term (name or email)</span>
<span class="sd">            with_interaction_dates: Include interaction date data</span>
<span class="sd">            with_interaction_persons: Include persons for interactions</span>
<span class="sd">            with_opportunities: Include associated opportunity IDs</span>
<span class="sd">            page_size: Results per page (max 500)</span>
<span class="sd">            page_token: Resume from this pagination token</span>

<span class="sd">        Yields:</span>
<span class="sd">            Person objects matching the search term</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">async</span> <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_pages</span><span class="p">(</span>
            <span class="n">term</span><span class="p">,</span>
            <span class="n">with_interaction_dates</span><span class="o">=</span><span class="n">with_interaction_dates</span><span class="p">,</span>
            <span class="n">with_interaction_persons</span><span class="o">=</span><span class="n">with_interaction_persons</span><span class="p">,</span>
            <span class="n">with_opportunities</span><span class="o">=</span><span class="n">with_opportunities</span><span class="p">,</span>
            <span class="n">page_size</span><span class="o">=</span><span class="n">page_size</span><span class="p">,</span>
            <span class="n">page_token</span><span class="o">=</span><span class="n">page_token</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">page</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">person</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">resolve</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">email</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Person</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find a single person by email or name.</span>

<span class="sd">        This is a convenience helper that searches and returns the first exact match,</span>
<span class="sd">        or None if not found. Uses V1 search internally.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">email</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must provide either email or name&quot;</span><span class="p">)</span>

        <span class="n">term</span> <span class="o">=</span> <span class="n">email</span> <span class="ow">or</span> <span class="n">name</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
        <span class="k">async</span> <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_pages</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">page_size</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">page</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_person_matches</span><span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">person</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">resolve_all</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">email</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">Person</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find all persons matching an email or name.</span>

<span class="sd">        Notes:</span>
<span class="sd">        - This auto-paginates V1 search results to collect exact matches.</span>
<span class="sd">        - Unlike resolve(), this returns every match in server-provided order.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">email</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must provide either email or name&quot;</span><span class="p">)</span>

        <span class="n">term</span> <span class="o">=</span> <span class="n">email</span> <span class="ow">or</span> <span class="n">name</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
        <span class="n">matches</span><span class="p">:</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">Person</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">async</span> <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_pages</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">page_size</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">page</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_person_matches</span><span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">):</span>
                    <span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">person</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">matches</span>

    <span class="c1"># =========================================================================</span>
    <span class="c1"># Write Operations (V1 API)</span>
    <span class="c1"># =========================================================================</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">PersonCreate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Person</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new person.</span>

<span class="sd">        Note:</span>
<span class="sd">            Creates use V1 API, while reads use V2 API. Due to eventual consistency</span>
<span class="sd">            between V1 and V2, a `get()` call immediately after `create()` may return</span>
<span class="sd">            404 NotFoundError. If you need to read immediately after creation, either:</span>
<span class="sd">            - Use the Person object returned by this method (it contains the created data)</span>
<span class="sd">            - Add a short delay (100-500ms) before calling get()</span>
<span class="sd">            - Implement retry logic in your application</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValidationError: If email conflicts with existing person</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">by_alias</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="o">.</span><span class="n">company_ids</span><span class="p">:</span>
            <span class="n">payload</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;organization_ids&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/persons&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">cache</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">invalidate_prefix</span><span class="p">(</span><span class="s2">&quot;person&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Person</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">person_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">PersonUpdate</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Person</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update an existing person.</span>

<span class="sd">        Note: To add emails/organizations, include existing values plus new ones.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span>
            <span class="n">by_alias</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">,</span>
            <span class="n">exclude_unset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">put</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;/persons/</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
            <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">cache</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">invalidate_prefix</span><span class="p">(</span><span class="s2">&quot;person&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Person</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete a person (also deletes associated field values).&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/persons/</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">cache</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">invalidate_prefix</span><span class="p">(</span><span class="s2">&quot;person&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;success&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>

    <span class="c1"># =========================================================================</span>
    <span class="c1"># Merge Operations (V2 BETA)</span>
    <span class="c1"># =========================================================================</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">merge</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">primary_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">,</span>
        <span class="n">duplicate_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Merge a duplicate person into a primary person.</span>

<span class="sd">        Returns a task URL to check merge status.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">enable_beta_endpoints</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">BetaEndpointDisabledError</span><span class="p">(</span>
                <span class="s2">&quot;Person merge is a beta endpoint; set enable_beta_endpoints=True to use it.&quot;</span>
            <span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s2">&quot;/person-merges&quot;</span><span class="p">,</span>
            <span class="n">json</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;primaryPersonId&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">primary_id</span><span class="p">),</span>
                <span class="s2">&quot;duplicatePersonId&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">duplicate_id</span><span class="p">),</span>
            <span class="p">},</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;taskUrl&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_merge_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MergeTask</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check the status of a merge operation.&quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/tasks/person-merges/</span><span class="si">{</span><span class="n">task_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">MergeTask</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="affinity.services.persons.AsyncPersonService.all" class="doc doc-heading">
            <code class="highlight language-python"><span class="nb">all</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">PersonId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">field_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">AnyFieldId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">field_types</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">FieldType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">FilterExpression</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">Person</span><span class="p">]</span></code>

<a href="#affinity.services.persons.AsyncPersonService.all" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Iterate through all persons with automatic pagination.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ids</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="affinity.models.types.PersonId">PersonId</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Specific person IDs to fetch (batch lookup)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>field_ids</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="affinity.models.types.AnyFieldId">AnyFieldId</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Specific field IDs to include</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>field_types</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<a class="autorefs autorefs-internal" title="FieldType (affinity.models.types.FieldType)" href="../../types/#affinity.types.FieldType">FieldType</a>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Field types to include</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filter</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <a class="autorefs autorefs-internal" title="FilterExpression (affinity.filters.FilterExpression)" href="../../filters/#affinity.filters.FilterExpression">FilterExpression</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>V2 filter expression</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Yields:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="collections.abc.AsyncIterator">AsyncIterator</span>[<a class="autorefs autorefs-internal" title="Person (affinity.models.entities.Person)" href="../../models/#affinity.models.Person">Person</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Person objects</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/persons.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">all</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">PersonId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">field_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">AnyFieldId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">field_types</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">FieldType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">FilterExpression</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">Person</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Iterate through all persons with automatic pagination.</span>

<span class="sd">    Args:</span>
<span class="sd">        ids: Specific person IDs to fetch (batch lookup)</span>
<span class="sd">        field_ids: Specific field IDs to include</span>
<span class="sd">        field_types: Field types to include</span>
<span class="sd">        filter: V2 filter expression</span>

<span class="sd">    Yields:</span>
<span class="sd">        Person objects</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">fetch_page</span><span class="p">(</span><span class="n">next_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Person</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">next_url</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get_url</span><span class="p">(</span><span class="n">next_url</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Person</span><span class="p">](</span>
                <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">Person</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">[])],</span>
                <span class="n">pagination</span><span class="o">=</span><span class="n">PaginationInfo</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pagination&quot;</span><span class="p">,</span> <span class="p">{})),</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">(</span>
            <span class="n">ids</span><span class="o">=</span><span class="n">ids</span><span class="p">,</span> <span class="n">field_ids</span><span class="o">=</span><span class="n">field_ids</span><span class="p">,</span> <span class="n">field_types</span><span class="o">=</span><span class="n">field_types</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">AsyncPageIterator</span><span class="p">(</span><span class="n">fetch_page</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.persons.AsyncPersonService.create" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">PersonCreate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Person</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#affinity.services.persons.AsyncPersonService.create" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Create a new person.</p>


<details class="note" open>
  <summary>Note</summary>
  <p>Creates use V1 API, while reads use V2 API. Due to eventual consistency
between V1 and V2, a <code>get()</code> call immediately after <code>create()</code> may return
404 NotFoundError. If you need to read immediately after creation, either:
- Use the Person object returned by this method (it contains the created data)
- Add a short delay (100-500ms) before calling get()
- Implement retry logic in your application</p>
</details>

<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="ValidationError (affinity.exceptions.ValidationError)" href="../../exceptions/#affinity.exceptions.ValidationError">ValidationError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If email conflicts with existing person</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/persons.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">PersonCreate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Person</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a new person.</span>

<span class="sd">    Note:</span>
<span class="sd">        Creates use V1 API, while reads use V2 API. Due to eventual consistency</span>
<span class="sd">        between V1 and V2, a `get()` call immediately after `create()` may return</span>
<span class="sd">        404 NotFoundError. If you need to read immediately after creation, either:</span>
<span class="sd">        - Use the Person object returned by this method (it contains the created data)</span>
<span class="sd">        - Add a short delay (100-500ms) before calling get()</span>
<span class="sd">        - Implement retry logic in your application</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValidationError: If email conflicts with existing person</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">by_alias</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="o">.</span><span class="n">company_ids</span><span class="p">:</span>
        <span class="n">payload</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;organization_ids&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/persons&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">cache</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">invalidate_prefix</span><span class="p">(</span><span class="s2">&quot;person&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">Person</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.persons.AsyncPersonService.delete" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete</span><span class="p">(</span><span class="n">person_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#affinity.services.persons.AsyncPersonService.delete" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Delete a person (also deletes associated field values).</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/persons.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Delete a person (also deletes associated field values).&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/persons/</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">cache</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">invalidate_prefix</span><span class="p">(</span><span class="s2">&quot;person&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;success&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.persons.AsyncPersonService.get" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get</span><span class="p">(</span><span class="n">person_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">field_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">AnyFieldId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">field_types</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">FieldType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">include_field_values</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">with_interaction_dates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">with_interaction_persons</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Person</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#affinity.services.persons.AsyncPersonService.get" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Get a single person by ID.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>person_id</code>
            </td>
            <td>
                  <code><span title="affinity.models.types.PersonId">PersonId</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The person ID</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>field_ids</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="affinity.models.types.AnyFieldId">AnyFieldId</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Specific field IDs to include in response</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>field_types</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<a class="autorefs autorefs-internal" title="FieldType (affinity.models.types.FieldType)" href="../../types/#affinity.types.FieldType">FieldType</a>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Field types to include (e.g., ["enriched", "global"])</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>include_field_values</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, fetch embedded field values. This saves
one API call when you need both person info and field values.
Cannot be combined with field_ids/field_types.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>retries</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of retries on 404 NotFoundError. Default is 0 (fail fast).
Set to 2-3 if calling immediately after create() to handle eventual
consistency lag.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>with_interaction_dates</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Include interaction date summaries (last/next
meeting dates, email dates).</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>with_interaction_persons</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Include person IDs for each interaction.
Only applies when with_interaction_dates=True.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="Person (affinity.models.entities.Person)" href="../../models/#affinity.models.Person">Person</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Person object with requested field data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="Person (affinity.models.entities.Person)" href="../../models/#affinity.models.Person">Person</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When include_field_values=True, the Person will have a <code>field_values</code></p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="Person (affinity.models.entities.Person)" href="../../models/#affinity.models.Person">Person</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>attribute containing the list of FieldValue objects.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="Person (affinity.models.entities.Person)" href="../../models/#affinity.models.Person">Person</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When with_interaction_dates=True, the Person will have interaction_dates</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="Person (affinity.models.entities.Person)" href="../../models/#affinity.models.Person">Person</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>and interactions populated.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="NotFoundError (affinity.exceptions.NotFoundError)" href="../../exceptions/#affinity.exceptions.NotFoundError">NotFoundError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If person does not exist after all retries.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If include_field_values is combined with field_ids/field_types.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>When combining with_interaction_dates with field_ids/field_types,
two API calls are made internally and the results are merged.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/persons.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">person_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">field_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">AnyFieldId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">field_types</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">FieldType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">include_field_values</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">with_interaction_dates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">with_interaction_persons</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Person</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a single person by ID.</span>

<span class="sd">    Args:</span>
<span class="sd">        person_id: The person ID</span>
<span class="sd">        field_ids: Specific field IDs to include in response</span>
<span class="sd">        field_types: Field types to include (e.g., [&quot;enriched&quot;, &quot;global&quot;])</span>
<span class="sd">        include_field_values: If True, fetch embedded field values. This saves</span>
<span class="sd">            one API call when you need both person info and field values.</span>
<span class="sd">            Cannot be combined with field_ids/field_types.</span>
<span class="sd">        retries: Number of retries on 404 NotFoundError. Default is 0 (fail fast).</span>
<span class="sd">            Set to 2-3 if calling immediately after create() to handle eventual</span>
<span class="sd">            consistency lag.</span>
<span class="sd">        with_interaction_dates: Include interaction date summaries (last/next</span>
<span class="sd">            meeting dates, email dates).</span>
<span class="sd">        with_interaction_persons: Include person IDs for each interaction.</span>
<span class="sd">            Only applies when with_interaction_dates=True.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Person object with requested field data.</span>
<span class="sd">        When include_field_values=True, the Person will have a `field_values`</span>
<span class="sd">        attribute containing the list of FieldValue objects.</span>
<span class="sd">        When with_interaction_dates=True, the Person will have interaction_dates</span>
<span class="sd">        and interactions populated.</span>

<span class="sd">    Raises:</span>
<span class="sd">        NotFoundError: If person does not exist after all retries.</span>
<span class="sd">        ValueError: If include_field_values is combined with field_ids/field_types.</span>

<span class="sd">    Note:</span>
<span class="sd">        When combining with_interaction_dates with field_ids/field_types,</span>
<span class="sd">        two API calls are made internally and the results are merged.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_with_retry</span><span class="p">(</span>
        <span class="n">person_id</span><span class="p">,</span>
        <span class="n">field_ids</span><span class="o">=</span><span class="n">field_ids</span><span class="p">,</span>
        <span class="n">field_types</span><span class="o">=</span><span class="n">field_types</span><span class="p">,</span>
        <span class="n">include_field_values</span><span class="o">=</span><span class="n">include_field_values</span><span class="p">,</span>
        <span class="n">retries</span><span class="o">=</span><span class="n">retries</span><span class="p">,</span>
        <span class="n">with_interaction_dates</span><span class="o">=</span><span class="n">with_interaction_dates</span><span class="p">,</span>
        <span class="n">with_interaction_persons</span><span class="o">=</span><span class="n">with_interaction_persons</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.persons.AsyncPersonService.get_associated_company_ids" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_associated_company_ids</span><span class="p">(</span><span class="n">person_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">CompanyId</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#affinity.services.persons.AsyncPersonService.get_associated_company_ids" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Get associated company IDs for a person.</p>
<p>V1-only: V2 does not expose person -&gt; company associations directly.
Uses GET <code>/persons/{id}</code> (V1) and returns <code>organization_ids</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>person_id</code>
            </td>
            <td>
                  <code><span title="affinity.models.types.PersonId">PersonId</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The person ID</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_results</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of company IDs to return</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="builtins.list">list</span>[<a class="autorefs autorefs-internal" title="CompanyId (affinity.models.types.CompanyId)" href="../../types/#affinity.types.CompanyId">CompanyId</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of CompanyId values associated with this person</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>The Person model already has <code>company_ids</code> populated from V1's
<code>organizationIds</code> field. This method provides API parity with
<code>CompanyService.get_associated_person_ids()</code>.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/persons.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_associated_company_ids</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">person_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">CompanyId</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get associated company IDs for a person.</span>

<span class="sd">    V1-only: V2 does not expose person -&gt; company associations directly.</span>
<span class="sd">    Uses GET `/persons/{id}` (V1) and returns `organization_ids`.</span>

<span class="sd">    Args:</span>
<span class="sd">        person_id: The person ID</span>
<span class="sd">        max_results: Maximum number of company IDs to return</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of CompanyId values associated with this person</span>

<span class="sd">    Note:</span>
<span class="sd">        The Person model already has `company_ids` populated from V1&#39;s</span>
<span class="sd">        `organizationIds` field. This method provides API parity with</span>
<span class="sd">        `CompanyService.get_associated_person_ids()`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/persons/</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Defensive: handle potential {&quot;person&quot;: {...}} wrapper</span>
    <span class="c1"># (consistent with CompanyService.get_associated_person_ids pattern)</span>
    <span class="n">person</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;person&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">person</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">data</span>
    <span class="n">org_ids</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">org_ids</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organization_ids&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organizationIds&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">org_ids</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">CompanyId</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">cid</span><span class="p">))</span> <span class="k">for</span> <span class="n">cid</span> <span class="ow">in</span> <span class="n">org_ids</span> <span class="k">if</span> <span class="n">cid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">max_results</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_results</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ids</span><span class="p">[:</span><span class="n">max_results</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ids</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.persons.AsyncPersonService.get_associated_company_ids_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_associated_company_ids_batch</span><span class="p">(</span><span class="n">person_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">PersonId</span><span class="p">],</span> <span class="o">*</span><span class="p">,</span> <span class="n">on_error</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;raise&#39;</span><span class="p">,</span> <span class="s1">&#39;skip&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;raise&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">PersonId</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">CompanyId</span><span class="p">]]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#affinity.services.persons.AsyncPersonService.get_associated_company_ids_batch" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Get company associations for multiple persons.</p>
<p>Makes one V1 API call per person.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>person_ids</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="affinity.models.types.PersonId">PersonId</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sequence of person IDs to fetch</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>on_error</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;raise&#39;, &#39;skip&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How to handle errors - "raise" (default) or "skip" failed IDs</p>
              </div>
            </td>
            <td>
                  <code>&#39;raise&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="affinity.models.types.PersonId">PersonId</span>, <span title="builtins.list">list</span>[<a class="autorefs autorefs-internal" title="CompanyId (affinity.models.types.CompanyId)" href="../../types/#affinity.types.CompanyId">CompanyId</a>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict mapping person_id -&gt; list of company_ids</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="AffinityError (affinity.exceptions.AffinityError)" href="../../exceptions/#affinity.exceptions.AffinityError">AffinityError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If on_error="raise" and any fetch fails.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/persons.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_associated_company_ids_batch</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">person_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">PersonId</span><span class="p">],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">on_error</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;raise&quot;</span><span class="p">,</span> <span class="s2">&quot;skip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;raise&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">PersonId</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">CompanyId</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get company associations for multiple persons.</span>

<span class="sd">    Makes one V1 API call per person.</span>

<span class="sd">    Args:</span>
<span class="sd">        person_ids: Sequence of person IDs to fetch</span>
<span class="sd">        on_error: How to handle errors - &quot;raise&quot; (default) or &quot;skip&quot; failed IDs</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dict mapping person_id -&gt; list of company_ids</span>

<span class="sd">    Raises:</span>
<span class="sd">        AffinityError: If on_error=&quot;raise&quot; and any fetch fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">PersonId</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">CompanyId</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">person_id</span> <span class="ow">in</span> <span class="n">person_ids</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_associated_company_ids</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">AffinityError</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s2">&quot;raise&quot;</span><span class="p">:</span>
                <span class="k">raise</span>
            <span class="c1"># skip: continue without this person</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s2">&quot;raise&quot;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">AffinityError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Failed to get associations for person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
            <span class="c1"># skip: continue without this person</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.persons.AsyncPersonService.get_associated_opportunity_ids" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_associated_opportunity_ids</span><span class="p">(</span><span class="n">person_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#affinity.services.persons.AsyncPersonService.get_associated_opportunity_ids" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Get associated opportunity IDs for a person.</p>
<p>V1-only: V2 does not expose person -&gt; opportunity associations directly.
Uses GET <code>/persons/{id}</code> (V1) and returns <code>opportunity_ids</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>person_id</code>
            </td>
            <td>
                  <code><span title="affinity.models.types.PersonId">PersonId</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The person ID</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_results</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of opportunity IDs to return</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="builtins.list">list</span>[<span title="affinity.models.types.OpportunityId">OpportunityId</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of OpportunityId values associated with this person</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>The Person model already has <code>opportunity_ids</code> populated from V1's
<code>opportunityIds</code> field. This method provides API parity with
<code>OpportunityService.get_associated_person_ids()</code>.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/persons.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_associated_opportunity_ids</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">person_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get associated opportunity IDs for a person.</span>

<span class="sd">    V1-only: V2 does not expose person -&gt; opportunity associations directly.</span>
<span class="sd">    Uses GET `/persons/{id}` (V1) and returns `opportunity_ids`.</span>

<span class="sd">    Args:</span>
<span class="sd">        person_id: The person ID</span>
<span class="sd">        max_results: Maximum number of opportunity IDs to return</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of OpportunityId values associated with this person</span>

<span class="sd">    Note:</span>
<span class="sd">        The Person model already has `opportunity_ids` populated from V1&#39;s</span>
<span class="sd">        `opportunityIds` field. This method provides API parity with</span>
<span class="sd">        `OpportunityService.get_associated_person_ids()`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/persons/</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Defensive: handle potential {&quot;person&quot;: {...}} wrapper</span>
    <span class="n">person</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;person&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">person</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="n">data</span>
    <span class="n">opp_ids</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">opp_ids</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;opportunity_ids&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;opportunityIds&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">opp_ids</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">OpportunityId</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">oid</span><span class="p">))</span> <span class="k">for</span> <span class="n">oid</span> <span class="ow">in</span> <span class="n">opp_ids</span> <span class="k">if</span> <span class="n">oid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">max_results</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_results</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ids</span><span class="p">[:</span><span class="n">max_results</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ids</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.persons.AsyncPersonService.get_associated_opportunity_ids_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_associated_opportunity_ids_batch</span><span class="p">(</span><span class="n">person_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">PersonId</span><span class="p">],</span> <span class="o">*</span><span class="p">,</span> <span class="n">on_error</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;raise&#39;</span><span class="p">,</span> <span class="s1">&#39;skip&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;raise&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">PersonId</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">]]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#affinity.services.persons.AsyncPersonService.get_associated_opportunity_ids_batch" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Get opportunity associations for multiple persons.</p>
<p>Makes one V1 API call per person.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>person_ids</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="affinity.models.types.PersonId">PersonId</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sequence of person IDs to fetch</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>on_error</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;raise&#39;, &#39;skip&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How to handle errors - "raise" (default) or "skip" failed IDs</p>
              </div>
            </td>
            <td>
                  <code>&#39;raise&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="affinity.models.types.PersonId">PersonId</span>, <span title="builtins.list">list</span>[<span title="affinity.models.types.OpportunityId">OpportunityId</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict mapping person_id -&gt; list of opportunity_ids</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="AffinityError (affinity.exceptions.AffinityError)" href="../../exceptions/#affinity.exceptions.AffinityError">AffinityError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If on_error="raise" and any fetch fails.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/persons.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_associated_opportunity_ids_batch</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">person_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">PersonId</span><span class="p">],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">on_error</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;raise&quot;</span><span class="p">,</span> <span class="s2">&quot;skip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;raise&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">PersonId</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get opportunity associations for multiple persons.</span>

<span class="sd">    Makes one V1 API call per person.</span>

<span class="sd">    Args:</span>
<span class="sd">        person_ids: Sequence of person IDs to fetch</span>
<span class="sd">        on_error: How to handle errors - &quot;raise&quot; (default) or &quot;skip&quot; failed IDs</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dict mapping person_id -&gt; list of opportunity_ids</span>

<span class="sd">    Raises:</span>
<span class="sd">        AffinityError: If on_error=&quot;raise&quot; and any fetch fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">PersonId</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">OpportunityId</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">person_id</span> <span class="ow">in</span> <span class="n">person_ids</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="n">person_id</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_associated_opportunity_ids</span><span class="p">(</span><span class="n">person_id</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">AffinityError</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s2">&quot;raise&quot;</span><span class="p">:</span>
                <span class="k">raise</span>
            <span class="c1"># skip: continue without this person</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s2">&quot;raise&quot;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">AffinityError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Failed to get associations for person </span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
            <span class="c1"># skip: continue without this person</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.persons.AsyncPersonService.get_fields" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_fields</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">field_types</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">FieldType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">FieldMetadata</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#affinity.services.persons.AsyncPersonService.get_fields" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Get metadata about person fields.</p>
<p>Cached for performance.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/persons.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_fields</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">field_types</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">FieldType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">FieldMetadata</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get metadata about person fields.</span>

<span class="sd">    Cached for performance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">field_types</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;fieldTypes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">field_type</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">field_type</span> <span class="ow">in</span> <span class="n">field_types</span><span class="p">]</span>

    <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="s2">&quot;/persons/fields&quot;</span><span class="p">,</span>
        <span class="n">params</span><span class="o">=</span><span class="n">params</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cache_key</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;person_fields:</span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">field_types</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">[])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">cache_ttl</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">FieldMetadata</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">[])]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.persons.AsyncPersonService.get_list_entries" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_list_entries</span><span class="p">(</span><span class="n">person_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">ListEntry</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#affinity.services.persons.AsyncPersonService.get_list_entries" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Get all list entries for a person across all lists.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/persons.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_list_entries</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">person_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">ListEntry</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all list entries for a person across all lists.&quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/persons/</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">/list-entries&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">ListEntry</span><span class="p">](</span>
        <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">ListEntry</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">[])],</span>
        <span class="n">pagination</span><span class="o">=</span><span class="n">PaginationInfo</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pagination&quot;</span><span class="p">,</span> <span class="p">{})),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.persons.AsyncPersonService.get_lists" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_lists</span><span class="p">(</span><span class="n">person_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">ListSummary</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#affinity.services.persons.AsyncPersonService.get_lists" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Get all lists that contain this person.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/persons.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_lists</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">person_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">ListSummary</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all lists that contain this person.&quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/persons/</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">/lists&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">ListSummary</span><span class="p">](</span>
        <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">ListSummary</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">[])],</span>
        <span class="n">pagination</span><span class="o">=</span><span class="n">PaginationInfo</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pagination&quot;</span><span class="p">,</span> <span class="p">{})),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.persons.AsyncPersonService.get_merge_status" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_merge_status</span><span class="p">(</span><span class="n">task_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MergeTask</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#affinity.services.persons.AsyncPersonService.get_merge_status" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Check the status of a merge operation.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/persons.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1788</span>
<span class="normal">1789</span>
<span class="normal">1790</span>
<span class="normal">1791</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_merge_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MergeTask</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check the status of a merge operation.&quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/tasks/person-merges/</span><span class="si">{</span><span class="n">task_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">MergeTask</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.persons.AsyncPersonService.iter" class="doc doc-heading">
            <code class="highlight language-python"><span class="nb">iter</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">PersonId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">field_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">AnyFieldId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">field_types</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">FieldType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">FilterExpression</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">Person</span><span class="p">]</span></code>

<a href="#affinity.services.persons.AsyncPersonService.iter" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Auto-paginate all persons.</p>
<p>Alias for <code>all()</code> (FR-006 public contract).</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/persons.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">iter</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">PersonId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">field_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">AnyFieldId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">field_types</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">FieldType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">FilterExpression</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">Person</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Auto-paginate all persons.</span>

<span class="sd">    Alias for `all()` (FR-006 public contract).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">ids</span><span class="o">=</span><span class="n">ids</span><span class="p">,</span> <span class="n">field_ids</span><span class="o">=</span><span class="n">field_ids</span><span class="p">,</span> <span class="n">field_types</span><span class="o">=</span><span class="n">field_types</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.persons.AsyncPersonService.list" class="doc doc-heading">
            <code class="highlight language-python"><span class="nb">list</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">PersonId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">field_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">AnyFieldId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">field_types</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">FieldType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">FilterExpression</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cursor</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Person</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#affinity.services.persons.AsyncPersonService.list" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Get a page of persons.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ids</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="affinity.models.types.PersonId">PersonId</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Specific person IDs to fetch (batch lookup)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>field_ids</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="affinity.models.types.AnyFieldId">AnyFieldId</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Specific field IDs to include in response</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>field_types</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<a class="autorefs autorefs-internal" title="FieldType (affinity.models.types.FieldType)" href="../../types/#affinity.types.FieldType">FieldType</a>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Field types to include</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filter</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <a class="autorefs autorefs-internal" title="FilterExpression (affinity.filters.FilterExpression)" href="../../filters/#affinity.filters.FilterExpression">FilterExpression</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>V2 filter expression string, or a FilterExpression built via <code>affinity.F</code></p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>limit</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of results</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cursor</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cursor to resume pagination (opaque; obtained from prior responses)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="PaginatedResponse (affinity.models.pagination.PaginatedResponse)" href="../../models/#affinity.models.PaginatedResponse">PaginatedResponse</a>[<a class="autorefs autorefs-internal" title="Person (affinity.models.entities.Person)" href="../../models/#affinity.models.Person">Person</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Paginated response with persons</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/persons.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">PersonId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">field_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">AnyFieldId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">field_types</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">FieldType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">FilterExpression</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">cursor</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Person</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a page of persons.</span>

<span class="sd">    Args:</span>
<span class="sd">        ids: Specific person IDs to fetch (batch lookup)</span>
<span class="sd">        field_ids: Specific field IDs to include in response</span>
<span class="sd">        field_types: Field types to include</span>
<span class="sd">        filter: V2 filter expression string, or a FilterExpression built via `affinity.F`</span>
<span class="sd">        limit: Maximum number of results</span>
<span class="sd">        cursor: Cursor to resume pagination (opaque; obtained from prior responses)</span>

<span class="sd">    Returns:</span>
<span class="sd">        Paginated response with persons</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">cursor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">p</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">field_ids</span><span class="p">,</span> <span class="n">field_types</span><span class="p">,</span> <span class="nb">filter</span><span class="p">,</span> <span class="n">limit</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot combine &#39;cursor&#39; with other parameters; cursor encodes all query &quot;</span>
                <span class="s2">&quot;context. Start a new pagination sequence without a cursor to change &quot;</span>
                <span class="s2">&quot;parameters.&quot;</span>
            <span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get_url</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">ids</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;ids&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span> <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">field_ids</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;fieldIds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">field_id</span><span class="p">)</span> <span class="k">for</span> <span class="n">field_id</span> <span class="ow">in</span> <span class="n">field_ids</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">field_types</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;fieldTypes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">field_type</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">field_type</span> <span class="ow">in</span> <span class="n">field_types</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filter_text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">filter</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">filter_text</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s2">&quot;filter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filter_text</span>
        <span class="k">if</span> <span class="n">limit</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;limit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">limit</span>
        <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/persons&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Person</span><span class="p">](</span>
        <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">Person</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">[])],</span>
        <span class="n">pagination</span><span class="o">=</span><span class="n">PaginationInfo</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pagination&quot;</span><span class="p">,</span> <span class="p">{})),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.persons.AsyncPersonService.merge" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">merge</span><span class="p">(</span><span class="n">primary_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">,</span> <span class="n">duplicate_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#affinity.services.persons.AsyncPersonService.merge" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Merge a duplicate person into a primary person.</p>
<p>Returns a task URL to check merge status.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/persons.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span>
<span class="normal">1768</span>
<span class="normal">1769</span>
<span class="normal">1770</span>
<span class="normal">1771</span>
<span class="normal">1772</span>
<span class="normal">1773</span>
<span class="normal">1774</span>
<span class="normal">1775</span>
<span class="normal">1776</span>
<span class="normal">1777</span>
<span class="normal">1778</span>
<span class="normal">1779</span>
<span class="normal">1780</span>
<span class="normal">1781</span>
<span class="normal">1782</span>
<span class="normal">1783</span>
<span class="normal">1784</span>
<span class="normal">1785</span>
<span class="normal">1786</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">merge</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">primary_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">,</span>
    <span class="n">duplicate_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Merge a duplicate person into a primary person.</span>

<span class="sd">    Returns a task URL to check merge status.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">enable_beta_endpoints</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">BetaEndpointDisabledError</span><span class="p">(</span>
            <span class="s2">&quot;Person merge is a beta endpoint; set enable_beta_endpoints=True to use it.&quot;</span>
        <span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
        <span class="s2">&quot;/person-merges&quot;</span><span class="p">,</span>
        <span class="n">json</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;primaryPersonId&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">primary_id</span><span class="p">),</span>
            <span class="s2">&quot;duplicatePersonId&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">duplicate_id</span><span class="p">),</span>
        <span class="p">},</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;taskUrl&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.persons.AsyncPersonService.pages" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pages</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">PersonId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">field_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">AnyFieldId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">field_types</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">FieldType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">FilterExpression</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cursor</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Person</span><span class="p">]]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#affinity.services.persons.AsyncPersonService.pages" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Iterate person pages (not items), yielding <code>PaginatedResponse[Person]</code>.</p>
<p>Useful for ETL scripts that need checkpoint/resume via <code>page.next_cursor</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ids</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="affinity.models.types.PersonId">PersonId</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Specific person IDs to fetch (batch lookup)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>field_ids</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="affinity.models.types.AnyFieldId">AnyFieldId</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Specific field IDs to include in response</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>field_types</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<a class="autorefs autorefs-internal" title="FieldType (affinity.models.types.FieldType)" href="../../types/#affinity.types.FieldType">FieldType</a>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Field types to include</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filter</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <a class="autorefs autorefs-internal" title="FilterExpression (affinity.filters.FilterExpression)" href="../../filters/#affinity.filters.FilterExpression">FilterExpression</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>V2 filter expression string or FilterExpression</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>limit</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum results per page</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cursor</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cursor to resume pagination</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Yields:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="collections.abc.AsyncIterator">AsyncIterator</span>[<a class="autorefs autorefs-internal" title="PaginatedResponse (affinity.models.pagination.PaginatedResponse)" href="../../models/#affinity.models.PaginatedResponse">PaginatedResponse</a>[<a class="autorefs autorefs-internal" title="Person (affinity.models.entities.Person)" href="../../models/#affinity.models.Person">Person</a>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>PaginatedResponse[Person] for each page</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/persons.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">pages</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">PersonId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">field_ids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">AnyFieldId</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">field_types</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">FieldType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">FilterExpression</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">cursor</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Person</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Iterate person pages (not items), yielding `PaginatedResponse[Person]`.</span>

<span class="sd">    Useful for ETL scripts that need checkpoint/resume via `page.next_cursor`.</span>

<span class="sd">    Args:</span>
<span class="sd">        ids: Specific person IDs to fetch (batch lookup)</span>
<span class="sd">        field_ids: Specific field IDs to include in response</span>
<span class="sd">        field_types: Field types to include</span>
<span class="sd">        filter: V2 filter expression string or FilterExpression</span>
<span class="sd">        limit: Maximum results per page</span>
<span class="sd">        cursor: Cursor to resume pagination</span>

<span class="sd">    Yields:</span>
<span class="sd">        PaginatedResponse[Person] for each page</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">other_params</span> <span class="o">=</span> <span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">field_ids</span><span class="p">,</span> <span class="n">field_types</span><span class="p">,</span> <span class="nb">filter</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cursor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="n">p</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">other_params</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Cannot combine &#39;cursor&#39; with other parameters; cursor encodes all query context. &quot;</span>
            <span class="s2">&quot;Start a new pagination sequence without a cursor to change parameters.&quot;</span>
        <span class="p">)</span>
    <span class="n">requested_cursor</span> <span class="o">=</span> <span class="n">cursor</span>
    <span class="k">if</span> <span class="n">cursor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">page</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">cursor</span><span class="o">=</span><span class="n">cursor</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">page</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">(</span>
            <span class="n">ids</span><span class="o">=</span><span class="n">ids</span><span class="p">,</span>
            <span class="n">field_ids</span><span class="o">=</span><span class="n">field_ids</span><span class="p">,</span>
            <span class="n">field_types</span><span class="o">=</span><span class="n">field_types</span><span class="p">,</span>
            <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">,</span>
            <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">page</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">page</span><span class="o">.</span><span class="n">has_next</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">next_cursor</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">next_cursor</span>
        <span class="k">if</span> <span class="n">next_cursor</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">next_cursor</span> <span class="o">==</span> <span class="n">requested_cursor</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">requested_cursor</span> <span class="o">=</span> <span class="n">next_cursor</span>
        <span class="n">page</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">cursor</span><span class="o">=</span><span class="n">next_cursor</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.persons.AsyncPersonService.resolve" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">resolve</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">email</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Person</span> <span class="o">|</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#affinity.services.persons.AsyncPersonService.resolve" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Find a single person by email or name.</p>
<p>This is a convenience helper that searches and returns the first exact match,
or None if not found. Uses V1 search internally.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/persons.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">resolve</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">email</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Person</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find a single person by email or name.</span>

<span class="sd">    This is a convenience helper that searches and returns the first exact match,</span>
<span class="sd">    or None if not found. Uses V1 search internally.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">email</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must provide either email or name&quot;</span><span class="p">)</span>

    <span class="n">term</span> <span class="o">=</span> <span class="n">email</span> <span class="ow">or</span> <span class="n">name</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
    <span class="k">async</span> <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_pages</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">page_size</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">page</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_person_matches</span><span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">person</span>

    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.persons.AsyncPersonService.resolve_all" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">resolve_all</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">email</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">Person</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#affinity.services.persons.AsyncPersonService.resolve_all" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Find all persons matching an email or name.</p>
<p>Notes:
- This auto-paginates V1 search results to collect exact matches.
- Unlike resolve(), this returns every match in server-provided order.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/persons.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">resolve_all</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">email</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">Person</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find all persons matching an email or name.</span>

<span class="sd">    Notes:</span>
<span class="sd">    - This auto-paginates V1 search results to collect exact matches.</span>
<span class="sd">    - Unlike resolve(), this returns every match in server-provided order.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">email</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must provide either email or name&quot;</span><span class="p">)</span>

    <span class="n">term</span> <span class="o">=</span> <span class="n">email</span> <span class="ow">or</span> <span class="n">name</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
    <span class="n">matches</span><span class="p">:</span> <span class="n">builtins</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="n">Person</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">async</span> <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_pages</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">page_size</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">page</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_person_matches</span><span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">):</span>
                <span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">person</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">matches</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.persons.AsyncPersonService.search" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">search</span><span class="p">(</span><span class="n">term</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">with_interaction_dates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">with_interaction_persons</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">with_opportunities</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">page_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">page_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Person</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#affinity.services.persons.AsyncPersonService.search" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Search for persons by name or email.</p>
<p>Uses V1 API for search functionality.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/persons.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">search</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">term</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">with_interaction_dates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">with_interaction_persons</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">with_opportunities</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">page_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">page_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Person</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Search for persons by name or email.</span>

<span class="sd">    Uses V1 API for search functionality.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;term&quot;</span><span class="p">:</span> <span class="n">term</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">with_interaction_dates</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;with_interaction_dates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">with_interaction_persons</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;with_interaction_persons&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">with_opportunities</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;with_opportunities&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">page_size</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;page_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">page_size</span>
    <span class="k">if</span> <span class="n">page_token</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;page_token&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">page_token</span>

    <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/persons&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">Person</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;persons&quot;</span><span class="p">,</span> <span class="p">[])]</span>
    <span class="k">return</span> <span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Person</span><span class="p">](</span>
        <span class="n">data</span><span class="o">=</span><span class="n">items</span><span class="p">,</span>
        <span class="n">next_page_token</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;next_page_token&quot;</span><span class="p">),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.persons.AsyncPersonService.search_all" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">search_all</span><span class="p">(</span><span class="n">term</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">with_interaction_dates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">with_interaction_persons</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">with_opportunities</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">page_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">page_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">Person</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#affinity.services.persons.AsyncPersonService.search_all" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Iterate all V1 person-search results with automatic pagination.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>term</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Search term (name or email)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>with_interaction_dates</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Include interaction date data</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>with_interaction_persons</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Include persons for interactions</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>with_opportunities</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Include associated opportunity IDs</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>page_size</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Results per page (max 500)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>page_token</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Resume from this pagination token</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Yields:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="collections.abc.AsyncIterator">AsyncIterator</span>[<a class="autorefs autorefs-internal" title="Person (affinity.models.entities.Person)" href="../../models/#affinity.models.Person">Person</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Person objects matching the search term</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/persons.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">search_all</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">term</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">with_interaction_dates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">with_interaction_persons</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">with_opportunities</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">page_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">page_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">Person</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Iterate all V1 person-search results with automatic pagination.</span>

<span class="sd">    Args:</span>
<span class="sd">        term: Search term (name or email)</span>
<span class="sd">        with_interaction_dates: Include interaction date data</span>
<span class="sd">        with_interaction_persons: Include persons for interactions</span>
<span class="sd">        with_opportunities: Include associated opportunity IDs</span>
<span class="sd">        page_size: Results per page (max 500)</span>
<span class="sd">        page_token: Resume from this pagination token</span>

<span class="sd">    Yields:</span>
<span class="sd">        Person objects matching the search term</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">async</span> <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_pages</span><span class="p">(</span>
        <span class="n">term</span><span class="p">,</span>
        <span class="n">with_interaction_dates</span><span class="o">=</span><span class="n">with_interaction_dates</span><span class="p">,</span>
        <span class="n">with_interaction_persons</span><span class="o">=</span><span class="n">with_interaction_persons</span><span class="p">,</span>
        <span class="n">with_opportunities</span><span class="o">=</span><span class="n">with_opportunities</span><span class="p">,</span>
        <span class="n">page_size</span><span class="o">=</span><span class="n">page_size</span><span class="p">,</span>
        <span class="n">page_token</span><span class="o">=</span><span class="n">page_token</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">page</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">person</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.persons.AsyncPersonService.search_pages" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">search_pages</span><span class="p">(</span><span class="n">term</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">with_interaction_dates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">with_interaction_persons</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">with_opportunities</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">page_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">page_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Person</span><span class="p">]]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#affinity.services.persons.AsyncPersonService.search_pages" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Iterate V1 person-search result pages.</p>
<p>Useful for scripts that need checkpoint/resume via <code>next_page_token</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>term</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Search term (name or email)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>with_interaction_dates</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Include interaction date data</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>with_interaction_persons</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Include persons for interactions</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>with_opportunities</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Include associated opportunity IDs</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>page_size</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Results per page (max 500)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>page_token</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Resume from this pagination token</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Yields:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="collections.abc.AsyncIterator">AsyncIterator</span>[<a class="autorefs autorefs-internal" title="PaginatedResponse (affinity.models.pagination.PaginatedResponse)" href="../../models/#affinity.models.PaginatedResponse">PaginatedResponse</a>[<a class="autorefs autorefs-internal" title="Person (affinity.models.entities.Person)" href="../../models/#affinity.models.Person">Person</a>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>PaginatedResponse[Person] for each page</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/persons.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">search_pages</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">term</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">with_interaction_dates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">with_interaction_persons</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">with_opportunities</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">page_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">page_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">PaginatedResponse</span><span class="p">[</span><span class="n">Person</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Iterate V1 person-search result pages.</span>

<span class="sd">    Useful for scripts that need checkpoint/resume via `next_page_token`.</span>

<span class="sd">    Args:</span>
<span class="sd">        term: Search term (name or email)</span>
<span class="sd">        with_interaction_dates: Include interaction date data</span>
<span class="sd">        with_interaction_persons: Include persons for interactions</span>
<span class="sd">        with_opportunities: Include associated opportunity IDs</span>
<span class="sd">        page_size: Results per page (max 500)</span>
<span class="sd">        page_token: Resume from this pagination token</span>

<span class="sd">    Yields:</span>
<span class="sd">        PaginatedResponse[Person] for each page</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">requested_token</span> <span class="o">=</span> <span class="n">page_token</span>
    <span class="n">page</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
        <span class="n">term</span><span class="p">,</span>
        <span class="n">with_interaction_dates</span><span class="o">=</span><span class="n">with_interaction_dates</span><span class="p">,</span>
        <span class="n">with_interaction_persons</span><span class="o">=</span><span class="n">with_interaction_persons</span><span class="p">,</span>
        <span class="n">with_opportunities</span><span class="o">=</span><span class="n">with_opportunities</span><span class="p">,</span>
        <span class="n">page_size</span><span class="o">=</span><span class="n">page_size</span><span class="p">,</span>
        <span class="n">page_token</span><span class="o">=</span><span class="n">page_token</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">page</span>
        <span class="n">next_token</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">next_page_token</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">next_token</span> <span class="ow">or</span> <span class="n">next_token</span> <span class="o">==</span> <span class="n">requested_token</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">requested_token</span> <span class="o">=</span> <span class="n">next_token</span>
        <span class="n">page</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
            <span class="n">term</span><span class="p">,</span>
            <span class="n">with_interaction_dates</span><span class="o">=</span><span class="n">with_interaction_dates</span><span class="p">,</span>
            <span class="n">with_interaction_persons</span><span class="o">=</span><span class="n">with_interaction_persons</span><span class="p">,</span>
            <span class="n">with_opportunities</span><span class="o">=</span><span class="n">with_opportunities</span><span class="p">,</span>
            <span class="n">page_size</span><span class="o">=</span><span class="n">page_size</span><span class="p">,</span>
            <span class="n">page_token</span><span class="o">=</span><span class="n">next_token</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="affinity.services.persons.AsyncPersonService.update" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update</span><span class="p">(</span><span class="n">person_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">PersonUpdate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Person</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#affinity.services.persons.AsyncPersonService.update" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Update an existing person.</p>
<p>Note: To add emails/organizations, include existing values plus new ones.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>affinity/services/persons.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">person_id</span><span class="p">:</span> <span class="n">PersonId</span><span class="p">,</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">PersonUpdate</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Person</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update an existing person.</span>

<span class="sd">    Note: To add emails/organizations, include existing values plus new ones.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span>
        <span class="n">by_alias</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">,</span>
        <span class="n">exclude_unset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">put</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;/persons/</span><span class="si">{</span><span class="n">person_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
        <span class="n">v1</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">cache</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">invalidate_prefix</span><span class="p">(</span><span class="s2">&quot;person&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">Person</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Disclaimer: Unofficial community project; not affiliated with, endorsed by, or sponsored by Affinity. "Affinity" and related marks are trademarks of their respective owners. Use of the Affinity API is subject to Affinity Terms of Service.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>